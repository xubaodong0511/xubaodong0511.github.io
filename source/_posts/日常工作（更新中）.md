---
title: 日常工作（更新中）
author: Mr.xu
date: 2025-11-06 16:16:56
tags:
---

## 磁盘/内存 清理

```perl
# 查看磁盘大小
df -Th
# 查看每个目录下的文件大小
du -sh /*
du -sh /*/*
# 查看目录文件大小
du -h
# 数字化服务器占磁盘大的目录
rm -rf /docker/zentao/www/zentaopms/tmp
rm -rf /usr/tmp
rm -rf /var/log
s
# 查看内存使用率
free -m
# 清理缓存
echo 3 > /proc/sys/vm/drop_caches

# maven仓库地址
/usr/local/repository/maven_repo/com

# 查看java服务内存
jps -l
jmap -heap PID号

top里的“ RES:： 进程使用的物理内存量 (Resident Memory)，即实际驻留在物理内存中的部分。
RES的数值 / 1024 得出的结果就是服务使用的内存
```

## 数据备份

```perl
mysqldump 逻辑备份
mysqldump -u用户 -p密码 库名 [表名] > xxx.sql
mysql -u用户 -p密码 库名 < xxx.sql
# MySQL数据库备份
[root@figure ~]# ls
mul_java  mysql_db  nexus.log  nexus.tar  nohup.out
[root@figure ~]# cd mysql_db/
[root@figure mysql_db]# mysqldump -uroot -p'Qingfeng@123' zj_shops_dev > zj_shops_dev.sql
[root@figure mysql_db]# ls
dev.sql  mysql.sql  nacos.sql  test.sql  zj_shops_beta.sql  zj_shops_dev.sql  zj_shops_test.sql  zj_shops_uat.sql

示例：
mysql> show databases;
[root@localhost cha]# mysqldump -uroot -p'1' ku > ku.sql
[root@localhost cha]# vim ku.sql
	create database ku;
	use ku;		//看是否需要添加以上两行
	DROP TABLE IF EXISTS `biao`;
mysql> drop database ku;
mysql> show databases;	//再查看下
[root@localhost cha]# mysql -uroot -p'1' < ku.sql		//回复数据
mysql> show databases;


# java服务的jar包备份--2个方案，二选一就可以
[root@uat ~]# ls
jarfile
[root@uat ~]# cp jarfile/ jarfile_bak/ -r		# 拷贝目录
[root@uat ~]# tar czvf jarfile.tar.gz ./jarfile		# 将目录打包成tar.gz的包
[root@uat ~]# ls
jarfile  jarfile_bak  jarfile.tar.gz
```

### MySQL数据每日全量备份

```perl
# 创建目录
[root@localhost ~]# mkdir /opt/mysql_back/backup
[root@localhost ~]# mkdir /opt/mysql_back/back_log
# 创建脚本
[root@localhost mysql_back]# cat /opt/mysql_back/mysql_db_back.sh 
#!/bin/bash
# Description: MySQL全量备份，备份所有库

# 用户名、密码
user="root"
password="Qingfeng@123"

# 备份开始时间
beginTime=$(date +"%Y年%m月%d日 %H:%M:%S")
# 备份结束时间
endTime=$(date +"%Y年%m月%d日 %H:%M:%S")

# 全量备份目录，提前手动创建这个目录
bakDir="/opt/mysql_back/backup"
# 日志文件
logFile="/opt/mysql_back/back_log/fullybak.log"

# 创建备份目录
mkdir -p "$bakDir"

cd "$bakDir"
echo "全量备份开始: $beginTime" >> "$logFile"

# 全量备份
nowDate=$(date +"%Y%m%d_%H%M%S")
dumpFile="${nowDate}_alldb.sql"
gzDumpFile="${nowDate}_alldb.sql.tgz"

# 备份所有数据库
mysqldump -u"$user" -p"$password" -A -E -q --flush-privileges --single-transaction > "$dumpFile"

# 判断备份是否成功
if [ $? -eq 0 ]; then
  # 将备份SQL打包
  tar -zvcf "$gzDumpFile" "$dumpFile"
  rm "$dumpFile"
  echo "全量备份结束: $endTime, 备份文件: $gzDumpFile ! SUCCESS !" >> "$logFile"
else
  echo "全量备份结束: $endTime, 备份文件: $gzDumpFile ! ERROR !" >> "$logFile"
fi

# 删除7天前的备份
find "$bakDir" -name "*.sql.tgz" -type f -mtime +7 -exec rm -rf {} \; > /dev/null 2>&1
exit 0

# 授予脚本执行权限
[root@localhost mysql_back]# chmod +x /opt/mysql_back/mysql_db_back.sh 
# 创建定时计划任务
[root@localhost mysql_back]# crontab -e
0 1 * * * /bin/bash -x /opt/mysql_back/mysql_db_back.sh >/dev/null 2>&1		# 在每天的第1小时（凌晨1点）执行脚本。
```

## 挖矿程序清理

```perl
# 禁止服务开机自启
systemctl disable c3pool_miner.service
# 查看状态
systemctl status c3pool_miner.service 
# 停止服务
systemctl stop c3pool_miner.service 
systemctl status c3pool_miner.service 
# 删除服务的system文件
rm -rf /etc/systemd/system/c3pool_miner.service
systemctl list-units --type=service
systemctl list-units --type=service | grep c3pool
htop
ps -ef
ps -ef |grep xmrig
find / -name xmrig 
ls -lah
# 删除挖矿的脚本执行文件
rm -rf c3pool/
find / -name xmrig
# 禁止域名访问
iptables -A OUTPUT -p tcp -d *.c3pool.org --dport 80 -j DROP
iptables -A OUTPUT -p tcp -d '*.c3pool.org' --dport 80 -j DROP
iptables -A OUTPUT -p tcp -d "*.c3pool.org" --dport 80 -j DROP
iptables -A OUTPUT -p tcp -d download.c3pool.org --dport 80 -j DROP
iptables -A OUTPUT -p tcp -d c3pool.org --dport 80 -j DROP
ping c3pool.org
# 保持记录
iptables save
service iptables save
# 禁止执行脚本文件，并保存
iptables -I INPUT -m string --string "setup_c3pool_miner.sh" --algo bm -j DROP
service iptables save
# 查看保存记录
iptables -L
iptables-save > /etc/sysconfig/iptables
vim /etc/rc.d/rc.local
iptables-restore < /etc/sysconfig/iptables		#添加这内容
vim /etc/sysconfig/iptables		# 可以看到已经添加了一下内容
-A INPUT -m string --string "setup_c3pool_miner.sh" --algo bm --to 65535 -j DROP
-A OUTPUT -d 154.201.90.241/32 -p tcp -m tcp --dport 80 -j DROP
-A OUTPUT -d 154.12.21.70/32 -p tcp -m tcp --dport 80 -j DROP
```

## 阿里云漏洞恢复，禁用api的访问

```perl
# 问题：
Spring Boot Actuator 未授权访问远程代码执行漏洞【远程扫描】RASP支持实时防护
# 详情
uat
47.116.200.165 公  172.31.141.179 私
漏洞地址：http://47.116.200.165:8090/actuator
返回特征：nv-toMatch":{"href":"http://47.116.200.165:8090/actuator/env/{toMatch}","templated":true},"env":{"href":"htt
# 解决：
# 在代理里添加禁止访问的二级目录
[root@prod-network conf.d]# cat prd-api.conf 
server {
        listen  881;

        location / {
                proxy_pass http://172.31.141.180:8090/;
                proxy_set_header Host $host:$server_port;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /doc.html {				# 访问api接口，返回403
                return 403;
    }

        location ^~ /actuator/  {			# 补漏洞，添加以下这两个location
          deny all;
        }

        location ^~ /actuator  {
          deny all;
        }
}

# 问题
fastjson <= 1.2.80 反序列化任意代码执行漏洞	RASP支持实时防护
# 详情
路径：/root/jarfile/portal/zj-shop-portal.jar(BOOT-INF/lib/fastjson-1.2.7.jar)
# 解决
后端更代码漏洞
```
