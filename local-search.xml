<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>EMQX集群部署</title>
    <link href="/2025/11/05/EMQX%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/11/05/EMQX%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="emqx–集群"><a href="#emqx–集群" class="headerlink" title="emqx–集群"></a>emqx–集群</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>EMQX（Erlang MQTT Broker）是一个高性能、可扩展的开源 MQTT 消息代理服务器。它基于 Erlang&#x2F;OTP 开发，专为大规模物联网（IoT）应用设计。EMQX 的核心作用和功能如下：</p><ol><li><strong>消息代理</strong>：EMQX 作为 MQTT 消息代理，负责在发布者和订阅者之间路由消息。它支持 MQTT 协议的所有功能，包括 QoS（Quality of Service）级别、持久会话和遗嘱消息等。</li><li><strong>设备连接管理</strong>：EMQX 可以管理大量 IoT 设备的连接，支持数百万级别的并发连接，适用于大规模的物联网应用。</li><li><strong>数据分发</strong>：EMQX 能够高效地分发数据，确保消息在发布者和订阅者之间的快速传递，支持多种消息格式和传输协议。</li><li><strong>扩展性</strong>：EMQX 支持插件机制，用户可以根据需求扩展其功能，如数据持久化、规则引擎、认证和授权等。</li></ol><p><strong>主要功能</strong></p><ol><li><p><strong>支持多种协议</strong></p><ul><li><strong>MQTT&#x2F;MQTT-SN</strong>：原生支持 MQTT 3.1.1 和 MQTT 5.0 协议。</li><li><strong>HTTP&#x2F;HTTPS</strong>：支持通过 HTTP&#x2F;HTTPS 协议进行消息发布和订阅。</li><li><strong>CoAP</strong>：支持 Constrained Application Protocol（CoAP），适用于资源受限的设备。</li><li><strong>WebSocket</strong>：支持通过 WebSocket 进行 MQTT 通信，方便 Web 应用集成。</li></ul></li><li><p><strong>高性能和高可用性</strong></p><ul><li><strong>高并发连接</strong>：支持数百万级别的并发连接，适用于大规模 IoT 部署。</li><li><strong>集群支持</strong>：支持集群部署，提供高可用性和负载均衡。</li><li><strong>水平扩展</strong>：可以通过增加节点来扩展系统容量。</li></ul></li><li><p><strong>安全性</strong></p><ul><li><strong>认证和授权</strong>：支持多种认证方式（如用户名&#x2F;密码、客户端证书、LDAP 等）和细粒度的访问控制。</li><li><strong>加密通信</strong>：支持 TLS&#x2F;SSL 加密，确保数据传输的安全性。</li></ul></li><li><p><strong>规则引擎</strong></p><ul><li><strong>数据处理</strong>：内置规则引擎，可以根据预定义的规则对消息进行处理、过滤和转发。</li><li><strong>集成外部系统</strong>：支持与数据库、消息队列、HTTP 服务等外部系统集成。</li></ul></li><li><p><strong>监控和管理</strong></p><ul><li><strong>管理控制台</strong>：提供友好的 Web 管理控制台，方便用户进行配置和管理。</li><li><strong>监控和告警</strong>：支持实时监控系统状态和性能，提供告警机制。</li></ul></li></ol><p><strong>典型应用场景</strong></p><ol><li><strong>智能家居</strong>：管理和控制大量智能家居设备，实现设备间的消息通信和数据共享。</li><li><strong>工业物联网</strong>：在工业环境中，管理各种传感器和设备的数据采集和传输。</li><li><strong>车联网</strong>：支持车辆与云端的实时通信，管理车辆数据和远程控制。</li><li><strong>智慧城市</strong>：管理城市基础设施（如路灯、交通信号灯、环境监测设备等）的数据通信。</li></ol><h4 id="资源需求"><a href="#资源需求" class="headerlink" title="资源需求"></a>资源需求</h4><ul><li><strong>CPU</strong>: 4 核 </li><li><strong>内存</strong>:  8 GB </li><li><strong>存储</strong>: 300G</li><li><strong>节点</strong>：2</li></ul><h4 id="网络端口"><a href="#网络端口" class="headerlink" title="网络端口"></a>网络端口</h4><ol><li><strong>默认管理端口</strong><ul><li><strong>端口号</strong>: 18083</li><li><strong>用途</strong>: EMQX Dashboard（管理控制台）端口，用于管理和监控 EMQX。</li></ul></li><li><strong>MQTT 端口</strong><ul><li><strong>端口号</strong>: 1883</li><li><strong>用途</strong>: MQTT 协议默认端口，用于客户端连接。</li></ul></li><li><strong>MQTT&#x2F;TLS 端口</strong><ul><li><strong>端口号</strong>: 8883</li><li><strong>用途</strong>: 使用 TLS&#x2F;SSL 加密的 MQTT 连接端口。</li></ul></li><li><strong>WebSocket 端口</strong><ul><li><strong>端口号</strong>: 8083</li><li><strong>用途</strong>: 支持 WebSocket 的 MQTT 连接端口。</li></ul></li><li><strong>WebSocket&#x2F;TLS 端口</strong><ul><li><strong>端口号</strong>: 8084</li><li><strong>用途</strong>: 使用 TLS&#x2F;SSL 加密的 WebSocket 连接端口。</li></ul></li><li><strong>集群通信端口</strong><ul><li><strong>端口号</strong>: 4369, 6000-6999</li><li><strong>用途</strong>: EMQX 集群节点之间的通信端口。</li></ul></li></ol><h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><pre><code class="hljs"># 下载安装包wget https://www.emqx.com/zh/downloads/broker/5.7.0/emqx-5.7.0-el7-amd64.tar.gzmkdir -p /data/emqx/data# 创建目录、解压mkdir -p /data/emqx/data &amp;&amp; tar -zxvf emqx-5.7.0-el7-amd64.tar.gz -C /data/emqx# 编辑配置文件cd /data/emqxvim etc/emqx.conf# 将原有的改为以下内容--在每个节点上添加更改，更后按顺序启动node &#123;  name = &quot;emqx@10.100.40.171&quot;     # 本机IP  cookie = &quot;emqxsecretcookie&quot;  data_dir = &quot;/data/emqx/data&quot;     # 数据存放目录&#125;cluster &#123;  name = emqxcl  discovery_strategy = manual  static &#123;    seeds = [      &quot;emqx@10.100.40.171&quot;,     # 添加集群      &quot;emqx@10.100.40.172&quot;    ]  &#125;&#125;# 启动./emqx/bin/emqx start# 加入集群--在从机器上操作cd /data/emqx./bin/emqx_ctl cluster join emqx@10.100.40.172      # 在从机器上操作，写主节点的IP# 验证--在主机器上操作，查看状态./bin/emqx_ctl cluster status# 验证数据目录路径[root@emqx01 data]# grep &#39;data_dir&#39; /data/emqx/etc/emqx.conf  data_dir = &quot;/data/emqx/data&quot;# 访问10.1.15.101:18083默认账号: admin 默认密码：public10.1.15.102:18083默认账号: admin 默认密码：public</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Minio存储部署</title>
    <link href="/2025/11/05/Minio%E5%AD%98%E5%82%A8%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/11/05/Minio%E5%AD%98%E5%82%A8%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="minio–单节点"><a href="#minio–单节点" class="headerlink" title="minio–单节点"></a>minio–单节点</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>MinIO 是一个高性能的对象存储服务器，兼容 Amazon S3 API。它主要用于存储海量的非结构化数据，如图片、视频、备份文件、日志文件等。MinIO 是开源的，并且设计为云原生应用，适用于私有云、公有云和混合云环境。</p><ol><li><p><strong>对象存储</strong>：</p><ul><li>MinIO 提供了对象存储服务，允许用户存储和检索任意数量的非结构化数据。</li><li>数据以对象的形式存储，每个对象包含文件数据、元数据和唯一的对象标识符。</li></ul></li><li><p><strong>兼容 S3 API</strong>：</p><ul><li>MinIO 兼容 Amazon S3 API，这意味着使用 S3 API 的应用可以无缝迁移到 MinIO。</li><li>支持常用的 S3 操作，如创建桶（bucket）、上传&#x2F;下载对象、设置权限等。</li></ul></li><li><p><strong>高性能</strong>：</p><ul><li>MinIO 设计为高性能对象存储，能够在标准硬件上提供极高的吞吐量和低延迟。</li><li>适用于需要快速数据访问的场景，如实时数据分析、机器学习等。</li></ul></li><li><p><strong>可扩展性</strong>：</p><ul><li>MinIO 支持水平扩展，通过增加节点可以扩展存储容量和处理能力。</li><li>支持分布式部署，适用于大规模存储需求。</li></ul></li><li><p><strong>高可用性</strong>：</p><ul><li>MinIO 提供数据冗余和自动故障恢复，确保数据的高可用性和可靠性。</li><li>支持多副本存储和纠删码（Erasure Coding）技术，防止数据丢失。</li></ul></li><li><p><strong>安全性</strong>：</p><ul><li>MinIO 支持数据加密、访问控制和审计日志，确保数据存储和传输的安全性。</li><li>支持基于角色的访问控制（RBAC）和细粒度的权限管理。</li></ul></li><li><p><strong>多云和混合云支持</strong>：</p><ul><li>MinIO 可以在私有云、公有云和混合云环境中部署，支持跨云的数据管理。</li><li>提供统一的存储接口，简化多云环境中的数据管理。</li></ul></li></ol><h4 id="资源需求"><a href="#资源需求" class="headerlink" title="资源需求"></a>资源需求</h4><ul><li><strong>CPU</strong>: 4 核 </li><li><strong>内存</strong>:  8 GB </li><li><strong>存储</strong>: 4T</li><li><strong>节点</strong>：1</li></ul><h4 id="网络端口"><a href="#网络端口" class="headerlink" title="网络端口"></a>网络端口</h4><ol><li><strong>默认服务端口</strong><ul><li><strong>端口号</strong>: 9000</li><li><strong>用途</strong>: MinIO API 服务端口，用于客户端与 MinIO 服务器的通信。</li></ul></li><li><strong>控制台端口（Console）</strong><ul><li><strong>端口号</strong>: 9001</li><li><strong>用途</strong>: MinIO 控制台（管理界面）端口，用于管理和监控 MinIO。</li></ul></li></ol><h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><pre><code class="hljs"># 下载docker# 下载minio镜像docker pull minio/minio:RELEASE.2024-05-27T19-17-46Z.fips# 创建目录mkdir -p /data/minio/data#启动docker run -d \   --net=host \   --user $(id -u):$(id -g) \   --name minio \   -e &quot;MINIO_ROOT_USER=minioadmin&quot; \   -e &quot;MINIO_ROOT_PASSWORD=minioadmin&quot; \   -v /data/minio/data:/data \   minio/minio:RELEASE.2024-05-27T19-17-46Z.fips server /data --console-address &quot;:9001&quot; --address &quot;:9000&quot;    # 访问：http://10.100.40.212:9001/login 用户名：密码  minioadmin：minioadmin</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>kkFileview文件预览</title>
    <link href="/2025/11/05/kkFileview%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88/"/>
    <url>/2025/11/05/kkFileview%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88/</url>
    
    <content type="html"><![CDATA[<h3 id="kkfileview–单节点"><a href="#kkfileview–单节点" class="headerlink" title="kkfileview–单节点"></a>kkfileview–单节点</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ol><li><strong>文档预览</strong>：<ul><li>支持预览多种文档格式，如 Word（.doc、.docx）、Excel（.xls、.xlsx）、PowerPoint（.ppt、.pptx）、PDF、TXT、图片（.jpg、.png、.gif）等。</li><li>用户无需下载文件即可在浏览器中查看文档内容。</li></ul></li><li><strong>跨平台支持</strong>：<ul><li>兼容多种操作系统和浏览器，用户可以在不同设备上进行文档预览。</li></ul></li><li><strong>集成简单</strong>：<ul><li>提供 RESTful API，方便与其他系统集成，如文件管理系统、内容管理系统（CMS）、企业内部系统等。</li><li>通过简单的 HTTP 请求即可实现文档预览功能。</li></ul></li><li><strong>高性能</strong>：<ul><li>采用高效的文档转换和渲染技术，确保文档预览的速度和质量。</li><li>支持缓存机制，提高文档预览的响应速度。</li></ul></li><li><strong>安全性</strong>：<ul><li>提供多种安全配置选项，如访问控制、数据加密等，确保文档预览过程中的数据安全。</li><li>支持配置白名单，限制只有特定 IP 地址可以访问预览服务。</li></ul></li><li><strong>扩展性</strong>：<ul><li>支持插件机制，用户可以根据需求扩展支持的文档格式和功能。</li><li>提供详细的文档和示例，方便用户进行二次开发和定制。</li></ul></li></ol><h4 id="资源需求"><a href="#资源需求" class="headerlink" title="资源需求"></a>资源需求</h4><ul><li><strong>CPU</strong>: 4 核 </li><li><strong>内存</strong>:  8 GB </li><li><strong>存储</strong>: 4T</li><li><strong>节点</strong>：1</li></ul><h4 id="网络端口"><a href="#网络端口" class="headerlink" title="网络端口"></a>网络端口</h4><ul><li><strong>端口号</strong>: 8012</li><li><strong>用途</strong>: <ul><li><strong>服务监听端口</strong>：<ul><li>KKFileView 作为一个文档预览服务，会在指定的端口上监听 HTTP 请求。默认情况下，许多服务会使用 8080 端口，但为了避免冲突或出于其他配置需求，可以将其设置为 8012。</li></ul></li><li><strong>客户端请求</strong>：<ul><li>客户端（例如浏览器或其他应用程序）需要通过这个端口访问 KKFileView 提供的文档预览服务。例如，用户在浏览器中访问 <code>http://&lt;server-ip&gt;:8012/</code> 来查看文档。</li></ul></li><li><strong>负载均衡和代理</strong>：<ul><li>在一些复杂的部署环境中，8012 端口可能会被配置在负载均衡器或反向代理服务器（如 Nginx 或 Apache）后面，这些服务器会将请求转发到 KKFileView 服务。</li></ul></li></ul></li></ul><h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><h5 id="上传安装包"><a href="#上传安装包" class="headerlink" title="上传安装包"></a>上传安装包</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget  https:<span class="hljs-regexp">//</span>a.xbd666.cn<span class="hljs-regexp">/d/</span>Aliyun<span class="hljs-regexp">/Cloud_computing/</span>Software_package<span class="hljs-regexp">/kkFileView/</span>LibreOffice_7.<span class="hljs-number">1.4</span>_Linux_x86-<span class="hljs-number">64</span>_rpm.tar.gz<br><br>wget  https:<span class="hljs-regexp">//</span>a.xbd666.cn<span class="hljs-regexp">/d/</span>Aliyun<span class="hljs-regexp">/Cloud_computing/</span>Software_package<span class="hljs-regexp">/kkFileView/</span>kkFileView-<span class="hljs-number">4.0</span>.<span class="hljs-number">0</span>.tar.gz<br><br>wget  https:<span class="hljs-regexp">//</span>a.xbd666.cn<span class="hljs-regexp">/d/</span>Aliyun<span class="hljs-regexp">/Cloud_computing/</span>Software_package<span class="hljs-regexp">/JDK/</span>jdk-<span class="hljs-number">11.0</span>.<span class="hljs-number">20</span>_linux-x64_bin.tar.gz<br><br></code></pre></td></tr></table></figure><h5 id="定义主机组"><a href="#定义主机组" class="headerlink" title="定义主机组"></a>定义主机组</h5><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[root@localhost ~]</span># vim kkfile<br><span class="hljs-string">[kkfile]</span><br><span class="hljs-number">10.100.40.254</span><br><br></code></pre></td></tr></table></figure><h5 id="编辑脚本"><a href="#编辑脚本" class="headerlink" title="编辑脚本"></a>编辑脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# vim kkfile.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><br><span class="hljs-comment"># 设置变量</span><br>KKFILEVIEW_DIR=/data/kkFileView<br>LIBREOFFICE_ARCHIVE=/root/LibreOffice_7.1.4_Linux_x86-64_rpm.tar.gz<br>JDK_ARCHIVE=/root/jdk-11.0.20_linux-x64_bin.tar.gz<br>KKFILEVIEW_ARCHIVE=/root/kkFileView-4.0.0.tar.gz<br>JAVA_HOME_DIR=/usr/local/java<br><br><br><span class="hljs-comment"># 创建目录</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$KKFILEVIEW_DIR</span><br><br><br><span class="hljs-comment"># 解压 LibreOffice</span><br>tar xzf <span class="hljs-variable">$LIBREOFFICE_ARCHIVE</span> -C <span class="hljs-variable">$KKFILEVIEW_DIR</span><br><br><br><span class="hljs-comment"># 解压 JDK</span><br>tar xzf <span class="hljs-variable">$JDK_ARCHIVE</span> -C /usr/local<br><br><br><span class="hljs-comment"># 更名</span><br><span class="hljs-built_in">mv</span> /usr/local/jdk-11.0.20 <span class="hljs-variable">$JAVA_HOME_DIR</span><br><br><br><span class="hljs-comment"># 配置环境变量</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">JAVA_HOME=$JAVA_HOME_DIR</span><br><span class="hljs-string">PATH=&quot;\$JAVA_HOME/bin:\$PATH&quot;</span><br><span class="hljs-string">export JAVA_HOME PATH</span><br><span class="hljs-string">EOF</span><br><br><br><span class="hljs-comment"># 变量生效</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br><br><span class="hljs-comment"># 安装 LibreOffice 依赖包</span><br>yum install -y <span class="hljs-variable">$KKFILEVIEW_DIR</span>/LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS/*.rpm<br><br><br><span class="hljs-comment"># 安装其他依赖库</span><br>yum -y install cairo<br>yum -y install cups-libs<br>yum -y install libSM<br><br><br><span class="hljs-comment"># 验证库文件</span><br><span class="hljs-keyword">if</span> [ ! -f /usr/lib64/libcairo.so.2 ] || [ ! -f /usr/lib64/libcups.so.2 ] || [ ! -f /usr/lib64/libSM.so.6 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;One or more library files are missing. Exiting...&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><br><span class="hljs-comment"># 更新库缓存</span><br>ldconfig<br><br><br><span class="hljs-comment"># 查看 LibreOffice 版本</span><br>/opt/libreoffice7.1/program/soffice --version<br><br><br><span class="hljs-comment"># 解压 kkFileView</span><br>tar xzf <span class="hljs-variable">$KKFILEVIEW_ARCHIVE</span> -C <span class="hljs-variable">$KKFILEVIEW_DIR</span><br><br><br><span class="hljs-comment"># 修改配置文件</span><br>sed -i <span class="hljs-string">&#x27;s|office.home=.*|office.home=/opt/libreoffice7.1|g&#x27;</span> <span class="hljs-variable">$KKFILEVIEW_DIR</span>/kkFileView-4.0.0/config/application.properties<br>sed -i <span class="hljs-string">&#x27;s|office.plugin.server.ports=.*|office.plugin.server.ports=2001,2002|g&#x27;</span> <span class="hljs-variable">$KKFILEVIEW_DIR</span>/kkFileView-4.0.0/config/application.properties<br><br><br><span class="hljs-comment"># 查出所有 office 进程并杀掉</span><br>pkill -f office<br><br><br><span class="hljs-built_in">sleep</span> 5<br><br><br><span class="hljs-comment"># 启动 kkFileView</span><br><span class="hljs-variable">$KKFILEVIEW_DIR</span>/kkFileView-4.0.0/bin/startup.sh<br><br></code></pre></td></tr></table></figure><h5 id="拷贝至目标主机"><a href="#拷贝至目标主机" class="headerlink" title="拷贝至目标主机"></a>拷贝至目标主机</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@localhost</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim kkfile.yaml</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">kkfileview</span> <span class="hljs-string">cluster</span><br>  <span class="hljs-attr">hosts:</span> <span class="hljs-string">kkfile</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">kkfileview</span> <span class="hljs-string">tarball</span> <span class="hljs-string">to</span> <span class="hljs-string">target</span> <span class="hljs-string">hosts</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/root/LibreOffice_7.1.4_Linux_x86-64_rpm.tar.gz</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/root/LibreOffice_7.1.4_Linux_x86-64_rpm.tar.gz</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">kkfileview</span> <span class="hljs-string">tarball</span> <span class="hljs-string">to</span> <span class="hljs-string">target</span> <span class="hljs-string">hosts</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/root/jdk-11.0.20_linux-x64_bin.tar.gz</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/root/jdk-11.0.20_linux-x64_bin.tar.gz</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">kkfileview</span> <span class="hljs-string">tarball</span> <span class="hljs-string">to</span> <span class="hljs-string">target</span> <span class="hljs-string">hosts</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/root/kkFileView-4.0.0.tar.gz</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/root/kkFileView-4.0.0.tar.gz</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">kkfileview</span> <span class="hljs-string">tarball</span> <span class="hljs-string">to</span> <span class="hljs-string">target</span> <span class="hljs-string">hosts</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/root/kkfile.sh</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/root/kkfile.sh</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;0755&#x27;</span><br><br></code></pre></td></tr></table></figure><h5 id="执行传输"><a href="#执行传输" class="headerlink" title="执行传输"></a>执行传输</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># ansible-playbook -i /root/kkfile  kkfile.yaml</span><br></code></pre></td></tr></table></figure><h5 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># ansible -i /root/kkfile kkfile -m shell -a <span class="hljs-string">&#x27;/root/kkfile.sh&#x27;</span></span><br></code></pre></td></tr></table></figure><h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><pre><code class="hljs">http:// IP + 8012</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>RocketMQ消息队列</title>
    <link href="/2025/11/05/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    <url>/2025/11/05/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h3 id="RocketMQ–集群"><a href="#RocketMQ–集群" class="headerlink" title="RocketMQ–集群"></a>RocketMQ–集群</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>Apache RocketMQ 是一个分布式消息中间件，主要用于消息的发布与订阅（Pub&#x2F;Sub）和消息队列（Message Queue）模式。它在高性能、高可靠性和高可扩展性方面有着显著的优势。以下是 RocketMQ 的主要作用和应用场景：</p><ol><li><strong>消息发布与订阅（Pub&#x2F;Sub）</strong>：<ul><li>RocketMQ 支持发布&#x2F;订阅模式，允许消息生产者将消息发布到一个主题（Topic），然后多个消费者可以订阅这个主题以接收消息。这种模式适用于广播消息和事件通知。</li></ul></li><li><strong>消息队列（Message Queue）</strong>：<ul><li>在消息队列模式下，消息生产者将消息发送到队列，消费者从队列中读取并处理消息。消息队列模式适用于任务分发和负载均衡。</li></ul></li><li><strong>异步通信</strong>：<ul><li>RocketMQ 支持异步消息传递，允许系统组件之间进行松耦合的通信，从而提高系统的响应速度和处理能力。</li></ul></li><li><strong>削峰填谷</strong>：<ul><li>在高并发场景下，RocketMQ 可以通过消息队列的缓冲作用来平滑流量，防止系统在短时间内被大量请求压垮。</li></ul></li><li><strong>事件驱动架构</strong>：<ul><li>RocketMQ 支持事件驱动架构，系统可以通过事件通知机制来触发后续操作，实现松耦合的系统设计。</li></ul></li><li><strong>数据同步</strong>：<ul><li>RocketMQ 可以用于分布式系统中的数据同步，确保不同系统或组件之间的数据一致性。</li></ul></li></ol><h4 id="资源需求"><a href="#资源需求" class="headerlink" title="资源需求"></a>资源需求</h4><ul><li><strong>CPU</strong>: 4 核 </li><li><strong>内存</strong>:  8 GB </li><li><strong>存储</strong>: 100G</li><li><strong>节点</strong>：2</li></ul><h4 id="网络端口"><a href="#网络端口" class="headerlink" title="网络端口"></a>网络端口</h4><ol><li><strong>Nameserver 端口</strong>：<ul><li>默认端口：9876</li><li>用于 Nameserver 服务，负责管理和发现 Broker。</li></ul></li><li><strong>Broker 端口</strong>：<ul><li>默认端口：10911</li><li>用于 Broker 服务，负责消息存储和转发。</li></ul></li><li><strong>Broker HA 端口</strong>：<ul><li>默认端口：10912</li><li>用于 Broker 高可用（HA）复制。</li></ul></li><li><strong>Console 端口</strong>（可选）：<ul><li>默认端口：8080</li><li>用于 RocketMQ 控制台管理界面。</li></ul></li></ol><h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><pre><code class="服务器">10.1.15.10610.1.11.10310.1.11.1043台机器都操作#下载安装包wget https://archive.apache.org/dist/rocketmq/4.8.0/rocketmq-all-4.8.0-bin-release.zipjdk 1.8mkdir -p /data/rocketmqchmod -R 755 /data/rocketmq#添加环境变量JAVA_HOME=/usr/local/javaJRE_HOME=/usr/local/java/jreexport CLASSPATH=.:\$JAVA_HOME/jre/lib:\$JAVA_HOME/lib:\$JAVA_HOME/lib/tools.jarROCKETMQ_HOME=/data/rocketmq/rocketmq-4.8PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$ROCKETMQ_HOME/binexport JAVA_HOME JRE_HOME CLASS_PATH PATH ROCKETMQ_HOME#环境生效source /etc/porfilecd /data/rocketmq#解压upzip rocketmq-all-4.8.0-bin-release.zip#修改文件夹mv rocketmq-all-4.8.0-bin-release rocketmq-4.8#创建日志目录mkdir logs10.1.15.106--nameserver#编写脚本[root@minio rocketmq]# cat start.sh#!/bin/bashJAVA_HOME=/usr/local/javaROCKETMQ_HOME=/data/rocketmq/rocketmq-4.8JAVA_OPT=&quot;-server -Xms4g -Xmx4g -Xmn2g -XX:+UseConcMarkSweepGC&quot;# 将 lib 目录中的所有 JAR 文件添加到 CLASSPATH 中CLASSPATH=$(find $&#123;ROCKETMQ_HOME&#125;/lib -name &#39;*.jar&#39; | tr &#39;\n&#39; &#39;:&#39;)JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -classpath $&#123;CLASSPATH&#125;&quot;java $&#123;JAVA_OPT&#125; org.apache.rocketmq.namesrv.NamesrvStartup -n 10.1.15.106:9876#启动脚本chmod +x start.shnohup ./start.sh &amp;10.1.11.103部署broker机器A配置#创建文件夹store,store-s（store-a：master数据存储文件夹，store-b-s:salve数据存储文件夹）mkdir /data/rocket/rocketmq-4.8/store-a#机器A上修改master的broker-a.properties配置文件cd /data/rocket/rocketmq-5.2/conf/2m-2s-asyncvim broker-a.properties配置内容如下面：# 集群名称,这里要master和slave保持一样brokerClusterName=cjsCluster# broker名字brokerName=broker-a#0 表示 Master，&gt;0 表示 SlavebrokerId=0#删除文件时间点，默认凌晨 4点deleteWhen=04#文件保留时间，默认48小时，这里设置5天fileReservedTime=120#Broker 的角色 - ASYNC_MASTER 异步复制MasterbrokerRole=ASYNC_MASTER#刷盘方式 - ASYNC_FLUSH 异步刷盘flushDiskType=ASYNC_FLUSH#开启账号密码连接，需要配置plain_acl.yml文件里面的账号密码用于连接aclEnable=false # Broker 对外服务的监听端口listenPort=10911# nameserver地址，分号分割namesrvAddr=10.1.15.106:9876#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数defaultTopicQueueNums=4#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭autoCreateTopicEnable=true#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭autoCreateSubscriptionGroup=true#本机IPbrokerIP1=10.1.11.103storePathRootDir=/data/rocketmq/rocketmq-4.8/store-astorePathCommitLog=/data/rocketmq/rocketmq-4.8/store-a/commitlog#消费队列存储路径存储路径storePathConsumerQueue=/data/rocketmq/rocketmq-4.8/store-a/consumequeue#消息索引存储路径storePathIndex=/data/rocketmq/rocketmq-4.8/store-a/index#checkpoint 文件存储路径storeCheckpoint=/data/rocketmq/rocketmq-4.8/store-a/checkpoint#abort文件存储路径abortFile=/data/rocketmq/rocketmq-4.8/store-a/abort# commitLog每个文件的大小默认1GmapedFileSizeCommitLog=1073741824#ConsumeQueue每个文件默认存30W条，根据业务情况调整mapedFileSizeConsumeQueue=30000010.1.11.104机器B上修改slave的broker-a-slave.properties配置文件mkdir -p /data/rocketmq/rocketmq-4.8/store-a-scd /data/rocket/rocketmq-4.8/conf/2m-2s-asyncvim broker-a-s.properties配置内容如下：# 集群名称brokerClusterName=cjsCluster# broker名字brokerName=broker-a#0 表示 Master，&gt;0 表示 SlavebrokerId=1#删除文件时间点，默认凌晨 4点deleteWhen=04#文件保留时间，默认 48 小时，这里设置5天fileReservedTime=120brokerRole=SLAVEflushDiskType=ASYNC_FLUSH#开启账号密码连接aclEnable=false # Broker 对外服务的监听端口listenPort=10922# nameserver地址，分号分割namesrvAddr=10.1.15.106:9876#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数defaultTopicQueueNums=4#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭autoCreateTopicEnable=true#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭autoCreateSubscriptionGroup=true#master的IPmasterAddress=10.1.11.103storePathRootDir=/data/rocketmq/rocketmq-4.8/store-a-sstorePathCommitLog=/data/rocketmq/rocketmq-4.8/store-a-s/commitlog#消费队列存储路径存储路径storePathConsumerQueue=/data/rocketmq/rocketmq-4.8/store-a-s/consumequeue#消息索引存储路径storePathIndex=/data/rocketmq/rocketmq-4.8/store-a-s/index#checkpoint 文件存储路径storeCheckpoint=/data/rocketmq/rocketmq-4.8/store-a-s/checkpoint#abort文件存储路径abortFile=/data/rocketmq/rocketmq-4.8/store-a-s/abort# commitLog每个文件的大小默认1GmapedFileSizeCommitLog=1073741824#ConsumeQueue每个文件默认存30W条，根据业务情况调整mapedFileSizeConsumeQueue=300000#机器A上编写启动文件  [root@rocketmq01 rocketmq]# cat mqbrokerStart-a.sh#!/bin/shcd /data/rocketmq/rocketmq-4.8/binnohup sh mqbroker -c /data/rocketmq/rocketmq-4.8/conf/2m-2s-async/broker-a.properties &gt; /data/rocketmq/logs/broker-a.log 2&gt;&amp;1 &amp;#slave启动文件mqbrokerStart-a-s.sh内容如下编写vim mqbrokerStart-a-s.sh#!/bin/sh cd /data/rocketmq/rocketmq-4.8/bin nohup sh mqbroker -c /data/rocketmq/rocketmq-4.8/conf/2m-2s-async/broker-a-s.properties &gt; /data/rocketmq/logs/broker-a-s.log 2&gt;&amp;1 &amp; exit#给与权限chmod +x mqbrokerStart-a.shchmod +x mqbrokerStart-a-s.sh启动broker--按顺序启动机器A上启动master：broker-acd /data/rocketmq./mqbrokerStart-a.sh机器B上启动slave：broker-a-scd /data/rocketmq./mqbrokerStart-a-s.sh#验证机器信息cd /data/rocketmq/rocketmq-4.8/bin/./mqadmin clusterList -n 10.1.15.106:9876</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ansible部署mysql主从</title>
    <link href="/2025/11/05/ansible%E9%83%A8%E7%BD%B2mysql%E4%B8%BB%E4%BB%8E/"/>
    <url>/2025/11/05/ansible%E9%83%A8%E7%BD%B2mysql%E4%B8%BB%E4%BB%8E/</url>
    
    <content type="html"><![CDATA[<h3 id="MySQL主从"><a href="#MySQL主从" class="headerlink" title="MySQL主从"></a>MySQL主从</h3><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p>MySQL 是一种开源的关系数据库管理系统（RDBMS），广泛用于各种应用场景。以下是 MySQL 的主要作用和用途：</p><ol><li><p><strong>数据存储和管理</strong>:</p><ul><li>MySQL 用于存储和管理大量结构化数据。它支持多种数据类型和复杂的查询操作，适合处理各种业务数据。</li></ul></li><li><p><strong>Web 应用程序</strong>:</p><ul><li>MySQL 是许多 Web 应用程序的后端数据库，尤其是与 PHP 结合使用。常见的内容管理系统（CMS）如 WordPress、Joomla 和 Drupal 都依赖 MySQL。</li></ul></li><li><p><strong>电子商务</strong>:</p><ul><li>电子商务平台如 Magento、WooCommerce 和 Shopify 使用 MySQL 来管理产品信息、订单、客户数据等。</li></ul></li><li><p><strong>数据分析</strong>:</p><ul><li>MySQL 可以用于数据分析和商业智能（BI），通过与工具如 Tableau、Power BI 和 Excel 集成，帮助企业做出数据驱动的决策。</li></ul></li><li><p><strong>企业应用</strong>:</p><ul><li>企业资源计划（ERP）、客户关系管理（CRM）和其他企业级应用程序常常使用 MySQL 作为其数据库后端。</li></ul></li><li><p><strong>高可用性和扩展性</strong>:</p><ul><li>MySQL 支持复制和集群功能，可以实现高可用性和扩展性，满足大规模应用的需求。</li></ul></li><li><p><strong>开发和测试</strong>:</p><ul><li>开发人员使用 MySQL 进行应用程序开发和测试，得益于其易用性和广泛的社区支持。</li></ul></li><li><p><strong>数据备份和恢复</strong>:</p><ul><li>MySQL 提供多种数据备份和恢复工具，确保数据安全和完整性。</li></ul></li><li><p><strong>支持多种编程语言</strong>:</p><ul><li>MySQL 支持多种编程语言，如 Java、Python、PHP、C++ 等，方便开发者集成和使用。</li></ul></li><li><p><strong>开源和社区支持</strong>:</p><ul><li>作为开源软件，MySQL 拥有庞大的用户社区，提供丰富的资源、插件和扩展，用户可以根据需要进行定制和优化。</li></ul></li></ol><p>MySQL 的广泛应用和灵活性使其成为许多企业和开发者的首选数据库管理系统。</p><h4 id="资源需求："><a href="#资源需求：" class="headerlink" title="资源需求："></a>资源需求：</h4><ul><li><strong>CPU</strong>: 4核 </li><li><strong>内存</strong>:  8GB </li><li><strong>存储</strong>: 1T</li><li><strong>节点</strong>：2</li></ul><h4 id="网络端口"><a href="#网络端口" class="headerlink" title="网络端口:"></a>网络端口:</h4><p><strong>默认端口</strong></p><ul><li><strong>MySQL 端口</strong>：3306</li><li><strong>用途：</strong><ul><li><strong>客户端连接</strong>：<ul><li>MySQL 客户端（如 <code>mysql</code> 命令行工具、MySQL Workbench、各种编程语言的 MySQL 驱动等）使用端口 3306 连接到 MySQL 服务器进行数据库操作，如查询、插入、更新和删除数据。</li></ul></li><li><strong>应用程序连接</strong>：<ul><li>各种应用程序（如 Web 应用、企业应用、数据分析工具等）通过端口 3306 连接到 MySQL 服务器，以访问和操作存储在数据库中的数据。</li></ul></li><li><strong>数据库管理工具</strong>：<ul><li>数据库管理工具（如 phpMyAdmin、Adminer、HeidiSQL 等）通过端口 3306 连接到 MySQL 服务器，提供图形化的数据库管理界面，方便用户进行数据库管理和维护。</li></ul></li></ul></li></ul><h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><h5 id="定义主机组"><a href="#定义主机组" class="headerlink" title="定义主机组"></a>定义主机组</h5><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">[root@localhost ~]<span class="hljs-comment"># vim inventory.ini </span><br>[mysql_master]<br><span class="hljs-keyword">master</span> <span class="hljs-title">ansible_host</span>=<span class="hljs-number">10.100</span>.<span class="hljs-number">40.251</span><br><br><br>[mysql_slave]<br><span class="hljs-literal">slave</span> <span class="hljs-attr">ansible_host=</span><span class="hljs-number">10.100</span>.<span class="hljs-number">40.252</span><br><br></code></pre></td></tr></table></figure><h5 id="设置主机组"><a href="#设置主机组" class="headerlink" title="设置主机组"></a>设置主机组</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># vim ansible.cfg </span><br><span class="hljs-section">[defaults]</span><br><span class="hljs-attr">inventory</span> = ./inventory.ini<br></code></pre></td></tr></table></figure><h5 id="编写剧本"><a href="#编写剧本" class="headerlink" title="编写剧本"></a>编写剧本</h5><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs nix">[root@localhost ~]<span class="hljs-comment"># vim mysql_cluster.yaml </span><br><span class="hljs-operator">-</span>--<br><span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install and configure MySQL master-slave replication<br>  <span class="hljs-params">hosts:</span> all<br>  <span class="hljs-params">become:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-params">gather_facts:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-params">vars:</span><br>    <span class="hljs-params">mysql_pass:</span> <span class="hljs-string">&quot;Kunyue@123&quot;</span><br>    <span class="hljs-params">repl_password:</span> <span class="hljs-string">&quot;Kunyue@123&quot;</span><br>    <span class="hljs-params">master_ip:</span> <span class="hljs-string">&quot;10.100.40.251&quot;</span><br>    <span class="hljs-params">mysql_repo_url:</span> <span class="hljs-string">&quot;https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-5.7-community-el7-x86_64/&quot;</span><br>    <span class="hljs-params">mysql_gpg_key_url:</span> <span class="hljs-string">&quot;https://mirrors.ustc.edu.cn/mysql-repo/RPM-GPG-KEY-mysql&quot;</span><br>    <span class="hljs-params">is_master:</span> <span class="hljs-string">&quot;&#123;&#123; inventory_hostname == &#x27;master&#x27; &#125;&#125;&quot;</span><br>    <span class="hljs-params">temp_password:</span> <span class="hljs-string">&quot;&quot;</span><br><br><br>  <span class="hljs-params">tasks:</span><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Ensure Python <span class="hljs-number">2</span> is installed<br>      <span class="hljs-params">yum:</span><br>        <span class="hljs-params">name:</span> python2<br>        <span class="hljs-params">state:</span> present<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Ensure pip for Python <span class="hljs-number">2</span> is installed<br>      <span class="hljs-params">get_url:</span><br>        <span class="hljs-params">url:</span> https:<span class="hljs-symbol">//bootstrap.pypa.io/pip/2.7/get-pip.py</span><br>        <span class="hljs-params">dest:</span> <span class="hljs-symbol">/tmp/get-pip.py</span><br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install pip for Python <span class="hljs-number">2</span><br>      <span class="hljs-params">command:</span> python2 <span class="hljs-symbol">/tmp/get-pip.py</span><br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install MySQL repository<br>      <span class="hljs-params">yum_repository:</span><br>        <span class="hljs-params">name:</span> mysql<br>        <span class="hljs-params">description:</span> MySQL Community Edition<br>        <span class="hljs-params">baseurl:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_repo_url &#125;&#125;&quot;</span><br>        <span class="hljs-params">gpgcheck:</span> no<br>        <span class="hljs-params">enabled:</span> yes<br>        <span class="hljs-params">gpgkey:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_gpg_key_url &#125;&#125;&quot;</span><br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install MySQL packages<br>      <span class="hljs-params">yum:</span><br>        <span class="hljs-params">name:</span> mysql-community-server<br>        <span class="hljs-params">state:</span> present<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install setuptools for Python <span class="hljs-number">2</span><br>      <span class="hljs-params">yum:</span><br>        <span class="hljs-params">name:</span> python-setuptools<br>        <span class="hljs-params">state:</span> present<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Install PyMySQL using pip for Python <span class="hljs-number">2</span><br>      <span class="hljs-params">pip:</span><br>        <span class="hljs-params">name:</span> PyMySQL<br>        <span class="hljs-params">executable:</span> pip2<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Start MySQL service<br>      <span class="hljs-params">service:</span><br>        <span class="hljs-params">name:</span> mysqld<br>        <span class="hljs-params">state:</span> started<br>        <span class="hljs-params">enabled:</span> yes<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Get temporary MySQL root password<br>      <span class="hljs-params">shell:</span> grep &#x27;temporary password&#x27; <span class="hljs-symbol">/var/log/mysqld.log</span> | awk &#x27;&#123;print $NF&#125;&#x27;<br>      <span class="hljs-params">register:</span> temp_password<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Reset MySQL root password and handle expired password<br>      <span class="hljs-params">command:</span> <span class="hljs-operator">&gt;</span><br>        mysql <span class="hljs-operator">-</span>-connect-expired-password <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p&#123;&#123; temp_password.stdout &#125;&#125; <span class="hljs-operator">-</span>e <span class="hljs-string">&quot;ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;&#123;&#123; mysql_pass &#125;&#125;&#x27;;&quot;</span><br>      <span class="hljs-params">ignore_errors:</span> yes<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Restart MySQL service<br>      <span class="hljs-params">service:</span><br>        <span class="hljs-params">name:</span> mysqld<br>        <span class="hljs-params">state:</span> restarted<br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Configure MySQL master<br>      <span class="hljs-params">when:</span> is_master<br>      <span class="hljs-params">block:</span><br>        <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Add MySQL configuration for master<br>          <span class="hljs-params">lineinfile:</span><br>            <span class="hljs-params">path:</span> <span class="hljs-symbol">/etc/my.cnf</span><br>            <span class="hljs-params">regexp:</span> &#x27;^log-bin&#x27;<br>            <span class="hljs-params">line:</span> |<br>              <span class="hljs-attr">log-bin</span><span class="hljs-operator">=</span><span class="hljs-symbol">/var/lib/mysql/master</span><br>              <span class="hljs-attr">server-id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br>              <span class="hljs-attr">gtid_mode</span><span class="hljs-operator">=</span>ON<br>              <span class="hljs-attr">enforce_gtid_consistency</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br>          <span class="hljs-params">notify:</span> restart mysql<br><br><br>        <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Create replication user on master<br>          <span class="hljs-params">mysql_user:</span><br>            <span class="hljs-params">login_user:</span> root<br>            <span class="hljs-params">login_password:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_pass &#125;&#125;&quot;</span><br>            <span class="hljs-params">name:</span> slave<br>            <span class="hljs-params">password:</span> <span class="hljs-string">&quot;&#123;&#123; repl_password &#125;&#125;&quot;</span><br>            <span class="hljs-params">priv:</span> <span class="hljs-string">&quot;*.*:REPLICATION SLAVE,SUPER,RELOAD&quot;</span><br>            <span class="hljs-params">host:</span> <span class="hljs-string">&quot;%&quot;</span><br>          <span class="hljs-params">environment:</span><br>            <span class="hljs-params">MYSQL_PWD:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_pass &#125;&#125;&quot;</span><br><br><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Configure MySQL slave<br>      <span class="hljs-params">when:</span> not is_master<br>      <span class="hljs-params">block:</span><br>        <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Add MySQL configuration for slave<br>          <span class="hljs-params">lineinfile:</span><br>            <span class="hljs-params">path:</span> <span class="hljs-symbol">/etc/my.cnf</span><br>            <span class="hljs-params">regexp:</span> &#x27;^log-bin&#x27;<br>            <span class="hljs-params">line:</span> |<br>              <span class="hljs-attr">log-bin</span><span class="hljs-operator">=</span><span class="hljs-symbol">/var/lib/mysql/slave</span><br>              <span class="hljs-attr">server-id</span><span class="hljs-operator">=</span><span class="hljs-number">2</span><br>              <span class="hljs-attr">gtid_mode</span><span class="hljs-operator">=</span>ON<br>              <span class="hljs-attr">enforce_gtid_consistency</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br>          <span class="hljs-params">notify:</span> restart mysql<br><br><br>        <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Restart MySQL service<br>          <span class="hljs-params">service:</span><br>            <span class="hljs-params">name:</span> mysqld<br>            <span class="hljs-params">state:</span> restarted<br><br><br>        <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> Set master info and start replication on slave<br>          <span class="hljs-params">mysql_replication:</span><br>            <span class="hljs-params">login_user:</span> root<br>            <span class="hljs-params">login_password:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_pass &#125;&#125;&quot;</span><br>            <span class="hljs-params">mode:</span> changemaster<br>            <span class="hljs-params">master_host:</span> <span class="hljs-string">&quot;&#123;&#123; master_ip &#125;&#125;&quot;</span><br>            <span class="hljs-params">master_user:</span> slave<br>            <span class="hljs-params">master_password:</span> <span class="hljs-string">&quot;&#123;&#123; repl_password &#125;&#125;&quot;</span><br>            <span class="hljs-params">master_auto_position:</span> yes<br>          <span class="hljs-params">environment:</span><br>            <span class="hljs-params">MYSQL_PWD:</span> <span class="hljs-string">&quot;&#123;&#123; mysql_pass &#125;&#125;&quot;</span><br><br><br>  <span class="hljs-params">handlers:</span><br>    <span class="hljs-operator">-</span> <span class="hljs-params">name:</span> restart mysql<br>      <span class="hljs-params">service:</span><br>        <span class="hljs-params">name:</span> mysqld<br>        <span class="hljs-params">state:</span> restarted<br><br></code></pre></td></tr></table></figure><h5 id="执行剧本"><a href="#执行剧本" class="headerlink" title="执行剧本"></a>执行剧本</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># ansible-playbook -i inventory.ini mysql_cluster.yaml</span><br></code></pre></td></tr></table></figure><h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">mysql -uroot -p<span class="hljs-string">&#x27;密码&#x27;</span><br><br><span class="hljs-keyword">show</span> slave status \G<br></code></pre></td></tr></table></figure><h5 id="更改存储目录"><a href="#更改存储目录" class="headerlink" title="更改存储目录"></a>更改存储目录</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># 停止MySQL<br>systemctl stop mysqld<br>mkdir -p /data/mysql/data<br>chown -R mysql:mysql /data/mysql<br>chmod -R  <span class="hljs-number">755</span> /data/mysql<br><br>vim /etc/my.cnf<br>datadir=/data/mysql/data#更改位置<br>#启动<br>systemctl <span class="hljs-keyword">start</span> mysqld<br>#更改密码<br>cat /var/<span class="hljs-keyword">log</span>/mysqld.<span class="hljs-keyword">log</span> |grep <span class="hljs-keyword">password</span><br><br>#验证目录位置<br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;datadir&#x27;</span>;<br><br><br># 设置主从<br><span class="hljs-string">&#x27;先对时间&#x27;</span><br>firewalld selinux //关闭<br>vim /etc/hosts//hosts解析 可选项<br><span class="hljs-number">192.168</span><span class="hljs-number">.116</span><span class="hljs-number">.111</span>master<br><span class="hljs-number">192.168</span><span class="hljs-number">.116</span><span class="hljs-number">.124</span>slave<br><br>完全备份,保持两台mysql数据一样<br>scp -r /xtrabackup/<span class="hljs-keyword">full</span>/<span class="hljs-number">2023</span><span class="hljs-number">-11</span><span class="hljs-number">-10</span>_14<span class="hljs-number">-18</span><span class="hljs-number">-09</span>/ root@<span class="hljs-number">192.168</span><span class="hljs-number">.116</span><span class="hljs-number">.124</span>:/<br><br>ping一下网络连接： ping master<br> ping slave<br>实验示例：<br><span class="hljs-string">&#x27;主&#x27;</span>：<br>vim /etc/my.cnf<br><span class="hljs-keyword">log</span>-bin=/var/lib/mysql/master<br><span class="hljs-keyword">server</span>-id=<span class="hljs-number">1</span> //ID号需要跟从的配置不一样<br>gtid_mode=<span class="hljs-keyword">ON</span><br>enforce_gtid_consistency=<span class="hljs-number">1</span><br><br># 进入MySQL里面<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">replication</span> slave,super,reload <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> slave@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;Qingfeng123!&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br><br><span class="hljs-string">&#x27;从&#x27;</span>：<br>vim /etc/my.cnf<br><span class="hljs-keyword">log</span>-bin=/var/lib/mysql/slave<br><span class="hljs-keyword">server</span>-id=<span class="hljs-number">2</span> //ID号需要跟主的配置不一样<br>gtid_mode=<span class="hljs-keyword">ON</span><br>enforce_gtid_consistency=<span class="hljs-number">1</span><br><br># master_host=<span class="hljs-string">&#x27;master&#x27;</span><br># 如果没有hosts没有解析，解析ip，已经解析了就写master<br>change master <span class="hljs-keyword">to</span> master_host=<span class="hljs-string">&#x27;master&#x27;</span>,master_user=<span class="hljs-string">&#x27;slave&#x27;</span>,master_password=<span class="hljs-string">&#x27;Qingfeng@123&#x27;</span>,master_auto_position=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">start</span> slave;<br><span class="hljs-keyword">show</span> slave status\G<br><br><span class="hljs-string">&#x27;互为主从&#x27;</span><br>从：<span class="hljs-keyword">grant</span> <span class="hljs-keyword">replication</span> slave,super,reload <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> slave@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;Qingfeng123!&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br>主:change master <span class="hljs-keyword">to</span> master_host=<span class="hljs-string">&#x27;slave&#x27;</span>,master_user=<span class="hljs-string">&#x27;slave&#x27;</span>,master_password=<span class="hljs-string">&#x27;Qingfeng@123&#x27;</span>,master_auto_position=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">start</span> slave;<br><span class="hljs-keyword">show</span> slave status\G<br>验证：<br>主上写数据<br>从上面读数据<br></code></pre></td></tr></table></figure><h5 id="设置主从"><a href="#设置主从" class="headerlink" title="设置主从"></a>设置主从</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># 主节点<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">replication</span> slave,super,reload <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> slave@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br><br>#从节点<br>change master <span class="hljs-keyword">to</span> master_host=<span class="hljs-string">&#x27;10.100.40.171&#x27;</span>,master_user=<span class="hljs-string">&#x27;slave&#x27;</span>,master_password=<span class="hljs-string">&#x27;123456&#x27;</span>,master_auto_position=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">start</span> slave;<br><span class="hljs-keyword">show</span> slave status\G<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>项目前期准备</title>
    <link href="/2025/11/05/%E9%A1%B9%E7%9B%AE%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/"/>
    <url>/2025/11/05/%E9%A1%B9%E7%9B%AE%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<h2 id="前期环境准备"><a href="#前期环境准备" class="headerlink" title="前期环境准备"></a>前期环境准备</h2><h3 id="环境基于ansible剧本"><a href="#环境基于ansible剧本" class="headerlink" title="环境基于ansible剧本"></a>环境基于ansible剧本</h3><h4 id="主要作用"><a href="#主要作用" class="headerlink" title="主要作用"></a><strong>主要作用</strong></h4><ol><li><strong>配置管理</strong>：<ul><li>Ansible 可以自动化地配置和管理服务器的状态，包括安装软件包、配置文件管理、用户和权限设置等。</li></ul></li><li><strong>应用程序部署</strong>：<ul><li>Ansible 可以自动化地部署应用程序，从代码库的拉取、依赖安装到应用程序的启动和配置，简化了复杂的部署过程。</li></ul></li><li><strong>任务自动化</strong>：<ul><li>Ansible 可以自动化日常运维任务，如备份、日志轮转、监控配置等，减少人为错误，提高工作效率。</li></ul></li><li><strong>多平台支持</strong>：<ul><li>Ansible 支持多种操作系统和云平台，包括 Linux、Windows、macOS，以及 AWS、Azure、GCP 等云服务提供商。</li></ul></li><li><strong>无代理架构</strong>：<ul><li>Ansible 通过 SSH 连接到目标节点，无需在目标节点上安装任何代理软件，简化了管理和维护。</li></ul></li><li><strong>编排</strong>：<ul><li>Ansible 可以编排复杂的 IT 任务，跨多个系统和环境执行一系列步骤，确保任务按顺序执行并保持一致性。</li></ul></li></ol><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> epel*<br>yum -y <span class="hljs-keyword">install</span> ansible<br></code></pre></td></tr></table></figure><h3 id="免密"><a href="#免密" class="headerlink" title="免密"></a>免密</h3><h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><ul><li><strong>日志和审计</strong>：<ul><li>一致的时间戳对于日志记录和审计是至关重要的。不同服务器上的日志条目需要统一的时间基准，方便事件的追踪和问题的排查。</li></ul></li><li><strong>数据一致性</strong>：<ul><li>分布式系统和数据库集群依赖于精确的时间同步来确保数据一致性。例如，事务处理和数据复制需要准确的时间戳。</li></ul></li><li><strong>安全性</strong>：<ul><li>许多安全协议和认证机制依赖于准确的时间。例如，Kerberos 认证协议使用时间戳来防止重放攻击。</li></ul></li><li><strong>调度和自动化任务</strong>：<ul><li>计划任务（如 cron 作业）和自动化脚本依赖于系统时间来按预定时间执行。如果时间不同步，可能导致任务执行失败或错过执行时间。</li></ul></li><li><strong>网络协议</strong>：<ul><li>一些网络协议（如 NTP、TLS）需要准确的时间来确保正确的操作和安全性。</li></ul></li></ul><h5 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h5><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment"># 生成免密</span><br>ssh-keygen<br><br><span class="hljs-comment"># 编写免密脚本</span><br>[root<span class="hljs-variable">@k8s</span>-master ~]<span class="hljs-comment"># vim ssh_key_send.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment"># 下载连接工具</span><br>yum -<span class="hljs-keyword">y</span> install sshpass<br><br><span class="hljs-comment"># 远程主机列表，换成你自己的主机 IP 地址--ip可以写多个</span><br>HOSTS=<span class="hljs-string">&quot;10.100.40.252 10.100.40.253 10.100.40.254&quot;</span><br><br><span class="hljs-comment"># 本地公钥文件路径，换成你自己的公钥文件路径</span><br>PUBLIC_KEY_FILE=~<span class="hljs-regexp">/.ssh/id</span>_rsa.pub<br><br><span class="hljs-comment"># 遍历远程主机</span><br><span class="hljs-keyword">for</span> host in <span class="hljs-variable">$&#123;HOSTS&#125;</span>; <span class="hljs-keyword">do</span><br>    <span class="hljs-comment"># 将本地公钥文件复制到远程主机的 authorized_keys 文件中--更换自己定义的密码</span><br>    echo <span class="hljs-string">&quot;Kunyue<span class="hljs-variable">@123</span>&quot;</span> | sshpass -p <span class="hljs-string">&#x27;Kunyue@123&#x27;</span> ssh-copy-id -o StrictHostKeyChecking=<span class="hljs-keyword">no</span> -i <span class="hljs-variable">$&#123;PUBLIC_KEY_FILE&#125;</span> <span class="hljs-variable">$&#123;host&#125;</span><br>done<br></code></pre></td></tr></table></figure><h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><h5 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h5><ul><li><strong>日志和审计</strong>：<ul><li>一致的时间戳对于日志记录和审计是至关重要的。不同服务器上的日志条目需要统一的时间基准，方便事件的追踪和问题的排查。</li></ul></li><li><strong>数据一致性</strong>：<ul><li>分布式系统和数据库集群依赖于精确的时间同步来确保数据一致性。例如，事务处理和数据复制需要准确的时间戳。</li></ul></li><li><strong>安全性</strong>：<ul><li>许多安全协议和认证机制依赖于准确的时间。例如，Kerberos 认证协议使用时间戳来防止重放攻击。</li></ul></li><li><strong>调度和自动化任务</strong>：<ul><li>计划任务（如 cron 作业）和自动化脚本依赖于系统时间来按预定时间执行。如果时间不同步，可能导致任务执行失败或错过执行时间。</li></ul></li><li><strong>网络协议</strong>：<ul><li>一些网络协议（如 NTP、TLS）需要准确的时间来确保正确的操作和安全性。</li></ul></li></ul><h5 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@localhost</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim check_time.sh</span><br><span class="hljs-comment">#！/bin/bash</span><br><br><span class="hljs-comment">#对时</span><br><span class="hljs-comment"># 关闭防火墙</span><br><span class="hljs-comment">#systemctl stop firewalld</span><br><span class="hljs-comment">#setenforce 0</span><br><span class="hljs-comment"># 下载软件</span><br><span class="hljs-string">yum</span> <span class="hljs-string">-y</span> <span class="hljs-string">instal</span> <span class="hljs-string">ntpdate</span><br><span class="hljs-comment"># 查看当前时区</span><br><span class="hljs-string">timedatectl</span><br><span class="hljs-comment"># 列出可用时区</span><br><span class="hljs-comment">#timedatectl list-timezones</span><br><span class="hljs-comment"># 修改上海时区</span><br><span class="hljs-string">timedatectl</span> <span class="hljs-string">set-timezone</span> <span class="hljs-string">Asia/Shanghai</span><br><span class="hljs-comment"># 验证修改是否生效</span><br><span class="hljs-string">timedatectl</span><br><span class="hljs-comment"># 对时</span><br><span class="hljs-string">ntpdate</span> <span class="hljs-string">ntp.aliyun.com</span><br><span class="hljs-string">echo</span> <span class="hljs-string">&quot;对时成功，当前时间为：&quot;</span> <br><span class="hljs-string">date</span> <span class="hljs-string">+&#x27;%F</span> <span class="hljs-string">%H:%M:%S&#x27;</span><br><br><br><span class="hljs-comment"># 定义主机组</span><br>[<span class="hljs-string">root@k8s-master</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim time</span><br>[<span class="hljs-string">all</span>]<br><span class="hljs-number">10.100</span><span class="hljs-number">.40</span><span class="hljs-number">.252</span><br><span class="hljs-number">10.100</span><span class="hljs-number">.40</span><span class="hljs-number">.253</span><br><span class="hljs-number">10.100</span><span class="hljs-number">.40</span><span class="hljs-number">.254</span><br><br><span class="hljs-comment"># 配置yaml文件</span><br>[<span class="hljs-string">root@k8s-master</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim time.yaml</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">更新</span> <span class="hljs-string">time</span><br>  <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">copy</span> <span class="hljs-string">time</span> <span class="hljs-string">script</span> <span class="hljs-string">to</span> <span class="hljs-string">remote</span> <span class="hljs-string">host</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/root/check_time.sh</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/root/check_time.sh</span><br>        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-number">0755</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">execute</span> <span class="hljs-string">time</span> <span class="hljs-string">script</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">bash</span> <span class="hljs-string">/root/check_time.sh</span><br>      <span class="hljs-attr">args:</span><br>        <span class="hljs-attr">chdir:</span> <span class="hljs-string">/root</span><br><br><span class="hljs-comment"># 启动命令</span><br><span class="hljs-string">ansible-playbook</span> <span class="hljs-string">-i</span> <span class="hljs-string">/root/time</span> <span class="hljs-string">time.yaml</span> <br><br></code></pre></td></tr></table></figure><h3 id="挂载数据盘"><a href="#挂载数据盘" class="headerlink" title="挂载数据盘"></a>挂载数据盘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建目录</span><br><span class="hljs-built_in">mkdir</span> /data<br><span class="hljs-comment">#分区</span><br>fdisk /dev/sdb1<br><span class="hljs-comment">#格式化</span><br>mkfs.xfs -t ext4 /dev/sdb1<br>mount /dev/sdb1 /data<br><span class="hljs-comment"># 永久挂载</span><br>vim /etc/fstab<br>/dev/sdb1 /data xfs defaults 0 0    <span class="hljs-comment">#添加</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>部署prometheus</title>
    <link href="/2025/11/05/%E9%83%A8%E7%BD%B2prometheus/"/>
    <url>/2025/11/05/%E9%83%A8%E7%BD%B2prometheus/</url>
    
    <content type="html"><![CDATA[<h1 id="部署prometheus"><a href="#部署prometheus" class="headerlink" title="部署prometheus"></a>部署prometheus</h1><h2 id="一、准备环境"><a href="#一、准备环境" class="headerlink" title="一、准备环境"></a>一、准备环境</h2><table><thead><tr><th align="center">主机名</th><th align="center">IP</th><th align="center">配置</th></tr></thead><tbody><tr><td align="center">client</td><td align="center">10.100.40.185</td><td align="center"></td></tr><tr><td align="center">agent</td><td align="center">10.100.40.171</td><td align="center"></td></tr><tr><td align="center">agent</td><td align="center"></td><td align="center"></td></tr></tbody></table><h2 id="二、部署prometheus"><a href="#二、部署prometheus" class="headerlink" title="二、部署prometheus"></a>二、部署prometheus</h2><h3 id="1、下载地址"><a href="#1、下载地址" class="headerlink" title="1、下载地址"></a>1、下载地址</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget prometheus-2.47.2.linux-amd64.tar.gz<br><br>官网地址<br>https://prometheus.io/download/<br></code></pre></td></tr></table></figure><h3 id="2、创建目录"><a href="#2、创建目录" class="headerlink" title="2、创建目录"></a>2、创建目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -pv /data/pormetheus/&#123;data,soft,lag&#125;<br></code></pre></td></tr></table></figure><h3 id="3、解压安装包"><a href="#3、解压安装包" class="headerlink" title="3、解压安装包"></a>3、解压安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xzf prometheus-2.47.2.linux-amd64.tar.gz -C /data/prometheus/soft<br></code></pre></td></tr></table></figure><h4 id="做个软连接，方便操作"><a href="#做个软连接，方便操作" class="headerlink" title="做个软连接，方便操作"></a>做个软连接，方便操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/prometheus/soft<br>ln -sv prometheus-2.47.2.linux-amd64 prometheus<br></code></pre></td></tr></table></figure><h2 id="三、启动"><a href="#三、启动" class="headerlink" title="三、启动"></a>三、启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">在/data/prometheus/soft/prometfeus目录下启动<br>nohup ./prometheus &amp;<br></code></pre></td></tr></table></figure><h2 id="四、检查，并查看"><a href="#四、检查，并查看" class="headerlink" title="四、检查，并查看"></a>四、检查，并查看</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -lnpt#查看9090端口有没有<br><br>浏览器访问<br>http://IP + 9090<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707100611303.png" alt="image-20240707100611303"></p><h2 id="五、配置systemctl启动文件"><a href="#五、配置systemctl启动文件" class="headerlink" title="五、配置systemctl启动文件"></a>五、配置systemctl启动文件</h2><h3 id="1、编辑启动项"><a href="#1、编辑启动项" class="headerlink" title="1、编辑启动项"></a>1、编辑启动项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/systemd/system/prometheus-server.service<br><br>[Unit]<br>Description=xinjizhiwa Prometheus Server<br>Documentation=https://prometheus.io/docs/introduction/overview/<br>After=network.target<br><br>[Service]<br>Restart=on-failure<br>ExecStart=/data/prometheus/soft/prometheus/prometheus \<br>    --config.file=/data/prometheus/soft/prometheus/prometheus.yml \<br>    --web.enable-lifecycle<br>ExecReload=/bin/kill -HUP \$MAINPID<br>LimitNOFILE=65535<br><br>[Install]<br>WantedBy=multi-user.target<br><br></code></pre></td></tr></table></figure><h3 id="2、重新加载systemctl"><a href="#2、重新加载systemctl" class="headerlink" title="2、重新加载systemctl"></a>2、重新加载systemctl</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl enable --now prometheus-server.serivce<br></code></pre></td></tr></table></figure><h3 id="3、重新加载prometfeus"><a href="#3、重新加载prometfeus" class="headerlink" title="3、重新加载prometfeus"></a>3、重新加载prometfeus</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl reload prometheus-server.service<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">如果不管用，则使用下面的命令</span><br>curl -X POST http://本机IP:9090/-/reload<br></code></pre></td></tr></table></figure><h1 id="部署被监控节点node-exporter"><a href="#部署被监控节点node-exporter" class="headerlink" title="部署被监控节点node-exporter"></a>部署被监控节点node-exporter</h1><h2 id="一、部署node节点"><a href="#一、部署node节点" class="headerlink" title="一、部署node节点"></a>一、部署node节点</h2><h3 id="1、下载地址-1"><a href="#1、下载地址-1" class="headerlink" title="1、下载地址"></a>1、下载地址</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget node_exporter-1.8.1.linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2、创建目录-1"><a href="#2、创建目录-1" class="headerlink" title="2、创建目录"></a>2、创建目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shel">mkdir -pv /data/node_export/&#123;data,soft,logs&#125;<br></code></pre></td></tr></table></figure><h3 id="3、解压"><a href="#3、解压" class="headerlink" title="3、解压"></a>3、解压</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xzf node_exporter-1.8.1.linux-amd64 -C /data/prometfeus/soft<br></code></pre></td></tr></table></figure><h3 id="4、创建软链接"><a href="#4、创建软链接" class="headerlink" title="4、创建软链接"></a>4、创建软链接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -sv /node-export/soft/node_exporter-1.6.1.linux-amd64 /node-export/soft/node-exporter<br></code></pre></td></tr></table></figure><h3 id="5、配置启动项"><a href="#5、配置启动项" class="headerlink" title="5、配置启动项"></a>5、配置启动项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/systemd/system/node-exporter.service<br><br>[Unit]<br>Description=xinjizhiwa node-exporter<br>Documentation=https://prometheus.io/docs/introduction/overview/<br>After=network.target<br><br>[Service]<br>Restart=on-failure<br>ExecStart=/data/node-export/soft/node-exporter/node_exporter<br>ExecReload=/bin/kill -HUP \$MAINPID<br>LimitNOFILE=65535<br><br>[Install]<br>WantedBy=multi-user.target<br><br></code></pre></td></tr></table></figure><h3 id="6、重新加载systemd启动"><a href="#6、重新加载systemd启动" class="headerlink" title="6、重新加载systemd启动"></a>6、重新加载systemd启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl enable --now node-exporter.service <br></code></pre></td></tr></table></figure><h3 id="7、检查，并查看"><a href="#7、检查，并查看" class="headerlink" title="7、检查，并查看"></a>7、检查，并查看</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shlel">netstat -lnpt#查看端口9100有么有起来<br><br>浏览器<br>http://IP +9100<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707102747085.png" alt="image-20240707102747085"></p><h2 id="二、配置prometheus收集node-exporter采集数据"><a href="#二、配置prometheus收集node-exporter采集数据" class="headerlink" title="二、配置prometheus收集node-exporter采集数据"></a>二、配置prometheus收集node-exporter采集数据</h2><h3 id="1、在prometheus上操作，配置node节点的信息"><a href="#1、在prometheus上操作，配置node节点的信息" class="headerlink" title="1、在prometheus上操作，配置node节点的信息"></a>1、在prometheus上操作，配置node节点的信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"> vim /data/prometheus/soft/prometheus/prometheus.yml <br> <br><span class="hljs-meta prompt_">   #</span><span class="language-bash">抓取监控的间隔时间，多长时间获取一次数据（生产环境，建议15-30s）；</span><br>  scrape_interval: 3s<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">多久读一次规则</span><br>  evaluation_interval: 15s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">先不解释，之后会讲</span><br>alerting:<br>  alertmanagers:<br>    - static_configs:<br>        - targets:<br>          # - alertmanager:9093<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">先不讲，之后会讲</span><br>rule_files:<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">- <span class="hljs-string">&quot;first_rules.yml&quot;</span></span><br><span class="hljs-meta prompt_">  # </span><span class="language-bash">- <span class="hljs-string">&quot;second_rules.yml&quot;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">被监控的配置</span><br>scrape_configs:<br>  - job_name: &quot;prometheus&quot;<br>    static_configs:<br>      - targets: [&quot;localhost:9090&quot;]<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">另起一个job名称，被监控的主体自定义名称</span><br>  - job_name: &quot;node-exporter&quot;#名字可以自定义<br>    static_configs:<br>      #被监控的数据抓取地址；<br>      - targets: [&quot;10.0.0.41:9100&quot;]#填被监控节点的IP和端口<br><br></code></pre></td></tr></table></figure><h3 id="2、重新加载prometheus服务"><a href="#2、重新加载prometheus服务" class="headerlink" title="2、重新加载prometheus服务"></a>2、重新加载prometheus服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -X POST http://IP:9090/-/reload<br><br>此时刷新页面，就可以看到node节点的信息了<br></code></pre></td></tr></table></figure><p>3、PromeQL语句查询</p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707103527708.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">up #代表查看所有被监控节点是否存活<br><br>1表示存活；<br><br>0表示存活；<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707103558165.png" alt="image-20240707103558165"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707103635031.png" alt="image-20240707103635031"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707103656865.png" alt="image-20240707103656865"></p><h1 id="部署grafana"><a href="#部署grafana" class="headerlink" title="部署grafana"></a>部署grafana</h1><h3 id="1、下载地址-2"><a href="#1、下载地址-2" class="headerlink" title="1、下载地址"></a>1、下载地址</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget grafana-enterprise-11.1.0-1.x86_64.rpm<br><br>官网地址<br>https://grafana.com/grafana/dashboards/<br></code></pre></td></tr></table></figure><h3 id="2、移动到prometfeus的soft目录下，好管理"><a href="#2、移动到prometfeus的soft目录下，好管理" class="headerlink" title="2、移动到prometfeus的soft目录下，好管理"></a>2、移动到prometfeus的soft目录下，好管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv /root/grafana-enterprise-11.1.0-1.x86_64.rpm /data/prometfeus/soft<br></code></pre></td></tr></table></figure><p>3、安装grafana</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y localinstall grafana-enterprise-11.1.0-1.x86_64.rpm<br><br>或<br>yum install -y fontconfig<br>rpm -ivh grafana-enterprise-11.1.0-1.x86_64.rpm<br></code></pre></td></tr></table></figure><p>4、启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable --now grafana-server.service<br></code></pre></td></tr></table></figure><p>5、检查，并查看</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts">netstat -lnpt<span class="hljs-meta">#查看3000端口有没有</span><br><br>浏览器访问<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//IP + 3000</span><br>默认账号密码： admin/admin<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104421113.png" alt="image-20240707104421113"></p><h3 id="3、配置数据源"><a href="#3、配置数据源" class="headerlink" title="3、配置数据源"></a>3、配置数据源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">【home】-【adminstration】-【data sources】-【add  data-sources】-【prometheus】<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104530460.png" alt="image-20240707104530460"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104552366.png" alt="image-20240707104552366"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104606770.png" alt="image-20240707104606770"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104619454.png" alt="image-20240707104619454"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104639259.png" alt="image-20240707104639259"></p><h3 id="4、新建仪表盘"><a href="#4、新建仪表盘" class="headerlink" title="4、新建仪表盘"></a>4、新建仪表盘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">【home】-【dashboards】-【new】-【new  folder】<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104725376.png" alt="image-20240707104725376"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104739176.png" alt="image-20240707104739176"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104752529.png" alt="image-20240707104752529"></p><h3 id="5、创建一个新的folder"><a href="#5、创建一个新的folder" class="headerlink" title="5、创建一个新的folder"></a>5、创建一个新的folder</h3><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104821412.png" alt="image-20240707104821412"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">进入目录后，创建仪表盘<br><br>【create  dashboard】<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104846803.png" alt="image-20240707104846803"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">选择数据源<br><br>【<span class="hljs-built_in">Add</span> visualization】<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707104955023.png" alt="image-20240707104955023"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">选择刚刚添加的数据源<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105013229.png" alt="image-20240707105013229"></p><p>6、测试</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">第一步，测试代码，就是计算一个<span class="hljs-meta">cpu</span>使用率的PromeQL代码；<br><br>测试没问题，就复制；<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105107524.png" alt="image-20240707105107524"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">写入grafana图形<br><br>(1-sum(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;)/sum(node_cpu_seconds_total))*100<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105152631.png" alt="image-20240707105152631"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105209270.png" alt="image-20240707105209270"></p><h3 id="6、下载开源的仪表盘"><a href="#6、下载开源的仪表盘" class="headerlink" title="6、下载开源的仪表盘"></a>6、下载开源的仪表盘</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#grafana官网查询dashboard模板id</span><br>https:<span class="hljs-regexp">//g</span>rafana.com<span class="hljs-regexp">/grafana/</span>dashboards<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105255145.png" alt="image-20240707105255145"></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Copy ID <span class="hljs-keyword">to</span> clipboard<span class="hljs-comment">#复制仪表ID直接使用，需要有网络的情况下使用</span><br><br>Download <span class="hljs-built_in">JSON</span><span class="hljs-comment">#下载json文件，然后上传到prometfeus，支持离线</span><br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105309914.png" alt="image-20240707105309914"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">上传仪表盘json文件到grafana<br>【home】-【dashboard】-【new】-【import】<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105537863.png" alt="image-20240707105537863"></p><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105550579.png" alt="image-20240707105550579"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">回到自己的dashboard列表可以看到成功了<br></code></pre></td></tr></table></figure><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707105638228.png" alt="image-20240707105638228"></p><h1 id="grafana的变量"><a href="#grafana的变量" class="headerlink" title="grafana的变量"></a>grafana的变量</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">grafana的下拉列表选项制作-grafana的变量<br>教程<br>https://blog.csdn.net/2302_79199605/article/details/136438841?spm=1001.2014.3001.5501<br></code></pre></td></tr></table></figure><h1 id="配置prometheus服务的动态发现"><a href="#配置prometheus服务的动态发现" class="headerlink" title="配置prometheus服务的动态发现"></a>配置prometheus服务的动态发现</h1><h2 id="一、基于文档的自动发现"><a href="#一、基于文档的自动发现" class="headerlink" title="一、基于文档的自动发现"></a>一、基于文档的自动发现</h2><h3 id="1、修改prometheus的配置文件"><a href="#1、修改prometheus的配置文件" class="headerlink" title="1、修改prometheus的配置文件"></a>1、修改prometheus的配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /prometheus/soft/prometheus/prometheus.yml <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">通用设置</span><br>global:<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">抓取监控的间隔时间，多长时间获取一次数据（生产环境，建议15-30s）；</span><br>  scrape_interval: 3s <br><span class="hljs-meta prompt_">  #</span><span class="language-bash">多久读一次规则</span><br>  evaluation_interval: 15s <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">先不解释，之后会讲</span><br>alerting:<br>  alertmanagers:<br>    - static_configs:<br>        - targets:<br>          # - alertmanager:9093<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">先不讲，之后会讲</span><br>rule_files:<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">- <span class="hljs-string">&quot;first_rules.yml&quot;</span></span><br><span class="hljs-meta prompt_">  # </span><span class="language-bash">- <span class="hljs-string">&quot;second_rules.yml&quot;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">被监控的配置</span><br>scrape_configs:<br>  - job_name: &quot;prometheus&quot;<br>    static_configs:<br>      - targets: [&quot;localhost:9090&quot;]<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">另起一个job名称，被监控的主体自定义名称</span><br>  - job_name: &quot;node-exporter01&quot;<br>    #基于文档自动发现<br>    file_sd_configs:<br>      #文档的地址路径<br>      - files:<br>          #- /prometheus/soft/prometheus/file-sd.json<br>          - /data/prometheus/soft/prometheus/file-sd.yaml#自己定义的发现文档路径<br><br></code></pre></td></tr></table></figure><h3 id="2、重新加载prometheus服务-1"><a href="#2、重新加载prometheus服务-1" class="headerlink" title="2、重新加载prometheus服务"></a>2、重新加载prometheus服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -X POST http://IP:9090/-/reload<br></code></pre></td></tr></table></figure><h3 id="3、编辑自动发现文档"><a href="#3、编辑自动发现文档" class="headerlink" title="3、编辑自动发现文档"></a>3、编辑自动发现文档</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /data/prometheus/soft/prometheus/file-sd.yaml<br>- targets:<br>    - &#x27;10.0.0.41:9100&#x27;<br>  labels:<br>    xinjizhiwa: prometheus-learn<br>    office: www.xinjizhiwa.com<br></code></pre></td></tr></table></figure><h3 id="4、刷新浏览器查看"><a href="#4、刷新浏览器查看" class="headerlink" title="4、刷新浏览器查看"></a>4、刷新浏览器查看</h3><p><img src="C:\Users\徐保东\AppData\Roaming\Typora\typora-user-images\image-20240707110535539.png" alt="image-20240707110535539"></p><h1 id="配置prometheus的数据存储"><a href="#配置prometheus的数据存储" class="headerlink" title="配置prometheus的数据存储"></a>配置prometheus的数据存储</h1><h2 id="一、本地存储prometheus收集的监控数据"><a href="#一、本地存储prometheus收集的监控数据" class="headerlink" title="一、本地存储prometheus收集的监控数据"></a>一、本地存储prometheus收集的监控数据</h2><h3 id="1、配置systemctl启动文件"><a href="#1、配置systemctl启动文件" class="headerlink" title="1、配置systemctl启动文件"></a>1、配置systemctl启动文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/systemd/system/prometheus-server.service<br>[Unit]<br>Description=Prometheus Server<br>Documentation=https://prometheus.io/docs/introduction/overview/<br>After=network.target<br><br>[Service]<br>Restart=on-failure<br>ExecStart=/data/prometheus/softwares/prometheus-2.47.2.linux-amd64/prometheus \<br>    --config.file=/data/prometheus/softwares/prometheus-2.47.2.linux-amd64/prometheus.yml \<br>    --web.enable-lifecycle \<br>    --storage.tsdb.path=/data/prometheus/data/prometheus \<br>    --storage.tsdb.retention.time=60d \<br>    --web.listen-address=0.0.0.0:9090 \<br>    --web.max-connections=4096 \<br>    --storage.tsdb.retention.size=512MB \<br>    --query.timeout=10s \<br>    --query.max-concurrency=20 \<br>    --log.level=info \<br>    --log.format=json \<br>    --web.read-timeout=5m<br>ExecReload=/bin/kill -HUP $MAINPID<br>LimitNOFILE=65535<br><br>[Install]<br>WantedBy=multi-user.target<br><br><br>参数说明：<br>--config.file=/prometheus/softwares/prometheus/prometheus.yml <br>    指定prometheus的配置文件。<br>--web.enable-lifecycle <br>    启用web方式热加载。<br>--storage.tsdb.path=&quot;/prometheus/data/prometheus&quot; <br>    指定prometheus数据存储路径。如果不指定，则默认其实时的同级目录下。<br>--storage.tsdb.retention.time=&quot;60d&quot; <br>    指定prometheus数据存储周期。<br>--web.listen-address=&quot;0.0.0.0:9090&quot; <br>    指定prometheus的监听端口。<br>--web.max-connections=4096 <br>    指定最大的连接数。<br>--storage.tsdb.retention.size=&quot;512MB&quot; <br>    指定prometheus数据块的滚动大小（每到512M缓存，进行一次落盘存储）。<br>--query.timeout=10s <br>    查询数据的超时时间。<br>--query.max-concurrency=20<br>    最大并发查询数量。<br>--log.level=info<br>    指定日志级别。<br>--log.format=logfmt<br>    指定日志格式。<br>--web.read-timeout=5m<br>    最大的空闲超时时间。<br></code></pre></td></tr></table></figure><h3 id="3、重新加载systemctl"><a href="#3、重新加载systemctl" class="headerlink" title="3、重新加载systemctl"></a>3、重新加载systemctl</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl restart prometheus-server<br></code></pre></td></tr></table></figure><h2 id="二、prometheus数据远端存储"><a href="#二、prometheus数据远端存储" class="headerlink" title="二、prometheus数据远端存储"></a>二、prometheus数据远端存储</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">这里就不作介绍了<br>教程<br>https://blog.csdn.net/2302_79199605/article/details/136467629?spm=1001.2014.3001.5501<br></code></pre></td></tr></table></figure><h1 id="监控的告警通知-alertmanager组件工具"><a href="#监控的告警通知-alertmanager组件工具" class="headerlink" title="监控的告警通知-alertmanager组件工具"></a>监控的告警通知-alertmanager组件工具</h1><h2 id="1、定义告警规则"><a href="#1、定义告警规则" class="headerlink" title="1、定义告警规则"></a>1、定义告警规则</h2><p>修改Prometheus配置文件prometheus.yml,添加以下配置：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs perl">rule_files:<br>  - <span class="hljs-regexp">/usr/l</span>ocal/prometheus/rules/*.rules<span class="hljs-comment">#改成自己的目录，我的是/data目录下</span><br><br>alerting:<br>  alertmanagers:<br>    - static_configs:<br>        - targets:<br>           - localhost:<span class="hljs-number">9093</span><br><br></code></pre></td></tr></table></figure><p>在目录&#x2F;usr&#x2F;local&#x2F;prometheus&#x2F;rules&#x2F;下创建告警文件hoststats-alert.rules内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">groups:<br>- name: hostStatsAlert<br>  rules:<br>  - alert: hostCpuUsageAlert<br>    expr: sum by (instance) (avg without (cpu) (irate(node_cpu_seconds_total&#123;mode!=&quot;idle&quot;&#125;[5m]))) &gt; 0.5<br>    for: 1m<br>    labels:<br>      # 严重性<br>      severity: warning<br>    annotations:<br>      title: cpu飚高告警<br>      summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; CPU usgae high&quot;<br>      description: &quot;&#123;&#123; $labels.instance &#125;&#125; CPU usage above 50% (current value: &#123;&#123; $value &#125;&#125;)&quot;<br>  - alert: hostMemUsageAlert<br>    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)/node_memory_MemTotal_bytes &gt; 0.85<br>    for: 1m<br>    labels:<br>      severity: warning<br>    annotations:<br>      title: 内存使用率飚高告警<br>      summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; MEM usgae high&quot;<br>      description: &quot;&#123;&#123; $labels.instance &#125;&#125; MEM usage above 85% (current value: &#123;&#123; $value &#125;&#125;)&quot;<br><br></code></pre></td></tr></table></figure><p>重启Prometheus后访问Prometheus http:&#x2F;&#x2F; IP:9090&#x2F;rules可以查看当前以加载的规则文件</p><h2 id="2、安装配置prometheus-webhook-dingtalk"><a href="#2、安装配置prometheus-webhook-dingtalk" class="headerlink" title="2、安装配置prometheus-webhook-dingtalk"></a>2、安装配置prometheus-webhook-dingtalk</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v2.1.0/prometheus-webhook-dingtalk-2.1.0.linux-amd64.tar.gz<br>tar -zxvf prometheus-webhook-dingtalk-2.1.0.linux-amd64.tar.gz -C /usr/local<br>mv /usr/local/prometheus-webhook-dingtalk-2.1.0.linux-amd64 /usr/local/prometheus-webhook-dingtalk<br>cp /usr/local/prometheus-webhook-dingtalk/config.example.yml  /usr/local/prometheus-webhook-dingtalk/config.yml<br>vim config.yml      # 将配置文件修改成下面这样<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Request timeout</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">timeout</span>: 5s</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Uncomment following line in order to write template from scratch (be careful!)</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">no_builtin_template: <span class="hljs-literal">true</span></span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Customizable templates path</span></span><br>templates:<br>  - contrib/templates/mytemplate.tmpl # 这里指向你生成的模板<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># You can also override default template using `default_message`</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># The following example to use the &#x27;legacy&#x27; template from v0.3.0</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">default_message:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> title: <span class="hljs-string">&#x27;&#123;&#123; template &quot;legacy.title&quot; . &#125;&#125;&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> text: <span class="hljs-string">&#x27;&#123;&#123; template &quot;legacy.content&quot; . &#125;&#125;&#x27;</span></span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Targets, previously was known as &quot;profiles&quot;</span></span><br>targets:<br>  webhook1:<br>    # 钉钉机器人的webhook, 是从钉钉机器人中获取的值<br>    url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br>    # secret for signature 加签后得到的值， 机器人的加签<br>    # secret: xxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br><span class="hljs-meta prompt_"># </span><span class="language-bash"> webhook2:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> webhook_legacy:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   <span class="hljs-comment"># Customize template content</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   message:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     <span class="hljs-comment"># Use legacy template</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     title: <span class="hljs-string">&#x27;&#123;&#123; template &quot;legacy.title&quot; . &#125;&#125;&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     text: <span class="hljs-string">&#x27;&#123;&#123; template &quot;legacy.content&quot; . &#125;&#125;&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> webhook_mention_all:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   mention:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     all: <span class="hljs-literal">true</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> webhook_mention_users:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   mention:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     mobiles: [<span class="hljs-string">&#x27;156xxxx8827&#x27;</span>, <span class="hljs-string">&#x27;189xxxx8325&#x27;</span>]</span><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">添加如下模板，模板中需要有prometheus添加的 Annotations中需要title、description；Labels中需要有severity</span><br>vim /usr/local/prometheus-webhook-dingtalk/contrib/templates/mytemplate.tmpl<br><br>cd /usr/local/prometheus-webhook-dingtalk/<br><br>./prometheus-webhook-dingtalk --config.file=config.yml &gt;dingtalk.log 2&gt;&amp;1 &amp;<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;&#123; define &quot;__subject&quot; &#125;&#125;<br>[&#123;&#123; .Status | toUpper &#125;&#125;&#123;&#123; if eq .Status &quot;firing&quot; &#125;&#125;:&#123;&#123; .Alerts.Firing | len &#125;&#125;&#123;&#123; end &#125;&#125;]<br>&#123;&#123; end &#125;&#125;<br> <br> <br>&#123;&#123; define &quot;__alert_list&quot; &#125;&#125;&#123;&#123; range . &#125;&#125;<br>---<br>&#123;&#123; if .Labels.owner &#125;&#125;@&#123;&#123; .Labels.owner &#125;&#125;&#123;&#123; end &#125;&#125;<br><br>**告警名称**: &#123;&#123; index .Annotations &quot;title&quot; &#125;&#125; <br> <br>**告警级别**: &#123;&#123; .Labels.severity &#125;&#125; <br> <br>**告警主机**: &#123;&#123; .Labels.instance &#125;&#125; <br> <br>**告警信息**: &#123;&#123; index .Annotations &quot;description&quot; &#125;&#125;<br> <br>**告警时间**: &#123;&#123; dateInZone &quot;2006.01.02 15:04:05&quot; (.StartsAt) &quot;Asia/Shanghai&quot; &#125;&#125;<br>&#123;&#123; end &#125;&#125;&#123;&#123; end &#125;&#125;<br> <br>&#123;&#123; define &quot;__resolved_list&quot; &#125;&#125;&#123;&#123; range . &#125;&#125;<br>---<br>&#123;&#123; if .Labels.owner &#125;&#125;@&#123;&#123; .Labels.owner &#125;&#125;&#123;&#123; end &#125;&#125;<br> <br>**告警名称**: &#123;&#123; index .Annotations &quot;title&quot; &#125;&#125;<br> <br>**告警级别**: &#123;&#123; .Labels.severity &#125;&#125;<br> <br>**告警主机**: &#123;&#123; .Labels.instance &#125;&#125;<br> <br>**告警信息**: &#123;&#123; index .Annotations &quot;description&quot; &#125;&#125;<br> <br>**告警时间**: &#123;&#123; dateInZone &quot;2006.01.02 15:04:05&quot; (.StartsAt) &quot;Asia/Shanghai&quot; &#125;&#125;<br> <br>**恢复时间**: &#123;&#123; dateInZone &quot;2006.01.02 15:04:05&quot; (.EndsAt) &quot;Asia/Shanghai&quot; &#125;&#125;<br>&#123;&#123; end &#125;&#125;&#123;&#123; end &#125;&#125;<br> <br> <br>&#123;&#123; define &quot;default.title&quot; &#125;&#125;<br>&#123;&#123; template &quot;__subject&quot; . &#125;&#125;<br>&#123;&#123; end &#125;&#125;<br> <br>&#123;&#123; define &quot;default.content&quot; &#125;&#125;<br>&#123;&#123; if gt (len .Alerts.Firing) 0 &#125;&#125;<br>**====侦测到&#123;&#123; .Alerts.Firing | len  &#125;&#125;个故障====**<br>&#123;&#123; template &quot;__alert_list&quot; .Alerts.Firing &#125;&#125;<br>---<br>&#123;&#123; end &#125;&#125;<br> <br>&#123;&#123; if gt (len .Alerts.Resolved) 0 &#125;&#125;<br>**====恢复&#123;&#123; .Alerts.Resolved | len  &#125;&#125;个故障====**<br>&#123;&#123; template &quot;__resolved_list&quot; .Alerts.Resolved &#125;&#125;<br>&#123;&#123; end &#125;&#125;<br>&#123;&#123; end &#125;&#125;<br> <br> <br>&#123;&#123; define &quot;ding.link.title&quot; &#125;&#125;&#123;&#123; template &quot;default.title&quot; . &#125;&#125;&#123;&#123; end &#125;&#125;<br>&#123;&#123; define &quot;ding.link.content&quot; &#125;&#125;&#123;&#123; template &quot;default.content&quot; . &#125;&#125;&#123;&#123; end &#125;&#125;<br>&#123;&#123; template &quot;default.title&quot; . &#125;&#125;<br>&#123;&#123; template &quot;default.content&quot; . &#125;&#125;<br><br></code></pre></td></tr></table></figure><h2 id="3、安装配置prometheus-alertmanager"><a href="#3、安装配置prometheus-alertmanager" class="headerlink" title="3、安装配置prometheus-alertmanager"></a>3、安装配置prometheus-alertmanager</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz<br>tar -zxvf alertmanager-0.25.0.linux-amd64.tar.gz <br>mv alertmanager-0.25.0.linux-amd64 /usr/local/alertmanager<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改告警管理的配置文件如下</span><br>vim /usr/local/alertmanager/alertmanager.yml<br>cd /usr/local/alertmanager/<br>./alertmanager --config.file=alertmanager.yml &gt;alertmanager.log 2&gt;&amp;1 &amp;<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">global:<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">每一分钟检查一次是否恢复</span><br>  resolve_timeout: 5m<br>route:<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">采用哪个标签来作为分组依据</span><br>  group_by: [&#x27;alertname&#x27;]<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">组告警等待时间。也就是告警产生后等待10s，如果有同组告警一起发出</span><br>  group_wait: 10s<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">两组告警的间隔时间</span><br>  group_interval: 1m<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">重复告警的间隔时间，减少相同告警的发送频率</span><br>  repeat_interval: 1m<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">设置默认接收人</span><br>  receiver: &#x27;web.hook&#x27;<br>  routes:<br>  - receiver: &#x27;dingding.webhook1&#x27;<br>    match_re:<br>      alertname: &quot;.*&quot;<br>receivers:<br>- name: &#x27;web.hook&#x27;<br>  webhook_configs:<br>  - url: &#x27;http://127.0.0.1:5001/&#x27;<br>- name: &#x27;dingding.webhook1&#x27;<br>  webhook_configs:<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">这里的webhook1，根据我们在钉钉告警插件配置文件中targets中指定的值做修改</span><br>  - url: &#x27;http://127.0.0.1:8060/dingtalk/webhook1/send&#x27;<br>    send_resolved: true<br>inhibit_rules:<br>  - source_match:<br>      severity: &#x27;critical&#x27;<br>    target_match:<br>      severity: &#x27;warning&#x27;<br>    equal: [&#x27;alertname&#x27;, &#x27;dev&#x27;, &#x27;instance&#x27;]<br><br></code></pre></td></tr></table></figure><p>此时，我们可以手动拉高系统的CPU使用率，验证Prometheus的告警流程，在主机上运行以下命令</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm">cat /dev/zero&gt;/dev/<span class="hljs-keyword">null</span><br>等待告警状态为firing后钉钉群机器人会发出告警信息<br><br>连接地址:https://blog.csdn.net/weixin_<span class="hljs-number">44223946</span>/article/details/<span class="hljs-number">131411062</span>?ops_request_misc<span class="hljs-operator">=</span><span class="hljs-variable">%257</span>B<span class="hljs-variable">%2522</span>request<span class="hljs-variable">%255</span>Fid<span class="hljs-variable">%2522</span><span class="hljs-variable">%253</span>A<span class="hljs-variable">%2522172032212116800213088728</span><span class="hljs-variable">%2522</span><span class="hljs-variable">%252</span>C<span class="hljs-variable">%2522</span>scm<span class="hljs-variable">%2522</span><span class="hljs-variable">%253</span>A<span class="hljs-variable">%252220140713</span>.<span class="hljs-number">130102334</span>..<span class="hljs-variable">%2522</span><span class="hljs-variable">%257</span>D&amp;request_id<span class="hljs-operator">=</span><span class="hljs-number">172032212116800213088728</span>&amp;biz_id<span class="hljs-operator">=</span><span class="hljs-number">0</span>&amp;utm_medium<span class="hljs-operator">=</span>distribute.pc_search_result.none-task-blog<span class="hljs-number">-2</span>~all~sobaiduend~<span class="hljs-keyword">default</span><span class="hljs-number">-1</span><span class="hljs-number">-131411062</span>-<span class="hljs-keyword">null</span>-<span class="hljs-keyword">null</span>.<span class="hljs-number">142</span>^v<span class="hljs-number">100</span>^pc_search_result_base<span class="hljs-number">3</span>&amp;utm_term<span class="hljs-operator">=</span>prometheus<span class="hljs-variable">%E5</span><span class="hljs-variable">%91</span><span class="hljs-variable">%8</span>A<span class="hljs-variable">%E8</span><span class="hljs-variable">%AD</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%91</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%80</span><span class="hljs-variable">%81</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%92</span><span class="hljs-variable">%89</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%92</span><span class="hljs-variable">%89</span>&amp;spm<span class="hljs-operator">=</span><span class="hljs-number">1018.2226</span>.<span class="hljs-number">3001.4187</span><br></code></pre></td></tr></table></figure><p>1、下载工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/prometheus/alertmanager/releases/download/v0.26.0/alertmanager-0.26.0.linux-amd64.tar.gz<br><br>tar xf alertmanager-0.26.0.linux-amd64.tar.gz -C /prometheus/softwares/<br> <br>ln -svf /prometheus/softwares/alertmanager-0.26.0.linux-amd64/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">教程<br>https://blog.csdn.net/2302_79199605/article/details/136494677?spm=1001.2014.3001.5501<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>k8s部署prometheus</title>
    <link href="/2025/11/05/k8s%E9%83%A8%E7%BD%B2prometheus/"/>
    <url>/2025/11/05/k8s%E9%83%A8%E7%BD%B2prometheus/</url>
    
    <content type="html"><![CDATA[<h1 id="k8s部署prometheus"><a href="#k8s部署prometheus" class="headerlink" title="k8s部署prometheus"></a>k8s部署prometheus</h1><h1 id="终端创建"><a href="#终端创建" class="headerlink" title="终端创建"></a>终端创建</h1><h2 id="创建namespace"><a href="#创建namespace" class="headerlink" title="创建namespace"></a>创建namespace</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /home/k8s/monitoring/&#123;node-exporter,k8s,kube-state-metrics,blackbox-exporter,dingtalk,alertmanager,prometheus,grafana&#125;<br><br><span class="hljs-built_in">cd</span> /home/k8s/monitoring<br><br>vim namespace.yaml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Namespace<br>metadata:<br>  name: monitoring<br></code></pre></td></tr></table></figure><h2 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node-exporter"></a>node-exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim node-exporter/node-exporter.yaml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: node-exporter<br>  namespace: monitoring<br>  labels:<br>    app: node-exporter<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    app: node-exporter<br>  ports:<br>  - name: node-exporter<br>    port: 9100<br>    protocol: TCP<br>    targetPort: 9100<br>  clusterIP: None<br><br>---<br>apiVersion: apps/v1<br>kind: DaemonSet<br>metadata:<br>  name: node-exporter<br>  namespace: monitoring<br>  labels:<br>    app: node-exporter<br>spec:<br>  selector:<br>    matchLabels:<br>      app: node-exporter<br>  template:<br>    metadata:<br>      name: node-exporter<br>      labels:<br>        app: node-exporter<br>    spec:<br>      containers:<br>      - name: node-exporter<br>        image: prom/node-exporter:latest<br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 9100<br>          hostPort: 9100<br>      hostNetwork: <span class="hljs-literal">true</span><br>      hostPID: <span class="hljs-literal">true</span><br>      tolerations:<br>      - key: node-role.kubernetes.io/master<br>        operator: Exists<br>        effect: NoSchedule<br><br></code></pre></td></tr></table></figure><h2 id="k8s组件"><a href="#k8s组件" class="headerlink" title="k8s组件"></a>k8s组件</h2><h2 id="controller-manager"><a href="#controller-manager" class="headerlink" title="controller-manager"></a>controller-manager</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim k8s/kube-controller-manager-prometheus-discovery.yaml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube-controller-manager-prometheus-discovery<br>  namespace: kube-system<br>  labels:<br>    component: kube-controller-manager<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    component: kube-controller-manager<br>  ports:<br>  - name: http-metrics<br>    port: 10252<br>    targetPort: 10252<br>    protocol: TCP<br>  clusterIP: None<br><br></code></pre></td></tr></table></figure><h2 id="kube-scheduler"><a href="#kube-scheduler" class="headerlink" title="kube-scheduler"></a>kube-scheduler</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim k8s/kube-scheduler-prometheus-discovery.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube-scheduler-prometheus-discovery<br>  namespace: kube-system<br>  labels:<br>    component: kube-scheduler<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    component: kube-scheduler<br>  ports:<br>  - name: http-metrics<br>    port: 10251<br>    protocol: TCP<br>    targetPort: 10251<br>  clusterIP: None<br><br></code></pre></td></tr></table></figure><h2 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim k8s/kube-proxy-prometheus-discovery.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube-proxy-prometheus-discovery<br>  namespace: kube-system<br>  labels:<br>    k8s-app: kube-proxy<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    k8s-app: kube-proxy<br>  ports:<br>  - name: http-metrics<br>    port: 10249<br>    protocol: TCP<br>    targetPort: 10249<br>  clusterIP: None<br><br></code></pre></td></tr></table></figure><h2 id="kube-state-metrics"><a href="#kube-state-metrics" class="headerlink" title="kube-state-metrics"></a>kube-state-metrics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim kube-state-metrics/rbac.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: kube-state-metrics<br>  namespace: monitoring<br>  labels:<br>    app: kube-state-metrics<br> <br>--- <br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  name: kube-state-metrics<br>  labels:<br>    app: kube-state-metrics<br>rules:<br>- apiGroups:<br>  - <span class="hljs-string">&quot;&quot;</span><br>  resources:<br>  - configmaps<br>  - secrets<br>  - nodes<br>  - pods<br>  - services<br>  - resourcequotas<br>  - replicationcontrollers<br>  - limitranges<br>  - persistentvolumeclaims<br>  - persistentvolumes<br>  - namespaces<br>  - endpoints<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - extensions<br>  resources:<br>  - daemonsets<br>  - deployments<br>  - replicasets<br>  - ingresses<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - apps<br>  resources:<br>  - statefulsets<br>  - daemonsets<br>  - deployments<br>  - replicasets<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - batch<br>  resources:<br>  - cronjobs<br>  - <span class="hljs-built_in">jobs</span><br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - autoscaling<br>  resources:<br>  - horizontalpodautoscalers<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - authentication.k8s.io<br>  resources:<br>  - tokenreviews<br>  verbs:<br>  - create<br>- apiGroups:<br>  - authorization.k8s.io<br>  resources:<br>  - subjectaccessreviews<br>  verbs:<br>  - create<br>- apiGroups:<br>  - policy<br>  resources:<br>  - poddisruptionbudgets<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - certificates.k8s.io<br>  resources:<br>  - certificatesigningrequests<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - storage.k8s.io<br>  resources:<br>  - storageclasses<br>  - volumeattachments<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - admissionregistration.k8s.io<br>  resources:<br>  - mutatingwebhookconfigurations<br>  - validatingwebhookconfigurations<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - networking.k8s.io<br>  resources:<br>  - networkpolicies<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - coordination.k8s.io<br>  resources:<br>  - leases<br>  verbs:<br>  - list<br>  - watch<br>  <br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: kube-state-metrics<br>  labels:<br>    app: kube-state-metrics<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: kube-state-metrics<br>subjects:<br>- kind: ServiceAccount<br>  name: kube-state-metrics<br>  namespace: monitoring<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim kube-state-metrics/kube-state-metrics.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube-state-metrics<br>  namespace: monitoring<br>  labels:<br>    app: kube-state-metrics<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>    prometheus.io/http-probe: <span class="hljs-string">&#x27;true&#x27;</span><br>    prometheus.io/http-probe-path: <span class="hljs-string">&#x27;/healthz&#x27;</span><br>    prometheus.io/http-probe-port: <span class="hljs-string">&#x27;8080&#x27;</span><br>spec:<br>  selector:<br>    app: kube-state-metrics<br>  ports:<br>  - name: kube-state-metrics<br>    port: 8080<br>    protocol: TCP<br>    targetPort: 8080<br><br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: kube-state-metrics<br>  namespace: monitoring<br>  labels:<br>    app: kube-state-metrics<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: kube-state-metrics<br>  template:<br>    metadata:<br>      labels:<br>        app: kube-state-metrics<br>    spec:<br>      serviceAccountName: kube-state-metrics<br>      containers:<br>      - name: kube-state-metrics<br>        image: quay.io/coreos/kube-state-metrics:v1.8.0 <br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 8080<br>      <span class="hljs-comment"># Remove nodeSelector and tolerations for random scheduling</span><br><br></code></pre></td></tr></table></figure><h2 id="blackbox-exporter"><a href="#blackbox-exporter" class="headerlink" title="blackbox-exporter"></a>blackbox-exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim blackbox-exporter/config.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: blackbox-exporter<br>  namespace: monitoring<br>  labels:<br>    app: blackbox-exporter<br>data:<br>  blackbox.yml: |-<br>    modules:<br>      http_2xx:<br>        prober: http<br>        <span class="hljs-built_in">timeout</span>: 10s<br>        http:<br>          valid_http_versions: [<span class="hljs-string">&quot;HTTP/1.1&quot;</span>, <span class="hljs-string">&quot;HTTP/2&quot;</span>]<br>          valid_status_codes: []<br>          method: GET<br>          preferred_ip_protocol: <span class="hljs-string">&quot;ip4&quot;</span><br>      http_post_2xx:<br>        prober: http<br>        <span class="hljs-built_in">timeout</span>: 10s<br>        http:<br>          valid_http_versions: [<span class="hljs-string">&quot;HTTP/1.1&quot;</span>, <span class="hljs-string">&quot;HTTP/2&quot;</span>]<br>          method: POST<br>          preferred_ip_protocol: <span class="hljs-string">&quot;ip4&quot;</span><br>      tcp_connect:<br>        prober: tcp<br>        <span class="hljs-built_in">timeout</span>: 10s<br>      icmp:<br>        prober: icmp<br>        <span class="hljs-built_in">timeout</span>: 10s<br>        icmp:<br>          preferred_ip_protocol: <span class="hljs-string">&quot;ip4&quot;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim blackbox-exporter/blackbox-exporter.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: blackbox-exporter<br>  namespace: monitoring<br>  labels:<br>    app: blackbox-exporter<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    app: blackbox-exporter<br>  ports:<br>  - name: blackbox<br>    port: 9115<br>    protocol: TCP<br>    targetPort: 9115<br>    nodePort: 30115<br>  <span class="hljs-built_in">type</span>: NodePort<br>  <br>---  <br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: blackbox-exporter<br>  namespace: monitoring<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: blackbox-exporter<br>  template:<br>    metadata:<br>      labels:<br>        app: blackbox-exporter<br>    spec:<br>      containers:<br>      - name: blackbox-exporter<br>        image: prom/blackbox-exporter:latest<br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 9115<br>        readinessProbe:<br>          tcpSocket:<br>            port: 9115<br>          initialDelaySeconds: 10<br>          timeoutSeconds: 5<br>        resources:<br>          requests:<br>            memory: 50Mi<br>            cpu: 100m<br>          limits:<br>            memory: 60Mi<br>            cpu: 200m<br>        volumeMounts:<br>        - name: config<br>          mountPath: /etc/blackbox_exporter<br>        args:<br>        - <span class="hljs-string">&#x27;--config.file=/etc/blackbox_exporter/blackbox.yml&#x27;</span><br>        - <span class="hljs-string">&#x27;--web.listen-address=:9115&#x27;</span><br>      volumes:<br>      - name: config<br>        configMap:<br>          name: blackbox-exporter<br>      nodeSelector:<br>        node-role.kubernetes.io/master: <span class="hljs-string">&quot;&quot;</span><br>      tolerations:<br>      - key: node-role.kubernetes.io/master<br>        operator: Exists<br>        effect: NoSchedule<br><br></code></pre></td></tr></table></figure><h2 id="dingtalk"><a href="#dingtalk" class="headerlink" title="dingtalk"></a>dingtalk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim dingtalk/config.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: dingtalk-config<br>  namespace: monitoring<br>data:<br>  config.yml: |-<br>    targets:<br>      webhook:<br>        url: https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx             <span class="hljs-comment">#修改为钉钉机器人的webhook</span><br>        mention:<br>          all: <span class="hljs-literal">true</span>             <span class="hljs-comment">#@所有人</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim dingtalk/dingtalk.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: dingtalk<br>  namespace: monitoring<br>  labels:<br>    app: dingtalk<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;false&#x27;</span><br>spec:<br>  selector:<br>    app: dingtalk<br>  ports:<br>  - name: dingtalk<br>    port: 8060<br>    protocol: TCP<br>    targetPort: 8060<br>  <br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: dingtalk<br>  namespace: monitoring<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: dingtalk<br>  template:<br>    metadata:<br>      name: dingtalk<br>      labels:<br>        app: dingtalk<br>    spec:<br>      containers:<br>      - name: dingtalk<br>        image: timonwong/prometheus-webhook-dingtalk:latest<br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 8060<br>        volumeMounts:<br>        - name: config<br>          mountPath: /etc/prometheus-webhook-dingtalk<br>      volumes:<br>      - name: config<br>        configMap:<br>          name: dingtalk-config<br><br></code></pre></td></tr></table></figure><h2 id="alertmanager"><a href="#alertmanager" class="headerlink" title="alertmanager"></a>alertmanager</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim alertmanager/templates.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: alertmanager-templates<br>  namespace: monitoring<br>data:<br>  default.tmpl: |<br>    &#123;&#123; define <span class="hljs-string">&quot;__alertmanager&quot;</span> &#125;&#125;AlertManager&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> &#125;&#125;&#123;&#123; .ExternalURL &#125;&#125;/#/alerts?receiver=&#123;&#123; .Receiver &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;__subject&quot;</span> &#125;&#125;[&#123;&#123; .Status | toUpper &#125;&#125;&#123;&#123; <span class="hljs-keyword">if</span> eq .Status <span class="hljs-string">&quot;firing&quot;</span> &#125;&#125;:&#123;&#123; .Alerts.Firing | len &#125;&#125;&#123;&#123; end &#125;&#125;] &#123;&#123; .GroupLabels.SortedPairs.Values | <span class="hljs-built_in">join</span> <span class="hljs-string">&quot; &quot;</span> &#125;&#125; &#123;&#123; <span class="hljs-keyword">if</span> gt (len .CommonLabels) (len .GroupLabels) &#125;&#125;(&#123;&#123; with .CommonLabels.Remove .GroupLabels.Names &#125;&#125;&#123;&#123; .Values | <span class="hljs-built_in">join</span> <span class="hljs-string">&quot; &quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;)&#123;&#123; end &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;__description&quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;__text_alert_list&quot;</span> &#125;&#125;&#123;&#123; range . &#125;&#125;Labels:<br>    &#123;&#123; range .Labels.SortedPairs &#125;&#125; - &#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;<br>    &#123;&#123; end &#125;&#125;Annotations:<br>    &#123;&#123; range .Annotations.SortedPairs &#125;&#125; - &#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;<br>    &#123;&#123; end &#125;&#125;Source: &#123;&#123; .GeneratorURL &#125;&#125;<br>    &#123;&#123; end &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.title&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.username&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.fallback&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;slack.default.title&quot;</span> . &#125;&#125; | &#123;&#123; template <span class="hljs-string">&quot;slack.default.titlelink&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.pretext&quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.titlelink&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.iconemoji&quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.iconurl&quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.default.text&quot;</span> &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;hipchat.default.from&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;hipchat.default.message&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pagerduty.default.description&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pagerduty.default.client&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pagerduty.default.clientURL&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pagerduty.default.instances&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__text_alert_list&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;opsgenie.default.message&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;opsgenie.default.description&quot;</span> &#125;&#125;&#123;&#123; .CommonAnnotations.SortedPairs.Values | <span class="hljs-built_in">join</span> <span class="hljs-string">&quot; &quot;</span> &#125;&#125;<br>    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Firing) 0 -&#125;&#125;<br>    Alerts Firing:<br>    &#123;&#123; template <span class="hljs-string">&quot;__text_alert_list&quot;</span> .Alerts.Firing &#125;&#125;<br>    &#123;&#123;- end &#125;&#125;<br>    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Resolved) 0 -&#125;&#125;<br>    Alerts Resolved:<br>    &#123;&#123; template <span class="hljs-string">&quot;__text_alert_list&quot;</span> .Alerts.Resolved &#125;&#125;<br>    &#123;&#123;- end &#125;&#125;<br>    &#123;&#123;- end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;opsgenie.default.source&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;victorops.default.message&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125; | &#123;&#123; template <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;victorops.default.from&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;email.default.subject&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;email.default.html&quot;</span> &#125;&#125;<br>    &lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>    &lt;!--<br>    Style and HTML derived from https://github.com/mailgun/transactional-email-templates<br>    The MIT License (MIT)<br>    Copyright (c) 2014 Mailgun<br>    Permission is hereby granted, free of charge, to any person obtaining a copy<br>    of this software and associated documentation files (the <span class="hljs-string">&quot;Software&quot;</span>), to deal<br>    <span class="hljs-keyword">in</span> the Software without restriction, including without limitation the rights<br>    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br>    copies of the Software, and to permit persons to whom the Software is<br>    furnished to <span class="hljs-keyword">do</span> so, subject to the following conditions:<br>    The above copyright notice and this permission notice shall be included <span class="hljs-keyword">in</span> all<br>    copies or substantial portions of the Software.<br>    THE SOFTWARE IS PROVIDED <span class="hljs-string">&quot;AS IS&quot;</span>, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br>    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br>    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br>    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br>    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br>    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE<br>    SOFTWARE.<br>    --&gt;<br>    &lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>    &lt;<span class="hljs-built_in">head</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>    &lt;title style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&lt;/title&gt;<br>    &lt;/head&gt;<br>    &lt;body itemscope=<span class="hljs-string">&quot;&quot;</span> itemtype=<span class="hljs-string">&quot;http://schema.org/EmailMessage&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; height: 100%; line-height: 1.6em; width: 100% !important; background-color: #f6f6f6; margin: 0; padding: 0;&quot;</span> bgcolor=<span class="hljs-string">&quot;#f6f6f6&quot;</span>&gt;<br>    &lt;table style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;&quot;</span> bgcolor=<span class="hljs-string">&quot;#f6f6f6&quot;</span>&gt;<br>      &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>        &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;&lt;/td&gt;<br>        &lt;td width=<span class="hljs-string">&quot;600&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; width: 100% !important; margin: 0 auto; padding: 0;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>          &lt;div style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 0;&quot;</span>&gt;<br>            &lt;table width=<span class="hljs-string">&quot;100%&quot;</span> cellpadding=<span class="hljs-string">&quot;0&quot;</span> cellspacing=<span class="hljs-string">&quot;0&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;&quot;</span> bgcolor=<span class="hljs-string">&quot;#fff&quot;</span>&gt;<br>              &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #E6522C; margin: 0; padding: 20px;&quot;</span> align=<span class="hljs-string">&quot;center&quot;</span> bgcolor=<span class="hljs-string">&quot;#E6522C&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                  &#123;&#123; .Alerts | len &#125;&#125; alert&#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts) 1 &#125;&#125;s&#123;&#123; end &#125;&#125; <span class="hljs-keyword">for</span> &#123;&#123; range .GroupLabels.SortedPairs &#125;&#125;<br>                    &#123;&#123; .Name &#125;&#125;=&#123;&#123; .Value &#125;&#125;<br>                  &#123;&#123; end &#125;&#125;<br>                &lt;/td&gt;<br>              &lt;/tr&gt;<br>              &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 10px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                  &lt;table width=<span class="hljs-string">&quot;100%&quot;</span> cellpadding=<span class="hljs-string">&quot;0&quot;</span> cellspacing=<span class="hljs-string">&quot;0&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;a href=<span class="hljs-string">&quot;&#123;&#123; template &quot;</span>__alertmanagerURL<span class="hljs-string">&quot; . &#125;&#125;&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;&quot;</span>&gt;View <span class="hljs-keyword">in</span> &#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&lt;/a&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Firing) 0 &#125;&#125;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;[&#123;&#123; .Alerts.Firing | len &#125;&#125;] Firing&lt;/strong&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &#123;&#123; end &#125;&#125;<br>                    &#123;&#123; range .Alerts.Firing &#125;&#125;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;Labels&lt;/strong&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                        &#123;&#123; range .Labels.SortedPairs &#125;&#125;&#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Annotations) 0 &#125;&#125;&lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;Annotations&lt;/strong&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &#123;&#123; range .Annotations.SortedPairs &#125;&#125;&#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &lt;a href=<span class="hljs-string">&quot;&#123;&#123; .GeneratorURL &#125;&#125;&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #348eda; text-decoration: underline; margin: 0;&quot;</span>&gt;Source&lt;/a&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &#123;&#123; end &#125;&#125;<br>                    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Resolved) 0 &#125;&#125;<br>                      &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Firing) 0 &#125;&#125;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                        &lt;hr style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                        &lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                      &#123;&#123; end &#125;&#125;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;[&#123;&#123; .Alerts.Resolved | len &#125;&#125;] Resolved&lt;/strong&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &#123;&#123; end &#125;&#125;<br>                    &#123;&#123; range .Alerts.Resolved &#125;&#125;<br>                    &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                      &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;<br>                        &lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;Labels&lt;/strong&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                        &#123;&#123; range .Labels.SortedPairs &#125;&#125;&#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Annotations) 0 &#125;&#125;&lt;strong style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;Annotations&lt;/strong&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &#123;&#123; range .Annotations.SortedPairs &#125;&#125;&#123;&#123; .Name &#125;&#125; = &#123;&#123; .Value &#125;&#125;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;&#123;&#123; end &#125;&#125;<br>                        &lt;a href=<span class="hljs-string">&quot;&#123;&#123; .GeneratorURL &#125;&#125;&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #348eda; text-decoration: underline; margin: 0;&quot;</span>&gt;Source&lt;/a&gt;&lt;br style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span> /&gt;<br>                      &lt;/td&gt;<br>                    &lt;/tr&gt;<br>                    &#123;&#123; end &#125;&#125;<br>                  &lt;/table&gt;<br>                &lt;/td&gt;<br>              &lt;/tr&gt;<br>            &lt;/table&gt;<br>            &lt;div style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;&quot;</span>&gt;<br>              &lt;table width=<span class="hljs-string">&quot;100%&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                &lt;<span class="hljs-built_in">tr</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;</span>&gt;<br>                  &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; text-align: center; color: #999; margin: 0; padding: 0 0 20px;&quot;</span> align=<span class="hljs-string">&quot;center&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;&lt;a href=<span class="hljs-string">&quot;&#123;&#123; .ExternalURL &#125;&#125;&quot;</span> style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;&quot;</span>&gt;Sent by &#123;&#123; template <span class="hljs-string">&quot;__alertmanager&quot;</span> . &#125;&#125;&lt;/a&gt;&lt;/td&gt;<br>                &lt;/tr&gt;<br>              &lt;/table&gt;<br>            &lt;/div&gt;&lt;/div&gt;<br>        &lt;/td&gt;<br>        &lt;td style=<span class="hljs-string">&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;&quot;</span> valign=<span class="hljs-string">&quot;top&quot;</span>&gt;&lt;/td&gt;<br>      &lt;/tr&gt;<br>    &lt;/table&gt;<br>    &lt;/body&gt;<br>    &lt;/html&gt;<br>    &#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pushover.default.title&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__subject&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pushover.default.message&quot;</span> &#125;&#125;&#123;&#123; .CommonAnnotations.SortedPairs.Values | <span class="hljs-built_in">join</span> <span class="hljs-string">&quot; &quot;</span> &#125;&#125;<br>    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Firing) 0 &#125;&#125;<br>    Alerts Firing:<br>    &#123;&#123; template <span class="hljs-string">&quot;__text_alert_list&quot;</span> .Alerts.Firing &#125;&#125;<br>    &#123;&#123; end &#125;&#125;<br>    &#123;&#123; <span class="hljs-keyword">if</span> gt (len .Alerts.Resolved) 0 &#125;&#125;<br>    Alerts Resolved:<br>    &#123;&#123; template <span class="hljs-string">&quot;__text_alert_list&quot;</span> .Alerts.Resolved &#125;&#125;<br>    &#123;&#123; end &#125;&#125;<br>    &#123;&#123; end &#125;&#125;<br>    &#123;&#123; define <span class="hljs-string">&quot;pushover.default.url&quot;</span> &#125;&#125;&#123;&#123; template <span class="hljs-string">&quot;__alertmanagerURL&quot;</span> . &#125;&#125;&#123;&#123; end &#125;&#125;<br>  slack.tmpl: |<br>    &#123;&#123; define <span class="hljs-string">&quot;slack.devops.text&quot;</span> &#125;&#125;<br>    &#123;&#123;range .Alerts&#125;&#125;&#123;&#123;.Annotations.DESCRIPTION&#125;&#125;<br>    &#123;&#123;end&#125;&#125;<br>    &#123;&#123; end &#125;&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim alertmanager/config.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: alertmanager-config<br>  namespace: monitoring<br>data:<br>  config.yml: |-<br>    global:<br>      resolve_timeout: 5m<br>      smtp_smarthost: <span class="hljs-string">&#x27;smtp.163.com:465&#x27;</span>                <span class="hljs-comment">#邮箱smtp服务器代理，启用SSL发信, 端口一般是465</span><br>      smtp_from: <span class="hljs-string">&#x27;alert@163.com&#x27;</span>                <span class="hljs-comment">#发送邮箱名称</span><br>      smtp_auth_username: <span class="hljs-string">&#x27;alert@163.com&#x27;</span>               <span class="hljs-comment">#邮箱名称</span><br>      smtp_auth_password: <span class="hljs-string">&#x27;password&#x27;</span>                <span class="hljs-comment">#邮箱密码或授权码</span><br>      smtp_require_tls: <span class="hljs-literal">false</span><br>    templates:<br>    - <span class="hljs-string">&#x27;/etc/templates/*.tmpl&#x27;</span><br>    route:<br>      receiver: <span class="hljs-string">&#x27;default&#x27;</span><br>      group_wait: 10s<br>      group_interval: 1m<br>      repeat_interval: 1h<br>      group_by: [<span class="hljs-string">&#x27;alertname&#x27;</span>, <span class="hljs-string">&#x27;instance&#x27;</span>, <span class="hljs-string">&#x27;cluster&#x27;</span>, <span class="hljs-string">&#x27;service&#x27;</span>]<br>      routes:<br>      - receiver: <span class="hljs-string">&#x27;default&#x27;</span><br>        match:<br>          severity: <span class="hljs-string">&#x27;warning&#x27;</span><br>      - receiver: <span class="hljs-string">&#x27;dingtalk&#x27;</span><br>        match:<br>          severity: <span class="hljs-string">&#x27;critical&#x27;</span><br>    inhibit_rules:<br>    - source_match:<br>        severity: <span class="hljs-string">&#x27;critical&#x27;</span><br>      target_match:<br>        severity: <span class="hljs-string">&#x27;warning&#x27;</span><br>      equal: [<span class="hljs-string">&#x27;alertname&#x27;</span>, <span class="hljs-string">&#x27;instance&#x27;</span>, <span class="hljs-string">&#x27;cluster&#x27;</span>, <span class="hljs-string">&#x27;service&#x27;</span>]<br>    receivers:<br>    - name: <span class="hljs-string">&#x27;default&#x27;</span><br>      email_configs:<br>      - to: <span class="hljs-string">&#x27;receiver@163.com&#x27;</span><br>        send_resolved: <span class="hljs-literal">true</span><br>    - name: <span class="hljs-string">&#x27;dingtalk&#x27;</span><br>      webhook_configs:<br>      - url: <span class="hljs-string">&#x27;http://dingtalk:8060/dingtalk/webhook/send&#x27;</span><br>        send_resolved: <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim alertmanager/alertmanager.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  name: alertmanager<br>  namespace: monitoring<br>spec:<br>  rules:<br>  - host: 10.100.30.70<br>    http:<br>      paths:<br>      - path: /<br>        backend:<br>          serviceName: alertmanager<br>          servicePort: 9093<br>          <br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: alertmanager<br>  namespace: monitoring<br>  labels:<br>    name: alertmanager<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    app: alertmanager<br>  ports:<br>  - name: alertmanager<br>    port: 9093<br>    protocol: TCP<br>    targetPort: 9093<br>    <br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: alertmanager<br>  namespace: monitoring<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: alertmanager<br>  template:<br>    metadata:<br>      name: alertmanager<br>      labels:<br>        app: alertmanager<br>    spec:<br>      containers:<br>      - name: alertmanager<br>        image: prom/alertmanager:latest<br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 9093<br>        <span class="hljs-built_in">env</span>:<br>        - name: POD_IP<br>          valueFrom:<br>            fieldRef:<br>              apiVersion: v1<br>              fieldPath: status.podIP<br>        args:<br>          - <span class="hljs-string">&quot;--config.file=/etc/alertmanager/config.yml&quot;</span><br>          - <span class="hljs-string">&quot;--storage.path=/alertmanager&quot;</span><br>          - <span class="hljs-string">&quot;--cluster.advertise-address=<span class="hljs-subst">$(POD_IP)</span>:6783&quot;</span>                <span class="hljs-comment">#没有该参数会报错：Failed to get final advertise address</span><br>        volumeMounts:<br>        - name: config<br>          mountPath: /etc/alertmanager<br>        - name: templates<br>          mountPath: /etc/templates<br>        - name: alertmanager<br>          mountPath: /alertmanager<br>      volumes:<br>      - name: config<br>        configMap:<br>          name: alertmanager-config<br>      - name: templates<br>        configMap:<br>          name: alertmanager-templates<br>      - name: alertmanager<br>        emptyDir: &#123;&#125;<br><br></code></pre></td></tr></table></figure><h2 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a>prometheus</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim prometheus/rbac.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: prometheus<br>  namespace: monitoring<br><br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  name: prometheus<br>rules:<br>- apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>  resources:<br>  - nodes<br>  - nodes/proxy<br>  - services<br>  - endpoints<br>  - pods<br>  verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>- apiGroups: [<span class="hljs-string">&quot;networking.k8s.io&quot;</span>]<br>  resources:<br>  - ingresses<br>  verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>- apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>  resources:<br>  - configmaps<br>  verbs: [<span class="hljs-string">&quot;get&quot;</span>]<br>- nonResourceURLs: [<span class="hljs-string">&quot;/metrics&quot;</span>]<br>  verbs: [<span class="hljs-string">&quot;get&quot;</span>]<br><br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: prometheus<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: prometheus<br>subjects:<br>- kind: ServiceAccount<br>  name: prometheus<br>  namespace: monitoring<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim prometheus/config.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: prometheus-config<br>  namespace: monitoring<br>data:<br>  prometheus.yml: |<br>    global:<br>      scrape_interval: 10s<br>      scrape_timeout: 10s<br>      evaluation_interval: 10s<br>    alerting:<br>      alertmanagers:<br>      - static_configs:<br>        - targets:<br>          - alertmanager:9093<br>    rule_files:<br>      - <span class="hljs-string">&quot;/etc/prometheus-rules/*.rules&quot;</span><br>    scrape_configs:<br>      - job_name: <span class="hljs-string">&#x27;node-exporter&#x27;</span>                <span class="hljs-comment">#node节点性能指标数据</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_endpoint_port_name]<br>          regex: <span class="hljs-literal">true</span>;node-exporter<br>          action: keep<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]<br>          action: replace<br>          target_label: __scheme__<br>          regex: (https?)<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]<br>          action: replace<br>          target_label: __metrics_path__<br>          regex: (.+)<br>        - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]<br>          action: replace<br>          target_label: __address__<br>          regex: (.+)(?::\d+);(\d+)<br>          replacement: <span class="hljs-variable">$1</span>:<span class="hljs-variable">$2</span><br>        - action: labelmap<br>          regex: __meta_kubernetes_service_label_(.+)<br>        - source_labels: [__meta_kubernetes_namespace]<br>          action: replace<br>          target_label: kubernetes_namespace<br>        - source_labels: [__meta_kubernetes_service_name]<br>          action: replace<br>          target_label: kubernetes_name<br>          <br>      - job_name: <span class="hljs-string">&#x27;kube-apiservers&#x27;</span><br>        scheme: https<br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]<br>          regex: default;kubernetes;https<br>          action: keep<br>        <br>      - job_name: <span class="hljs-string">&#x27;kube-controller-manager&#x27;</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_namespace, __meta_kubernetes_service_name]<br>          regex: <span class="hljs-literal">true</span>;kube-system;kube-controller-manager-prometheus-discovery<br>          action: keep<br>          <br>      - job_name: <span class="hljs-string">&#x27;kube-scheduler&#x27;</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_namespace, __meta_kubernetes_service_name]<br>          regex: <span class="hljs-literal">true</span>;kube-system;kube-scheduler-prometheus-discovery<br>          action: keep<br>          <br>      - job_name: <span class="hljs-string">&#x27;kubelet&#x27;</span><br>        scheme: https<br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: node<br>        relabel_configs:<br>        - action: labelmap<br>          regex: __meta_kubernetes_node_label_(.+)<br>        - target_label: __address__<br>          replacement: 192.168.30.188:6443<br>        - source_labels: [__meta_kubernetes_node_name]<br>          regex: (.+)<br>          target_label: __metrics_path__<br>          replacement: /api/v1/nodes/<span class="hljs-variable">$&#123;1&#125;</span>/proxy/metrics<br><br>      - job_name: <span class="hljs-string">&#x27;kube-proxy&#x27;</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_namespace, __meta_kubernetes_service_name]<br>          regex: <span class="hljs-literal">true</span>;kube-system;kube-proxy-prometheus-discovery<br>          action: keep<br><br>      - job_name: <span class="hljs-string">&#x27;kubernetes-cadvisor&#x27;</span>                <span class="hljs-comment">#容器、Pod相关的性能指标数据</span><br>        scheme: https<br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: node<br>        relabel_configs:<br>        - action: labelmap<br>          regex: __meta_kubernetes_node_label_(.+)<br>        - target_label: __address__<br>          replacement: 192.168.30.188:6443<br>        - source_labels: [__meta_kubernetes_node_name]<br>          regex: (.+)<br>          target_label: __metrics_path__<br>          replacement: /api/v1/nodes/<span class="hljs-variable">$&#123;1&#125;</span>/proxy/metrics/cadvisor<br>        metric_relabel_configs:<br>        - source_labels: [<span class="hljs-built_in">id</span>]<br>          action: replace<br>          regex: <span class="hljs-string">&#x27;^/machine\.slice/machine-rkt\\x2d([^\\]+)\\.+/([^/]+)\.service$&#x27;</span><br>          target_label: rkt_container_name<br>          replacement: <span class="hljs-string">&#x27;$&#123;2&#125;-$&#123;1&#125;&#x27;</span><br>        - source_labels: [<span class="hljs-built_in">id</span>]<br>          action: replace<br>          regex: <span class="hljs-string">&#x27;^/system\.slice/(.+)\.service$&#x27;</span><br>          target_label: systemd_service_name<br>          replacement: <span class="hljs-string">&#x27;$&#123;1&#125;&#x27;</span><br>          <br>      - job_name: <span class="hljs-string">&#x27;kube-state-metrics&#x27;</span>              <span class="hljs-comment">#资源对象(Deployment、Pod等)的状态</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: endpoints<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_endpoint_port_name]<br>          regex: <span class="hljs-literal">true</span>;kube-state-metrics<br>          action: keep<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]<br>          action: replace<br>          target_label: __scheme__<br>          regex: (https?)<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]<br>          action: replace<br>          target_label: __metrics_path__<br>          regex: (.+)<br>        - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]<br>          action: replace<br>          target_label: __address__<br>          regex: (.+)(?::\d+);(\d+)<br>          replacement: <span class="hljs-variable">$1</span>:<span class="hljs-variable">$2</span><br>        - action: labelmap<br>          regex: __meta_kubernetes_service_label_(.+)<br>        - source_labels: [__meta_kubernetes_namespace]<br>          action: replace<br>          target_label: kubernetes_namespace<br>        - source_labels: [__meta_kubernetes_service_name]<br>          action: replace<br>          target_label: kubernetes_name<br>          <br>      - job_name: <span class="hljs-string">&#x27;kubernetes-service-http-probe&#x27;</span>               <span class="hljs-comment">#通过http方式探测Service状态</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: service<br>        metrics_path: /probe<br>        params:<br>          module: [http_2xx]<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_service_annotation_prometheus_io_http_probe]<br>          regex: <span class="hljs-literal">true</span>;<span class="hljs-literal">true</span><br>          action: keep<br>        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_namespace, __meta_kubernetes_service_annotation_prometheus_io_http_probe_port, __meta_kubernetes_service_annotation_prometheus_io_http_probe_path]<br>          action: replace<br>          target_label: __param_target<br>          regex: (.+);(.+);(.+);(.+)<br>          replacement: <span class="hljs-variable">$1</span>.<span class="hljs-variable">$2</span>:$3<span class="hljs-variable">$4</span><br>        - target_label: __address__<br>          replacement: 192.168.30.128:30115<br>        - source_labels: [__param_target]<br>          target_label: instance<br>        - action: labelmap<br>          regex: __meta_kubernetes_service_annotation_prometheus_io_app_info_(.+)<br><br>      - job_name: <span class="hljs-string">&#x27;kubernetes-service-tcp-probe&#x27;</span>                <span class="hljs-comment">#通过tcp方式探测Service状态</span><br>        tls_config:<br>          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt<br>        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token<br>        kubernetes_sd_configs:<br>        - role: service<br>        metrics_path: /probe<br>        params:<br>          module: [tcp_connect]<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_service_annotation_prometheus_io_tcp_probe]<br>          regex: <span class="hljs-literal">true</span>;<span class="hljs-literal">true</span><br>          action: keep<br>        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_namespace, __meta_kubernetes_service_annotation_prometheus_io_tcp_probe_port]<br>          action: replace<br>          target_label: __param_target<br>          regex: (.+);(.+);(.+)<br>          replacement: <span class="hljs-variable">$1</span>.<span class="hljs-variable">$2</span>:<span class="hljs-variable">$3</span><br>        - target_label: __address__<br>          replacement: 192.168.30.128:30115<br>        - source_labels: [__param_target]<br>          target_label: instance<br>        - action: labelmap<br>          regex: __meta_kubernetes_service_annotation_prometheus_io_app_info_(.+)<br>          <br>      - job_name: <span class="hljs-string">&#x27;kubernetes-ingresses&#x27;</span>              <span class="hljs-comment">#通过http方式探测ingresses状态</span><br>        kubernetes_sd_configs:<br>        - role: ingress<br>        metrics_path: /probe<br>        params:<br>          module: [http_2xx]<br>        relabel_configs:<br>        - source_labels: [__meta_kubernetes_ingress_scheme, __address__, __meta_kubernetes_ingress_path]<br>          regex: (.+);(.+);(.+)<br>          replacement: <span class="hljs-variable">$&#123;1&#125;</span>://<span class="hljs-variable">$&#123;2&#125;</span><span class="hljs-variable">$&#123;3&#125;</span><br>          target_label: __param_target<br>        - target_label: __address__<br>          replacement: 192.168.30.128:30115<br>        - source_labels: [__param_target]<br>          target_label: instance<br>        - action: labelmap<br>          regex: __meta_kubernetes_ingress_label_(.+)<br>        - source_labels: [__meta_kubernetes_namespace]<br>          target_label: kubernetes_namespace<br>        - source_labels: [__meta_kubernetes_ingress_name]<br>          target_label: kubernetes_name<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim prometheus/rules.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: prometheus-rules<br>  namespace: monitoring<br>data:<br>  node.rules: |<br>    <span class="hljs-built_in">groups</span>:<br>    - name: node<br>      rules:<br>      - alert: NodeDown<br>        <span class="hljs-built_in">expr</span>: up == 0<br>        <span class="hljs-keyword">for</span>: 3m<br>        labels:<br>          severity: critical<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$labels</span>.instance &#125;&#125;: down&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$labels</span>.instance &#125;&#125; has been down for more than 3m&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br>      - alert: NodeCPUHigh<br>        <span class="hljs-built_in">expr</span>: (1 - avg by (instance) (irate(node_cpu_seconds_total&#123;mode=<span class="hljs-string">&quot;idle&quot;</span>&#125;[5m]))) * 100 &gt; 75<br>        <span class="hljs-keyword">for</span>: 5m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: High CPU usage&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: CPU usage is above 75%&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br>      - alert: NodeCPUIowaitHigh<br>        <span class="hljs-built_in">expr</span>: avg by (instance) (irate(node_cpu_seconds_total&#123;mode=<span class="hljs-string">&quot;iowait&quot;</span>&#125;[5m])) * 100 &gt; 50<br>        <span class="hljs-keyword">for</span>: 5m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: High CPU iowait usage&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: CPU iowait usage is above 50%&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br>      - alert: NodeMemoryUsageHigh<br>        <span class="hljs-built_in">expr</span>: (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 &gt; 90<br>        <span class="hljs-keyword">for</span>: 5m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: High memory usage&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Memory usage is above 90%&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br>      - alert: NodeDiskRootLow<br>        <span class="hljs-built_in">expr</span>: (1 - node_filesystem_avail_bytes&#123;fstype=~<span class="hljs-string">&quot;ext.*|xfs&quot;</span>,mountpoint =<span class="hljs-string">&quot;/&quot;</span>&#125; / node_filesystem_size_bytes&#123;fstype=~<span class="hljs-string">&quot;ext.*|xfs&quot;</span>,mountpoint =<span class="hljs-string">&quot;/&quot;</span>&#125;) * 100 &gt; 80<br>        <span class="hljs-keyword">for</span>: 10m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Low disk(the / partition) space&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Disk(the / partition) usage is above 80%&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br>        <br>      - alert: NodeDiskBootLow<br>        <span class="hljs-built_in">expr</span>: (1 - node_filesystem_avail_bytes&#123;fstype=~<span class="hljs-string">&quot;ext.*|xfs&quot;</span>,mountpoint =<span class="hljs-string">&quot;/boot&quot;</span>&#125; / node_filesystem_size_bytes&#123;fstype=~<span class="hljs-string">&quot;ext.*|xfs&quot;</span>,mountpoint =<span class="hljs-string">&quot;/boot&quot;</span>&#125;) * 100 &gt; 80<br>        <span class="hljs-keyword">for</span>: 10m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Low disk(the /boot partition) space&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Disk(the /boot partition) usage is above 80%&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br>      - alert: NodeLoad5High<br>        <span class="hljs-built_in">expr</span>: (node_load5) &gt; (count by (instance) (node_cpu_seconds_total&#123;mode=<span class="hljs-string">&#x27;system&#x27;</span>&#125;) * 2)<br>        <span class="hljs-keyword">for</span>: 5m<br>        labels:<br>          severity: warning<br>        annotations:<br>          summary: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Load(5m) High&quot;</span><br>          description: <span class="hljs-string">&quot;&#123;&#123;<span class="hljs-variable">$labels</span>.instance&#125;&#125;: Load(5m) is 2 times the number of CPU cores&quot;</span><br>          value: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$value</span> &#125;&#125;&quot;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim prometheus/prometheus.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  name: prometheus<br>  namespace: monitoring<br>spec:<br>  rules:<br>  - host: prometheus.lzxlinux.cn<br>    http:<br>      paths:<br>      - path: /<br>        pathType: Prefix<br>        backend:<br>          service:<br>            name: prometheus<br>            port:<br>              number: 9090<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: prometheus<br>  namespace: monitoring<br>  labels:<br>    app: prometheus<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>spec:<br>  selector:<br>    app: prometheus<br>  ports:<br>  - name: prometheus<br>    port: 9090<br>    protocol: TCP<br>    targetPort: 9090<br><br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: prometheus<br>  namespace: monitoring<br>  labels:<br>    app: prometheus<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: prometheus<br>  template:<br>    metadata:<br>      labels:<br>        app: prometheus<br>    spec:<br>      serviceAccountName: prometheus<br>      containers:<br>      - name: prometheus<br>        image: prom/prometheus:latest<br>        imagePullPolicy: IfNotPresent<br>        args:<br>          - <span class="hljs-string">&#x27;--storage.tsdb.path=/prometheus&#x27;</span><br>          - <span class="hljs-string">&#x27;--storage.tsdb.retention.time=30d&#x27;</span><br>          - <span class="hljs-string">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><br>        ports:<br>        - containerPort: 9090<br>        resources:<br>          requests:<br>            cpu: 500m<br>            memory: 500M<br>          limits:<br>            cpu: 500m<br>            memory: 500M<br>        volumeMounts:<br>        - name: config<br>          mountPath: /etc/prometheus<br>        - name: rules<br>          mountPath: /etc/prometheus-rules<br>        - name: prometheus<br>          mountPath: /prometheus<br>      volumes:<br>      - name: config<br>        configMap:<br>          name: prometheus-config<br>      - name: rules<br>        configMap:<br>          name: prometheus-rules<br>      - name: prometheus<br>        emptyDir: &#123;&#125;<br>      nodeSelector:<br>        node-role.kubernetes.io/master: <span class="hljs-string">&quot;&quot;</span><br>        kubernetes.io/hostname: <span class="hljs-string">&quot;master2&quot;</span><br>      tolerations:<br>      - key: node-role.kubernetes.io/master<br>        operator: Exists<br>        effect: NoSchedule<br><br></code></pre></td></tr></table></figure><h2 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim grafana/secret.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Secret<br>metadata:<br>  name: grafana<br>  namespace: monitoring<br>data:<br>  admin-password: YWRtaW4=              <span class="hljs-comment"># base64 加解密</span><br>  admin-username: YWRtaW4=<br><span class="hljs-built_in">type</span>: Opaque<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim grafana/grafana.yaml<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: grafana<br>  namespace: monitoring<br>  labels:<br>    app: grafana<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>    prometheus.io/path: <span class="hljs-string">&#x27;/metrics&#x27;</span><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort<br>  selector:<br>    app: grafana<br>  ports:<br>  - name: grafana<br>    port: 3000<br>    protocol: TCP<br>    targetPort: 3000<br>    nodePort: 32000  <span class="hljs-comment"># 确保这个端口在你的范围内</span><br><br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: grafana<br>  namespace: monitoring<br>  labels:<br>    app: grafana<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: grafana<br>  template:<br>    metadata:<br>      labels:<br>        app: grafana<br>    spec:<br>      containers:<br>      - name: grafana<br>        image: grafana/grafana:latest<br>        imagePullPolicy: IfNotPresent<br>        ports:<br>        - containerPort: 3000<br>          name: grafana<br>        resources:<br>          limits:<br>            cpu: 100m<br>            memory: 100Mi<br>          requests:<br>            cpu: 100m<br>            memory: 100Mi<br>        <span class="hljs-built_in">env</span>:<br>          - name: GF_AUTH_BASIC_ENABLED<br>            value: <span class="hljs-string">&quot;true&quot;</span><br>          - name: GF_AUTH_ANONYMOUS_ENABLED<br>            value: <span class="hljs-string">&quot;false&quot;</span><br>          - name: GF_AUTH_ANONYMOUS_ORG_ROLE<br>            value: Admin<br>          - name: GF_DASHBOARDS_JSON_ENABLED<br>            value: <span class="hljs-string">&quot;true&quot;</span><br>          - name: GF_INSTALL_PLUGINS<br>            value: grafana-kubernetes-app<br>          - name: GF_SECURITY_ADMIN_USER<br>            valueFrom:<br>              secretKeyRef:<br>                name: grafana<br>                key: admin-username<br>          - name: GF_SECURITY_ADMIN_PASSWORD<br>            valueFrom:<br>              secretKeyRef:<br>                name: grafana<br>                key: admin-password<br>        readinessProbe:<br>          httpGet:<br>            path: /login<br>            port: 3000<br>          initialDelaySeconds: 10<br>          timeoutSeconds: 5<br>        volumeMounts:<br>        - name: grafana-storage<br>          mountPath: /var/lib/grafana<br>      volumes:<br>      - name: grafana-storage<br>        emptyDir: &#123;&#125;<br><br></code></pre></td></tr></table></figure><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f namespace.yaml<br><br>kubectl apply -f node-exporter/<br><br>kubectl apply -f k8s/<br><br>kubectl apply -f kube-state-metrics/<br><br>kubectl apply -f blackbox-exporter/<br><br>kubectl apply -f dingtalk/<br><br>kubectl apply -f alertmanager/<br><br>kubectl apply -f prometheus/<br><br>kubectl apply -f grafana/<br><br></code></pre></td></tr></table></figure><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get all -n monitoring<br><br>NAME                                      READY   STATUS    RESTARTS   AGE<br>pod/alertmanager-9c4bf8565-z9mp9          1/1     Running   0          2m54s<br>pod/blackbox-exporter-57d847fc4c-mq8mx    1/1     Running   0          2m58s<br>pod/dingtalk-957f5896-9bd9b               1/1     Running   0          2m56s<br>pod/grafana-76779dc8cf-2fk4x              1/1     Running   0          2m46s<br>pod/kube-state-metrics-5d5f7cd774-tw4sw   1/1     Running   0          2m58s<br>pod/node-exporter-29bkg                   1/1     Running   0          3m5s<br>pod/node-exporter-45k2d                   1/1     Running   0          3m5s<br>pod/node-exporter-8dbts                   1/1     Running   0          3m5s<br>pod/node-exporter-9kwwt                   1/1     Running   0          3m5s<br>pod/node-exporter-bxhcf                   1/1     Running   0          3m5s<br>pod/prometheus-65848cf9b4-m5kcf           1/1     Running   0          2m49s<br><br>NAME                         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE<br>service/alertmanager         ClusterIP   10.98.52.72      &lt;none&gt;        9093/TCP         2m55s<br>service/blackbox-exporter    NodePort    10.106.73.127    &lt;none&gt;        9115:30115/TCP   2m58s<br>service/dingtalk             ClusterIP   10.103.205.136   &lt;none&gt;        8060/TCP         2m57s<br>service/grafana              ClusterIP   10.103.12.113    &lt;none&gt;        3000/TCP         2m47s<br>service/kube-state-metrics   ClusterIP   10.98.99.215     &lt;none&gt;        8080/TCP         3m1s<br>service/node-exporter        ClusterIP   None             &lt;none&gt;        9100/TCP         3m6s<br>service/prometheus           ClusterIP   10.99.50.109     &lt;none&gt;        9090/TCP         2m51s<br><br>NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE<br>daemonset.apps/node-exporter   5         5         5       5            5           &lt;none&gt;          3m5s<br><br>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/alertmanager         1/1     1            1           2m55s<br>deployment.apps/blackbox-exporter    1/1     1            1           2m58s<br>deployment.apps/dingtalk             1/1     1            1           2m57s<br>deployment.apps/grafana              1/1     1            1           2m46s<br>deployment.apps/kube-state-metrics   1/1     1            1           3m<br>deployment.apps/prometheus           1/1     1            1           2m51s<br><br>NAME                                            DESIRED   CURRENT   READY   AGE<br>replicaset.apps/alertmanager-9c4bf8565          1         1         1       2m55s<br>replicaset.apps/blackbox-exporter-57d847fc4c    1         1         1       2m58s<br>replicaset.apps/dingtalk-957f5896               1         1         1       2m56s<br>replicaset.apps/grafana-76779dc8cf              1         1         1       2m46s<br>replicaset.apps/kube-state-metrics-5d5f7cd774   1         1         1       3m<br>replicaset.apps/prometheus-65848cf9b4           1         1         1       2m51s<br><br></code></pre></td></tr></table></figure><h2 id="grafana模板"><a href="#grafana模板" class="headerlink" title="grafana模板"></a>grafana模板</h2><p><code>8919</code></p><h2 id="grafana配置kubernetes数据源"><a href="#grafana配置kubernetes数据源" class="headerlink" title="grafana配置kubernetes数据源"></a>grafana配置kubernetes数据源</h2><p><code>启动插件：plugins--kubeernetes--enable</code>，然后配置集群访问地址及访问证书</p><p><code>如果是通过kubeadm方式搭建的k8s集群，会有一个/etc/kubernetes/admin.conf文件，里面包含了客户端的证书和密码base64编码</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/kubernetes/admin.conf<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>clusters:<br>- cluster:<br>    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01EVXhNakV3TURBek1Gb1hEVE13TURVeE1ERXdNREF6TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTDVpCmYxTGcxUUlqN0VlWlZ0cVFmS3dGZjg4V3NVbVVialZldll5NDZTUittMWpwRWdvM2wxWEIvZHBFNzRWOGtqTGQKZkdGdmVWZkVxNy8rMzdyamNGMXRpSm1BbThLZnMrMW9QdEpLOE0yZjNTSm5FZVVIQUlBeFl2cUE4ZFNsbThTQwpmSkJWU2J3K1pROTBTelpKNzdQUzFuZTBmYnRod0Y2VHE0Uy9FV3h3cUZZMzF5cENub05lVUNtcElsSjVnYWdtCnJ2QmhkTmFNb2oyQlRrMWNDVjh3dkRVS3RlbXFVYVE4R2ZCalZLeHhkdWtwcjJ3S3RPbXZkem1vMEdLSE11MFcKWmQ1TVd0dStIQVZrTXhzcE95Yk41NkFkNnloUkN5YkFJbTN2ZWJlTFV5cjBEY2JhNzJXNVlPRHRCY3ZBOEJxOAoxR1JQc1EwaXBUdGtYbDVCZEhzQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJS0lIb25wVllFWWpwR3JrN2wraGJyeGlxZXkKeGFQT1M3UW5TZEVZMC94TWtiUWxKcy9rUFcxU2lVemdoUk4wQWJxMnFtTXVuNHhlZ0pLdGVPNXhYRGJZNEhZbgpVVCtPWG0rQ1hBQjd3S3pYcDlmUTZBUDk3cmY0L2FRaXlGZEtsZUJ6Y3JNUkErZHZWTjk3NGlHUW94aFh3T1FNCmZXeGNrMDNhU0Qvc2s5UnJrcFhlL1g2NHQrV3BkUlFGRjE2YVFlSHVxNnJQRWZTR2VPUWVpcVIrQVgvdWpIOHoKZzJZY2JKWE85U3ZheXcyb3oxSlozTUx6K0FpeE5RTHFNYU00Tm43TklvMExxUHFqNzZoU3d1Qk1nREE0VnFtZAowZHRtS211OVZjTGZHcW9ITnZnajlTYlVlZ1crL3VEbzcwVXdvb2NGTmlnSnRnOVVSZWpEUXJJSm4rUT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=<br>    server: https://192.168.30.188:6443<br>  name: kubernetes<br>contexts:<br>- context:<br>    cluster: kubernetes<br>    user: kubernetes-admin<br>  name: kubernetes-admin@kubernetes<br>current-context: kubernetes-admin@kubernetes<br>kind: Config<br>preferences: &#123;&#125;<br><span class="hljs-built_in">users</span>:<br>- name: kubernetes-admin<br>  user:<br>    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJZWtMYS9Fc1ZDSGd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TURBMU1USXhNREF3TXpCYUZ3MHlNVEExTVRJeE1EQXdNekphTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXJ2a084MUg0ZW9zak5kM3oKSy9UUEhHcGtCR1FvZm1hbm9ldjRlWXNmUTlPZW0wYzBvVUJ3cXoxM2JabmJUbmJweFFqbmdZMkc4bHF4UmkwaQpCdlA2ZmtmS0ZFQlZzUTd4dGlqZXBrdnByWEdPL08wUUE1U0k4NHJzTjVHOVhOa2pQbWdzYTBlblZxNUVvRTBGClRaNXpRRjlwUlkxWUZZZXYrTDE1bU5FaXlScUg4UDJRY3BoUmxWK09IUXVHaVdLNEhIRVB2QWw2QUpJeWN6d3MKWWMrdk1IdHlZbmF5NUMwUldVWHhyUmc0ZytKMksrY1h1YlF0elhXdjdxaTNhNjFDekpaZi9TZkNOd0Jyam9zRwp0b215WEJWNVZTVGJUYVk1OFZrLzFPK1NSc3BybjF3TDc0djdXUXVEaE9ydXhBRXpuYmRXWWxOMEZBMm5MTjlZCmwxWkVKUUlEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFHazlIRDAxRmRRUnd4THhGUi8yRjdPM2ZpdGRFV3pDTC9UawpsZUxZaGlQaVh3NjNwOGtWU0VabEIyNEYzNEd2WlB3YS9LWnNUQnZXM0Mwek9uNGpHQ2hueHEvaVdqTWFnVEdBCktPUFV2bUI2VzhvVzhlb0lrSStOOEs0NFhSRnZzeGIwNUtqaCtwd0VZZzJUQXpBNEFlQzlnSjZYaTBzbHpnVnIKcWRzbXZtV0QzNEdXYzJOcVIzSDA3cW43RlJwRHIrTjlrTHE4Ukt4L0YwMWNCV1I3VVRZcnJTLzJEQ2t1N3lsWgptdTcwcXZicndYWnF6TkI5b05hQk82SHJsZXpuU2JQbnFKZUo0Q1czc2NMNmJ1N3A3bEppV1VQb0VHT0xic3YvCnFjT0xqdnZSRFF6eC9Xak5DWFZLNFhxbzJjVERGYitXeFJ1U2xGaUlQclk1QjlkQlFJWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=<br>    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBcnZrTzgxSDRlb3NqTmQzeksvVFBIR3BrQkdRb2ZtYW5vZXY0ZVlzZlE5T2VtMGMwCm9VQndxejEzYlpuYlRuYnB4UWpuZ1kyRzhscXhSaTBpQnZQNmZrZktGRUJWc1E3eHRpamVwa3ZwclhHTy9PMFEKQTVTSTg0cnNONUc5WE5ralBtZ3NhMGVuVnE1RW9FMEZUWjV6UUY5cFJZMVlGWWV2K0wxNW1ORWl5UnFIOFAyUQpjcGhSbFYrT0hRdUdpV0s0SEhFUHZBbDZBSkl5Y3p3c1ljK3ZNSHR5WW5heTVDMFJXVVh4clJnNGcrSjJLK2NYCnViUXR6WFd2N3FpM2E2MUN6SlpmL1NmQ053QnJqb3NHdG9teVhCVjVWU1RiVGFZNThWay8xTytTUnNwcm4xd0wKNzR2N1dRdURoT3J1eEFFem5iZFdZbE4wRkEybkxOOVlsMVpFSlFJREFRQUJBb0lCQUI4OHI0S1krN2RFNThCUwpJM3VSZFBncHRqbGllQ2c0dzJ5UTZBY3E0eVlFdmFnVENqNVBkczNiWjFyVndPVTlMWGJUcENEbzExS2xCa2owCi9jSW9CR3hPL0xDbzI2T0VlM3A5eVdIKzQzVG5kUk9LYnZWMHF3NXZtc1JBN0lHSzhsUE4zVUE1eHBJZkFubHIKeHFxWXd4S1c5Z0JJdjVUNGFGNEwxWTJHcUtNbUlhenVjLzVleU5rZjk3bnRyOFJncXQxcDJyaWJIVS9nRzFlYgpIWktyNm01UWx2MWJpYTFIYms2SWI2b1pYTVFIWWJSckpVemJSaWp6eE1RVkRmZ2tpalhSR3pSRjdZeVFZbTk5CmwwUzI1bDYzY1dIT3J6czM5R21xRmQ4Z0JJc0M3SkxuUThUY01nb1Axb0M5WXUzMGRrSDBvUi95M2lOTnFxRW8KZVJ2d0w0RUNnWUVBeG1tY2JDZXRlRDI5VWZDTE1kKzByTU14aVV4bHI3TTdrYUJOeWxPK2lOZWxKbUk5UHRXcwpkUzQzS2hkeElnSVNIQVRTdWxpR3VKMStEekxTWWNGZ2FkSmQxd25NNHppOUc2cW9NOXZTTVN2ZGtvK28ydXRqCmNscVBZcnVRbC9nK252dkE2N1ZyZzAyUXF0NFlqcmkrYmxQL1RNaDZGS3NGa0VQeXZPTHUxOTBDZ1lFQTRjSFgKUm43WUl2TWtMNGQrR3dkUmRwcXl5YStxVC9nbUtKTnNwb3VLUVZlaUd3aW9vR21BR0E0MEJBR2hyN24vMXB6Rwo5VkVQb201VDdPRnVmVWxGaUNURmJBblN2RWU5RTREUHJ3SDNhazlXR0JzcWxYcUZwMjdwWWFyZ3NSS2JDWU9UCm9Nc1FJR0wxelN4NEpkdFArMUxDQ1BuRnowMTNkajhRbmc4TVBPa0NnWUFwczF5cTVwUHc1NWo0dGNPcmtjYloKWUpUeXRGblMyYXExYXFtdTBuY0RMNytJRjdHam1Ta0wzOUM4U2Z6L0ZzeFRremZ1N2xneVNQZUxualRWVXQwKwpvSFlVa2Z5NzdOcmlDN1lhWUNNSExwNzlCTENLZ2xwK1dFWTJqQkZSdjF6NThST1U5cVpJREc5UldpaHpKcVR2CmJ6d0RHVWQvUElxSXpaOGd6OWsvQ1FLQmdIbEFRaDVEdkZReElNdENTM0c2NFg4QklXdC9wTXFrcmVIM0pGRGkKKzFPUy9LYm1aS01iWnNnRXdOMHgveVJCa3U0eWNBMk1Cd2lubHYzUUtpYXlOdDBqV3NGbkdUODBqSkd3Q2x1bApnN3dlZGxBbUx4M3ZtMTlOQzU0QVNBUHl5VUEzNGc5bllQYjBENjZ0NXEzMmQ2TzFWQys3N3dralF6bElMK1drCmtWOFpBb0dBVk01R1lLbnpNVjUzVzNXT3I0dFdLSm5XUHFiaHVlUEt5SXMzbTNkUzhGUE56SDU2UHhNKzRUM24Ka2NzT1VsZTlkQkFENXRXT3E5eHFmNWF4MXpaU2s1SzFhdUphSzRaa3RzNkdMRUgrU09WckdoK1JXQWtRcUFVbgo0Qmk4ZVA4MmR5M3N2RmV1UkNvTWFXRVQ0QlFHaGRQaFFCd1NNdlYrSWI2R3U0VldwN289Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==<br><br></code></pre></td></tr></table></figure><p><code>其中属性certificate-authority-data、client-certificate-data、client-key-data对应CA证书、client证书、、client私钥，文件里面的内容是base64编码过后的，分别执行echo &quot;&lt;base64 code&gt;&quot; | base64 -d 就能还原成证书源文件。</code></p><h1 id="yaml文件创建"><a href="#yaml文件创建" class="headerlink" title="yaml文件创建"></a>yaml文件创建</h1><p><code>先创建monitoring的名称空间：kubectl create namespace monitoring </code></p><h2 id="alertmanager的yaml文件"><a href="#alertmanager的yaml文件" class="headerlink" title="alertmanager的yaml文件"></a>alertmanager的yaml文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  annotations: &#123;&#125;<br>  labels: &#123;&#125;<br>  name: alertmanager<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;28485&#x27;</span><br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 1<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: alertmanager<br>  strategy:<br>    rollingUpdate:<br>      maxSurge: 25%<br>      maxUnavailable: 25%<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: alertmanager<br>    spec:<br>      containers:<br>        - args:<br>            - <span class="hljs-string">&#x27;--config.file=/etc/alertmanager/config.yml&#x27;</span><br>            - <span class="hljs-string">&#x27;--storage.path=/alertmanager&#x27;</span><br>            - <span class="hljs-string">&#x27;--cluster.advertise-address=$(POD_IP):6783&#x27;</span><br>          <span class="hljs-built_in">env</span>:<br>            - name: POD_IP<br>              valueFrom:<br>                fieldRef:<br>                  apiVersion: v1<br>                  fieldPath: status.podIP<br>          image: <span class="hljs-string">&#x27;prom/alertmanager:latest&#x27;</span><br>          imagePullPolicy: IfNotPresent<br>          name: alertmanager<br>          ports:<br>            - containerPort: 9093<br>              protocol: TCP<br>          resources: &#123;&#125;<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>          volumeMounts:<br>            - mountPath: /etc/alertmanager<br>              name: config<br>            - mountPath: /etc/templates<br>              name: templates<br>            - mountPath: /alertmanager<br>              name: alertmanager<br>      dnsPolicy: ClusterFirst<br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      terminationGracePeriodSeconds: 30<br>      volumes:<br>        - configMap:<br>            defaultMode: 420<br>            name: alertmanager-config<br>          name: config<br>        - configMap:<br>            defaultMode: 420<br>            name: alertmanager-templates<br>          name: templates<br>        - emptyDir: &#123;&#125;<br>          name: alertmanager<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>  labels:<br>    name: alertmanager<br>  name: alertmanager<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;28635&#x27;</span><br>spec:<br>  clusterIP: 10.233.20.249<br>  clusterIPs:<br>    - 10.233.20.249<br>  externalTrafficPolicy: Cluster<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: alertmanager<br>      nodePort: 30093<br>      port: 9093<br>      protocol: TCP<br>      targetPort: 9093<br>  selector:<br>    app: alertmanager<br>  sessionAffinity: None<br>  <span class="hljs-built_in">type</span>: NodePort<br><br><br></code></pre></td></tr></table></figure><h2 id="blackbox-exporter-1"><a href="#blackbox-exporter-1" class="headerlink" title="blackbox-exporter"></a>blackbox-exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  annotations: &#123;&#125;<br>  labels: &#123;&#125;<br>  name: blackbox-exporter<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;37640&#x27;</span><br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 1<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: blackbox-exporter<br>  strategy:<br>    rollingUpdate:<br>      maxSurge: 25%<br>      maxUnavailable: 25%<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: blackbox-exporter<br>    spec:<br>      containers:<br>        - args:<br>            - <span class="hljs-string">&#x27;--config.file=/etc/blackbox_exporter/blackbox.yml&#x27;</span><br>            - <span class="hljs-string">&#x27;--web.listen-address=:9115&#x27;</span><br>          image: <span class="hljs-string">&#x27;prom/blackbox-exporter:latest&#x27;</span><br>          imagePullPolicy: IfNotPresent<br>          name: blackbox-exporter<br>          ports:<br>            - containerPort: 9115<br>              protocol: TCP<br>          readinessProbe:<br>            failureThreshold: 3<br>            initialDelaySeconds: 10<br>            periodSeconds: 10<br>            successThreshold: 1<br>            tcpSocket:<br>              port: 9115<br>            timeoutSeconds: 5<br>          resources:<br>            limits:<br>              cpu: 200m<br>              memory: 60Mi<br>            requests:<br>              cpu: 100m<br>              memory: 50Mi<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>          volumeMounts:<br>            - mountPath: /etc/blackbox_exporter<br>              name: config<br>      dnsPolicy: ClusterFirst<br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      terminationGracePeriodSeconds: 30<br>      tolerations:<br>        - effect: NoSchedule<br>          key: node-role.kubernetes.io/master<br>          operator: Exists<br>      volumes:<br>        - configMap:<br>            defaultMode: 420<br>            name: blackbox-exporter<br>          name: config<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>  labels:<br>    app: blackbox-exporter<br>  name: blackbox-exporter<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;27344&#x27;</span><br>spec:<br>  clusterIP: 10.233.60.92<br>  clusterIPs:<br>    - 10.233.60.92<br>  externalTrafficPolicy: Cluster<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: blackbox<br>      nodePort: 30115<br>      port: 9115<br>      protocol: TCP<br>      targetPort: 9115<br>  selector:<br>    app: blackbox-exporter<br>  sessionAffinity: None<br>  <span class="hljs-built_in">type</span>: NodePort<br><br><br></code></pre></td></tr></table></figure><h2 id="dingtalk-1"><a href="#dingtalk-1" class="headerlink" title="dingtalk"></a>dingtalk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  annotations: &#123;&#125;<br>  labels:<br>    app: grafana<br>  name: grafana<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;39074&#x27;</span><br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 1<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: grafana<br>  strategy:<br>    rollingUpdate:<br>      maxSurge: 25%<br>      maxUnavailable: 25%<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: grafana<br>    spec:<br>      containers:<br>        - <span class="hljs-built_in">env</span>:<br>            - name: GF_AUTH_BASIC_ENABLED<br>              value: <span class="hljs-string">&#x27;true&#x27;</span><br>            - name: GF_AUTH_ANONYMOUS_ENABLED<br>              value: <span class="hljs-string">&#x27;false&#x27;</span><br>            - name: GF_AUTH_ANONYMOUS_ORG_ROLE<br>              value: Admin<br>            - name: GF_DASHBOARDS_JSON_ENABLED<br>              value: <span class="hljs-string">&#x27;true&#x27;</span><br>            - name: GF_INSTALL_PLUGINS<br>              value: grafana-kubernetes-app<br>            - name: GF_SECURITY_ADMIN_USER<br>              valueFrom:<br>                secretKeyRef:<br>                  key: admin-username<br>                  name: grafana<br>            - name: GF_SECURITY_ADMIN_PASSWORD<br>              valueFrom:<br>                secretKeyRef:<br>                  key: admin-password<br>                  name: grafana<br>          image: <span class="hljs-string">&#x27;grafana/grafana:latest&#x27;</span><br>          imagePullPolicy: IfNotPresent<br>          name: grafana<br>          ports:<br>            - containerPort: 3000<br>              name: grafana<br>              protocol: TCP<br>          readinessProbe:<br>            failureThreshold: 3<br>            httpGet:<br>              path: /login<br>              port: 3000<br>              scheme: HTTP<br>            initialDelaySeconds: 30<br>            periodSeconds: 10<br>            successThreshold: 1<br>            timeoutSeconds: 5<br>          resources:<br>            limits:<br>              cpu: 100m<br>              memory: 100Mi<br>            requests:<br>              cpu: 100m<br>              memory: 100Mi<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>          volumeMounts:<br>            - mountPath: /var/lib/grafana<br>              name: grafana-storage<br>      dnsPolicy: ClusterFirst<br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      terminationGracePeriodSeconds: 30<br>      volumes:<br>        - emptyDir: &#123;&#125;<br>          name: grafana-storage<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations: &#123;&#125;<br>  labels:<br>    app: grafana<br>  name: grafana<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;33834&#x27;</span><br>spec:<br>  clusterIP: 10.233.48.176<br>  clusterIPs:<br>    - 10.233.48.176<br>  externalTrafficPolicy: Cluster<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: grafana<br>      nodePort: 32000<br>      port: 3000<br>      protocol: TCP<br>      targetPort: 3000<br>  selector:<br>    app: grafana<br>  sessionAffinity: None<br>  <span class="hljs-built_in">type</span>: NodePort<br><br>---<br>apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  annotations: &#123;&#125;<br>  name: grafana<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;33841&#x27;</span><br>spec:<br>  rules:<br>    - host: grafana.lzxlinux.cn<br>      http:<br>        paths:<br>          - backend:<br>              service:<br>                name: grafana<br>                port:<br>                  number: 3000<br>            path: /<br>            pathType: Prefix<br><br><br></code></pre></td></tr></table></figure><h2 id="kube-state-metrics-1"><a href="#kube-state-metrics-1" class="headerlink" title="kube-state-metrics"></a>kube-state-metrics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  annotations: &#123;&#125;<br>  labels:<br>    app: kube-state-metrics<br>  name: kube-state-metrics<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;38566&#x27;</span><br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 1<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: kube-state-metrics<br>  strategy:<br>    rollingUpdate:<br>      maxSurge: 25%<br>      maxUnavailable: 25%<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: kube-state-metrics<br>    spec:<br>      containers:<br>        - image: <span class="hljs-string">&#x27;quay.io/coreos/kube-state-metrics:v1.8.0&#x27;</span><br>          imagePullPolicy: IfNotPresent<br>          name: kube-state-metrics<br>          ports:<br>            - containerPort: 8080<br>              protocol: TCP<br>          resources: &#123;&#125;<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>      dnsPolicy: ClusterFirst<br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      serviceAccount: kube-state-metrics<br>      serviceAccountName: kube-state-metrics<br>      terminationGracePeriodSeconds: 30<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    prometheus.io/http-probe: <span class="hljs-string">&#x27;true&#x27;</span><br>    prometheus.io/http-probe-path: /healthz<br>    prometheus.io/http-probe-port: <span class="hljs-string">&#x27;8080&#x27;</span><br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>  labels:<br>    app: kube-state-metrics<br>  name: kube-state-metrics<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;38207&#x27;</span><br>spec:<br>  clusterIP: 10.233.21.4<br>  clusterIPs:<br>    - 10.233.21.4<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: kube-state-metrics<br>      port: 8080<br>      protocol: TCP<br>      targetPort: 8080<br>  selector:<br>    app: kube-state-metrics<br>  sessionAffinity: None<br>  <span class="hljs-built_in">type</span>: ClusterIP<br><br><br></code></pre></td></tr></table></figure><h2 id="node-exporter-1"><a href="#node-exporter-1" class="headerlink" title="node-exporter"></a>node-exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>apiVersion: apps/v1<br>kind: DaemonSet<br>metadata:<br>  annotations:<br>    deprecated.daemonset.template.generation: <span class="hljs-string">&#x27;1&#x27;</span><br>  labels:<br>    app: node-exporter<br>  name: node-exporter<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;27437&#x27;</span><br>spec:<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: node-exporter<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: node-exporter<br>      name: node-exporter<br>    spec:<br>      containers:<br>        - image: <span class="hljs-string">&#x27;prom/node-exporter:latest&#x27;</span><br>          imagePullPolicy: IfNotPresent<br>          name: node-exporter<br>          ports:<br>            - containerPort: 9100<br>              hostPort: 9100<br>              protocol: TCP<br>          resources: &#123;&#125;<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>      dnsPolicy: ClusterFirst<br>      hostNetwork: <span class="hljs-literal">true</span><br>      hostPID: <span class="hljs-literal">true</span><br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      terminationGracePeriodSeconds: 30<br>      tolerations:<br>        - effect: NoSchedule<br>          key: node-role.kubernetes.io/master<br>          operator: Exists<br>  updateStrategy:<br>    rollingUpdate:<br>      maxSurge: 0<br>      maxUnavailable: 1<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    prometheus.io/scrape: <span class="hljs-string">&#x27;true&#x27;</span><br>  labels:<br>    app: node-exporter<br>  name: node-exporter<br>  namespace: monitoring<br>  resourceVersion: <span class="hljs-string">&#x27;27267&#x27;</span><br>spec:<br>  clusterIP: None<br>  clusterIPs:<br>    - None<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: node-exporter<br>      port: 9100<br>      protocol: TCP<br>      targetPort: 9100<br>  selector:<br>    app: node-exporter<br>  sessionAffinity: None<br>  <span class="hljs-built_in">type</span>: ClusterIP<br><br><br></code></pre></td></tr></table></figure><h2 id="promethues"><a href="#promethues" class="headerlink" title="promethues"></a>promethues</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs sbash">---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  annotations: &#123;&#125;<br>  labels:<br>    app: prometheus<br>    k8s.kuboard.cn/name: prometheus<br>  name: prometheus<br>  namespace: monitoring<br>  resourceVersion: &#x27;33415&#x27;<br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 1<br>  revisionHistoryLimit: 10<br>  selector:<br>    matchLabels:<br>      app: prometheus<br>  strategy:<br>    rollingUpdate:<br>      maxSurge: 25%<br>      maxUnavailable: 25%<br>    type: RollingUpdate<br>  template:<br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: prometheus<br>    spec:<br>      containers:<br>        - args:<br>            - &#x27;--storage.tsdb.path=/prometheus&#x27;<br>            - &#x27;--storage.tsdb.retention.time=30d&#x27;<br>            - &#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;<br>          image: &#x27;prom/prometheus:latest&#x27;<br>          imagePullPolicy: IfNotPresent<br>          name: prometheus<br>          ports:<br>            - containerPort: 9090<br>              protocol: TCP<br>          resources:<br>            limits:<br>              cpu: 500m<br>              memory: 500M<br>            requests:<br>              cpu: 500m<br>              memory: 500M<br>          terminationMessagePath: /dev/termination-log<br>          terminationMessagePolicy: File<br>          volumeMounts:<br>            - mountPath: /etc/prometheus<br>              name: config<br>            - mountPath: /etc/prometheus-rules<br>              name: rules<br>            - mountPath: /prometheus<br>              name: prometheus<br>      dnsPolicy: ClusterFirst<br>      restartPolicy: Always<br>      schedulerName: default-scheduler<br>      securityContext: &#123;&#125;<br>      serviceAccount: prometheus<br>      serviceAccountName: prometheus<br>      terminationGracePeriodSeconds: 30<br>      tolerations:<br>        - effect: NoSchedule<br>          key: node-role.kubernetes.io/control-plane<br>          operator: Exists<br>      volumes:<br>        - configMap:<br>            defaultMode: 420<br>            name: prometheus-config<br>          name: config<br>        - configMap:<br>            defaultMode: 420<br>            name: prometheus-rules<br>          name: rules<br>        - emptyDir: &#123;&#125;<br>          name: prometheus<br><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    prometheus.io/scrape: &#x27;true&#x27;<br>  labels:<br>    app: prometheus<br>  name: prometheus<br>  namespace: monitoring<br>  resourceVersion: &#x27;33519&#x27;<br>spec:<br>  clusterIP: 10.233.51.128<br>  clusterIPs:<br>    - 10.233.51.128<br>  externalTrafficPolicy: Cluster<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>    - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>    - name: prometheus<br>      nodePort: 30090<br>      port: 9090<br>      protocol: TCP<br>      targetPort: 9090<br>  selector:<br>    app: prometheus<br>  sessionAffinity: None<br>  type: NodePort<br><br>---<br>apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  annotations: &#123;&#125;<br>  name: prometheus<br>  namespace: monitoring<br>  resourceVersion: &#x27;33391&#x27;<br>spec:<br>  rules:<br>    - host: prometheus.lzxlinux.cn<br>      http:<br>        paths:<br>          - backend:<br>              service:<br>                name: prometheus<br>                port:<br>                  number: 9090<br>            path: /<br>            pathType: Prefix<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>hexo</title>
    <link href="/2025/01/17/hexo/"/>
    <url>/2025/01/17/hexo/</url>
    
    <content type="html"><![CDATA[<p>博客搭建教程视频地址：<a href="https://www.bilibili.com/video/BV1nY6xYmEw7?buvid=YD44F3D7CA9FF4654EA985A08644F4A38FB0&from_spmid=tm.recommend.0.0&is_story_h5=false&mid=QY8SLP3aFxWc3ZZhivkAwX8FTQ/SZMtL1rElX6M3iMo=&plat_id=116&share_from=ugc&share_medium=iphone&share_plat=ios&share_session_id=977D55C6-F8AF-4D06-88FF-5BF8DBEDBED8&share_source=COPY&share_tag=s_i&spmid=united.player-video-detail.0.0&timestamp=1735960479&unique_k=MFZ2A8W&up_id=258944527&vd_source=2faa5edeffeb71a8abb2307ca70fa880">https://www.bilibili.com/video/BV1nY6xYmEw7?buvid=YD44F3D7CA9FF4654EA985A08644F4A38FB0&amp;from_spmid=tm.recommend.0.0&amp;is_story_h5=false&amp;mid=QY8SLP3aFxWc3ZZhivkAwX8FTQ%2FSZMtL1rElX6M3iMo%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=iphone&amp;share_plat=ios&amp;share_session_id=977D55C6-F8AF-4D06-88FF-5BF8DBEDBED8&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1735960479&amp;unique_k=MFZ2A8W&amp;up_id=258944527&amp;vd_source=2faa5edeffeb71a8abb2307ca70fa880</a><br>1、环境准备</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">nodejs-18以上，git<br><span class="hljs-comment"># 验证</span><br>node -v<br>npm -v<br></code></pre></td></tr></table></figure><p>2、安装hexo客户端</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tcl">hexo是一个静态的博客框架，托管与gitee<br><span class="hljs-comment"># 更换为国内的npm源</span><br>npm config <span class="hljs-keyword">set</span> <span class="hljs-keyword">registry</span> https://<span class="hljs-keyword">registry</span>.npmmirror.com<br></code></pre></td></tr></table></figure><h1 id="安装hexo客户端"><a href="#安装hexo客户端" class="headerlink" title="安装hexo客户端"></a>安装hexo客户端</h1><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g hexo-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure><h1 id="使用hexo初始化一个文件夹，名字可以自定义，用于存放博客文章的文件夹"><a href="#使用hexo初始化一个文件夹，名字可以自定义，用于存放博客文章的文件夹" class="headerlink" title="使用hexo初始化一个文件夹，名字可以自定义，用于存放博客文章的文件夹"></a>使用hexo初始化一个文件夹，名字可以自定义，用于存放博客文章的文件夹</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">hexo init <span class="hljs-keyword">my</span>-blog<br></code></pre></td></tr></table></figure><h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cd my-<span class="hljs-keyword">blog</span><br><span class="hljs-keyword"></span>npm <span class="hljs-keyword">install </span><br></code></pre></td></tr></table></figure><h1 id="前期准备完成，install完后会生成以下文件"><a href="#前期准备完成，install完后会生成以下文件" class="headerlink" title="前期准备完成，install完后会生成以下文件"></a>前期准备完成，install完后会生成以下文件</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[root@localhost my-<span class="hljs-keyword">blog]# </span>ls<br>_<span class="hljs-built_in">config</span>.fluid.yml      _<span class="hljs-built_in">config</span>.yml  node_modules  package-lock.<span class="hljs-keyword">json </span> README.en.md  <span class="hljs-keyword">scaffolds </span> themes<br>_<span class="hljs-built_in">config</span>.landscape.yml  db.<span class="hljs-keyword">json </span>     package.<span class="hljs-keyword">json </span> public             README.md     source<br></code></pre></td></tr></table></figure><p>3、配置文件简介</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">_config.yaml：主文件夹，有博客名，作者等信息<br><span class="hljs-built_in">source</span>/_posts：用于存放我们文章的目录<br>themes：目录下存放的的博客的主题配置文件<br></code></pre></td></tr></table></figure><p>4、启动hexo</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog"># 启动预览博客页面<br>hexo <span class="hljs-keyword">generate</span> &amp;&amp; hexo server<br></code></pre></td></tr></table></figure><h1 id="会生成个登入地址，用于在页面访问"><a href="#会生成个登入地址，用于在页面访问" class="headerlink" title="会生成个登入地址，用于在页面访问"></a>会生成个登入地址，用于在页面访问</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//localhost:4000/ </span><br></code></pre></td></tr></table></figure><p>5、创建gitee&#x2F;githup仓库</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-comment"># gitee创建blog仓库</span><br><br><span class="hljs-comment"># 初始化</span><br><span class="hljs-string">git</span> <span class="hljs-string">init</span><br><span class="hljs-comment"># 设置远程仓库</span><br><span class="hljs-string">git</span> <span class="hljs-string">remote</span> <span class="hljs-string">add</span> <span class="hljs-string">origin</span> <span class="hljs-string">git</span>@<span class="hljs-string">github</span>.<span class="hljs-string">com:xubaodong0511/</span><span class="hljs-string">xubaodong0511</span>.<span class="hljs-string">github</span>.<span class="hljs-string">io</span>.<span class="hljs-string">git</span><br><span class="hljs-comment"># 更换远程仓库的命令</span><br><span class="hljs-string">git</span> <span class="hljs-string">remote</span> <span class="hljs-built_in">set-url</span> <span class="hljs-string">origin</span> <span class="hljs-string">git</span>@<span class="hljs-string">github</span>.<span class="hljs-string">com:xubaodong0511/</span><span class="hljs-string">blog</span>.<span class="hljs-string">io</span>.<span class="hljs-string">git</span><br><span class="hljs-comment"># 验证在哪个远程仓库</span><br><span class="hljs-string">git</span> <span class="hljs-string">remote</span> -<span class="hljs-string">v</span><br><br><span class="hljs-comment"># github上配置ssh密钥的时候需要在服务器上创建config文件，将以下内容添加到config文件中并保存</span><br><span class="hljs-string">Host</span> <span class="hljs-string">github</span>.<span class="hljs-string">com</span><br>  <span class="hljs-string">Hostname</span> <span class="hljs-string">ssh</span>.<span class="hljs-string">github</span>.<span class="hljs-string">com</span><br>  <span class="hljs-string">Port</span> <span class="hljs-string">443</span><br><span class="hljs-comment"># 拉取、推送文件</span><br><span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">git</span>@<span class="hljs-string">github</span>.<span class="hljs-string">com:xubaodong0511/</span><span class="hljs-string">blog</span>.<span class="hljs-string">io</span>.<span class="hljs-string">git</span><br><span class="hljs-string">git</span> <span class="hljs-string">push</span> -<span class="hljs-string">u</span> <span class="hljs-string">origin</span> <span class="hljs-string">main</span> <span class="hljs-built_in">--force</span><br></code></pre></td></tr></table></figure><p>6、修改配置文件</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># 修改_config.yml文件，在末尾添加</span><br><span class="hljs-symbol">deploy:</span><br>  <span class="hljs-symbol">type:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-comment"># 添加以下两行，git<span class="hljs-doctag">@gitee</span>.com:gitee用户名/仓库名.git，branch指定分支</span><br>  <span class="hljs-symbol">repository:</span> git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>xubaodong0511/xubaodong0511.github.io.git<br>  <span class="hljs-symbol">branch:</span> main<br>                   <br>注释：使用cursor运行hexo时会有管理员权限问题<br>解决：退出重新以管理员身份运行，并执行<span class="hljs-string">`Set-ExecutionPolicy RemoteSigned`</span>，如果有选择输入Y<br></code></pre></td></tr></table></figure><p>7、创建、及发布文章</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-comment"># 创建名为第一篇博客名的文章</span><br>[root<span class="hljs-variable">@localhost</span> my-blog]<span class="hljs-comment"># hexo new post 我的第一篇博客</span><br>INFO  Validating config<br>INFO  <span class="hljs-symbol">Created:</span> ~<span class="hljs-regexp">/my-blog/source</span><span class="hljs-regexp">/_posts/</span>我的第一篇博客.md<br></code></pre></td></tr></table></figure><h1 id="安装hexo-git插件"><a href="#安装hexo-git插件" class="headerlink" title="安装hexo-git插件"></a>安装hexo-git插件</h1><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install hexo-deployer-git <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><h1 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h1><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo clean &amp;&amp; hexo <span class="hljs-keyword">generate</span> &amp;&amp; hexo deploy<br>或<br>hexo c &amp;&amp; hexo g &amp;&amp; hexo d<br></code></pre></td></tr></table></figure><p>8、cloudflare托管网站，域名代理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">点击worker和pages</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">选择pages</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">点击连接到git</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">选择githup或gitee</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">选第二个，only <span class="hljs-keyword">select</span> repositories(选择仓库)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">授权</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">确认仓库，开始设置</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">确认分支，保存设置开始部署</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">继续处理项目</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">自定义域</span><br></code></pre></td></tr></table></figure><p>9、设置主题</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">githup上搜索hexo-theme-fluid<br>或直接打开以下地址<br><span class="hljs-symbol">https:</span>//github.com/fluid-dev/hexo-theme-fluid?tab=readme-ov-file<br><br>方式一：<br><span class="hljs-meta"># Hexo 5.0.0 版本以上，推荐通过 npm 直接安装，进入博客目录执行命令：</span><br>npm install --save hexo-theme-fluid<br>然后在博客目录下创建 _config.fluid.yml，将主题的 _config.yml 内容复制进去。<br>方式二：<br><span class="hljs-meta"># 修改 Hexo 博客目录中的 _config.yml：</span><br><span class="hljs-symbol">theme:</span> fluid  <span class="hljs-meta"># 指定主题</span><br><span class="hljs-symbol">language:</span> <span class="hljs-built_in">zh</span>-CN  <span class="hljs-meta"># 指定语言，会影响主题显示的语言，按需修改</span><br></code></pre></td></tr></table></figure><h1 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 创建「关于页」，首次使用主题的「关于页」需要手动创建：</span><br><span class="hljs-string">hexo</span> <span class="hljs-string">new</span> <span class="hljs-string">page</span> <span class="hljs-string">about</span><br><span class="hljs-string">创建成功后，编辑博客目录下</span> <span class="hljs-string">/source/about/index.md，添加</span> <span class="hljs-string">layout</span> <span class="hljs-string">属性。</span><br><span class="hljs-string">修改后的文件示例如下：</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">about</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">about</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h1 id="重新启动hexo"><a href="#重新启动hexo" class="headerlink" title="重新启动hexo"></a>重新启动hexo</h1><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo clean &amp;&amp; hexo <span class="hljs-keyword">generate</span> &amp;&amp; hexo deploy<br></code></pre></td></tr></table></figure><p>10、设置文章的标签</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 在文字的开头添加以下内容</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">gicc升级</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2025-01-05</span><br><span class="hljs-attr">tags:</span> [<span class="hljs-string">Linux运维，系统</span>]<br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>11、增加评论功能</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment"># 插件地址</span><br>https:<span class="hljs-symbol">//github.com/apps/utterances</span><br><br><span class="hljs-comment"># 点击install安装</span><br><br><span class="hljs-comment"># 选第二个，only select repositories(选择仓库)</span><br><br><span class="hljs-comment"># 在githup的blog仓库点settings设置</span><br><span class="hljs-comment"># 在下面找到Features下的Discussion的选项，选择打勾</span><br><span class="hljs-comment"># 修改_config.fluid.yml 文件，在最下发添加以下内容</span><br><span class="hljs-comment"># discuss</span><br><span class="hljs-params">post:</span><br>  <span class="hljs-params">comments:</span><br>    <span class="hljs-params">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-params">type:</span> utterances<br><br><span class="hljs-params">utterances:</span><br>  <span class="hljs-params">repo:</span> xubaodong0511<span class="hljs-symbol">/xubaodong0511.github.io</span><br>  <span class="hljs-params">issue_term:</span> pathname<br>  <span class="hljs-params">label:</span> utterances<br>  <span class="hljs-params">theme:</span> github-light<br>  <span class="hljs-params">theme_dark:</span> github-dark<br>  <span class="hljs-params">crossorigin:</span> anonymous<br></code></pre></td></tr></table></figure><p>12、重启hexo</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs verilog"># 启动hexo<br>hexo clean &amp;&amp; hexo <span class="hljs-keyword">generate</span> &amp;&amp; hexo server<br>或<br>nohup hexo clean &amp;&amp; hexo <span class="hljs-keyword">generate</span> &amp;&amp; hexo server &amp;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>域名配置</title>
    <link href="/2025/01/09/%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/01/09/%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="一、使用子域名（方案一）"><a href="#一、使用子域名（方案一）" class="headerlink" title="一、使用子域名（方案一）"></a>一、使用子域名（方案一）</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen 80;<br>    server_name service1.example.com;<br><br>    location / &#123;<br>        proxy_pass http://localhost:3000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br><br>server &#123;<br>    listen 80;<br>    server_name service2.example.com;<br><br>    location / &#123;<br>        proxy_pass http://localhost:4000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="二、使用同一个域名-方案二"><a href="#二、使用同一个域名-方案二" class="headerlink" title="二、使用同一个域名(方案二)"></a>二、使用同一个域名(方案二)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen 80;<br>    server_name example.com;<br><br>    location /service1 &#123;<br>        proxy_pass http://localhost:3000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br><br>    location /service2 &#123;<br>        proxy_pass http://localhost:4000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="配置ssl证书"><a href="#配置ssl证书" class="headerlink" title="配置ssl证书"></a>配置ssl证书</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1、安装Certbot，Certbot是一个自动化工具，可以帮助你获取和安装SSL证书</span><br><span class="hljs-comment"># 对于Ubuntu/Debian</span><br><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install certbot python3-certbot-nginx<br><br><span class="hljs-comment"># 对于CentOS/RHEL</span><br><span class="hljs-built_in">sudo</span> yum install epel-release<br><span class="hljs-built_in">sudo</span> yum install certbot python3-certbot-nginx<br><br><span class="hljs-comment"># 2. 获取SSL证书，使用Certbot为每个子域名获取SSL证书：</span><br><span class="hljs-built_in">sudo</span> certbot --nginx -d service1.example.com -d service2.example.com<br></code></pre></td></tr></table></figure><h1 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen 80;<br>    server_name service1.example.com;<br>    <span class="hljs-built_in">return</span> 301 https://$host<span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br>server &#123;<br>    listen 443 ssl;<br>    server_name service1.example.com;<br><br>    ssl_certificate /etc/letsencrypt/live/service1.example.com/fullchain.pem;<br>    ssl_certificate_key /etc/letsencrypt/live/service1.example.com/privkey.pem;<br><br>    location / &#123;<br>        proxy_pass http://localhost:3000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br><br>server &#123;<br>    listen 80;<br>    server_name service2.example.com;<br>    <span class="hljs-built_in">return</span> 301 https://$host<span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br>server &#123;<br>    listen 443 ssl;<br>    server_name service2.example.com;<br><br>    ssl_certificate /etc/letsencrypt/live/service2.example.com/fullchain.pem;<br>    ssl_certificate_key /etc/letsencrypt/live/service2.example.com/privkey.pem;<br><br>    location / &#123;<br>        proxy_pass http://localhost:4000;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="自动续费"><a href="#自动续费" class="headerlink" title="自动续费"></a>自动续费</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Let<span class="hljs-string">&#x27;s Encrypt的证书有效期为90天。Certbot会自动设置一个cron任务来续期证书。你可以手动测试续期</span><br><span class="hljs-string">sudo certbot renew --dry-run</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>nginx</tag>
      
      <tag>ssl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>安装MySQL</title>
    <link href="/2025/01/09/%E5%AE%89%E8%A3%85MySQL/"/>
    <url>/2025/01/09/%E5%AE%89%E8%A3%85MySQL/</url>
    
    <content type="html"><![CDATA[<h1 id="1、yum安装MySQL"><a href="#1、yum安装MySQL" class="headerlink" title="1、yum安装MySQL"></a>1、yum安装MySQL</h1><p>#关闭防火墙</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">systemctl</span> stop firewalld<br><span class="hljs-attribute">setenforce</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h1 id="清理环境"><a href="#清理环境" class="headerlink" title="清理环境"></a>清理环境</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum erase mariadb mariadb-server mariadb-libs mariadb-devel -y<br>userdel -r mysql<br>rm -rf /etc/my*//配置文件<br>rm -rf /var/lib/mysql//初始化生成密码的路径目录<br></code></pre></td></tr></table></figure><h1 id="编辑yum文件"><a href="#编辑yum文件" class="headerlink" title="编辑yum文件"></a>编辑yum文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost yum.repos.d]# vim mysql.repo<br>[mysql]<br>name=mysql<br>baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-5.7-community-el7-x86_64/<br>gpgcheck=1<br>enabled=1<br>gpgkey=https://mirrors.ustc.edu.cn/mysql-repo/RPM-GPG-KEY-mysql<br></code></pre></td></tr></table></figure><h1 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">yum repolist enabled | grep mysql</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">yum -y install mysql-community-server</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start mysqld                        //第一次启动会自动始化数据库</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span>   mysqld</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">grep password /var/log/mysqld.log</span><br></code></pre></td></tr></table></figure><h1 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a><strong>修改密码</strong></h1><p>5.7默认有临时密码，需要修改，两种方式：<br>第一种</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">mysql -uroot -p<span class="hljs-string">&#x27;uopCBgXBu8,k&#x27;</span></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">alter user <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;Qianfeng123!@&#x27;</span>;</span><br></code></pre></td></tr></table></figure><p>第二种</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># mysqladmin -u root -p&#x27;uopCBgXBu8,k&#x27; password &#x27;Qianfeng123!@&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>关闭弱密码限制</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpm安装的5.7如下方式修改<br><span class="hljs-comment"># vim /etc/my.cnf</span><br>validate_password=off<br><br>编译安装的5.7如下方式修改<br>[mysqld]<br>basedir=/usr/local/mysql<br>datadir=/usr/local/mysql/data<br><br>[mysqld_safe]<br>validate_password=off<br></code></pre></td></tr></table></figure><h1 id="2、编译安装MySQL"><a href="#2、编译安装MySQL" class="headerlink" title="2、编译安装MySQL"></a>2、编译安装MySQL</h1><p>#关闭防火墙</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">systemctl</span> stop firewalld<br><span class="hljs-attribute">setenforce</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h1 id="清理环境-1"><a href="#清理环境-1" class="headerlink" title="清理环境"></a>清理环境</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum erase mariadb mariadb-server mariadb-libs mariadb-devel -y<br>userdel -r mysql<br><span class="hljs-built_in">rm</span> -rf /etc/my*<br><span class="hljs-built_in">rm</span> -rf /var/lib/mysql<br></code></pre></td></tr></table></figure><h1 id="创建MySQL用户"><a href="#创建MySQL用户" class="headerlink" title="创建MySQL用户"></a>创建MySQL用户</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">useradd -r mysql -M -s <span class="hljs-regexp">/sbin/</span>nologin<br><span class="hljs-comment"># -M指定不安装家目录</span><br></code></pre></td></tr></table></figure><h1 id="安装编译工具，以及依赖软件"><a href="#安装编译工具，以及依赖软件" class="headerlink" title="安装编译工具，以及依赖软件"></a>安装编译工具，以及依赖软件</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">yum -y <span class="hljs-keyword">install </span>ncurses ncurses-devel openssl-devel <span class="hljs-keyword">bison </span>gcc gcc-c++ make cmake<br></code></pre></td></tr></table></figure><h1 id="创建mysql目录"><a href="#创建mysql目录" class="headerlink" title="创建mysql目录"></a>创建mysql目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /usr/local/&#123;data,mysql,<span class="hljs-built_in">log</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="官方下载MySQL的boost包"><a href="#官方下载MySQL的boost包" class="headerlink" title="官方下载MySQL的boost包"></a>官方下载MySQL的boost包</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://mirrors.aliyun.com/mysql/MySQL-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>/mysql-boost-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">36</span>.tar.gz?spm=a2c6h.<span class="hljs-number">25603864</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.b21f63aftvppVw<br></code></pre></td></tr></table></figure><h1 id="更改包名"><a href="#更改包名" class="headerlink" title="更改包名"></a>更改包名</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mv</span> mysql-boost-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">36</span>.tar.gz?spm=a2c6h.<span class="hljs-number">25603864</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.b21f63aftvppVw mysql-boost-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">36</span>.tar.gz<br></code></pre></td></tr></table></figure><h1 id="解压下载的软件包"><a href="#解压下载的软件包" class="headerlink" title="解压下载的软件包"></a>解压下载的软件包</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> zxvf mysql-boost-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">36</span>.tar.gz -C /usr/local/<br></code></pre></td></tr></table></figure><h1 id="切换目录"><a href="#切换目录" class="headerlink" title="切换目录"></a>切换目录</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> /usr/local/mysql-<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">36</span>/<br></code></pre></td></tr></table></figure><h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros">cmake . \<br><span class="hljs-attribute">-DWITH_BOOST</span>=boost/boost_1_59_0/ \<br><span class="hljs-attribute">-DCMAKE_INSTALL_PREFIX</span>=/usr/local/mysql \<br><span class="hljs-attribute">-DSYSCONFDIR</span>=/etc \<br><span class="hljs-attribute">-DMYSQL_DATADIR</span>=/usr/local/mysql/data \<br><span class="hljs-attribute">-DINSTALL_MANDIR</span>=/usr/share/man \<br><span class="hljs-attribute">-DMYSQL_TCP_PORT</span>=3306 \<br><span class="hljs-attribute">-DMYSQL_UNIX_ADDR</span>=/tmp/mysql.sock \<br><span class="hljs-attribute">-DDEFAULT_CHARSET</span>=utf8 \<br><span class="hljs-attribute">-DEXTRA_CHARSETS</span>=all \<br><span class="hljs-attribute">-DDEFAULT_COLLATION</span>=utf8_general_ci \<br><span class="hljs-attribute">-DWITH_READLINE</span>=1 \<br><span class="hljs-attribute">-DWITH_SSL</span>=system \<br><span class="hljs-attribute">-DWITH_EMBEDDED_SERVER</span>=1 \<br><span class="hljs-attribute">-DENABLED_LOCAL_INFILE</span>=1 \<br><span class="hljs-attribute">-DWITH_INNOBASE_STORAGE_ENGINE</span>=1<br></code></pre></td></tr></table></figure><h1 id="编译安装-1"><a href="#编译安装-1" class="headerlink" title="编译安装"></a>编译安装</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">make -<span class="hljs-keyword">j2 </span>&amp;&amp; make -<span class="hljs-keyword">j2 </span><span class="hljs-keyword">install</span><br><span class="hljs-keyword"></span><span class="hljs-comment"># -j2是指定2核</span><br></code></pre></td></tr></table></figure><p>#如果安装出错，想重新安装：不用重新解压，只需要删除安装目录中的缓存文件</p><h1 id="配置文件添加命令路径"><a href="#配置文件添加命令路径" class="headerlink" title="配置文件添加命令路径"></a>配置文件添加命令路径</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">mysql=/user/local/mysql/bin/</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h1 id="重启profile文件"><a href="#重启profile文件" class="headerlink" title="重启profile文件"></a>重启profile文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><p>#找到安装目录，拷贝mysql.service脚本文件到&#x2F;etc&#x2F;init.d&#x2F;目录下，添加开机启动</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span>support-files<span class="hljs-regexp">/mysql.service /</span>etc<span class="hljs-regexp">/init.d/my</span>sqld<br>chmod a+x <span class="hljs-regexp">/etc/i</span>nit.d/mysqld<br><span class="hljs-comment"># chkconfig: 2346 63 80</span><br>chkconfig--add mysqld<br>systemctl daemon-reload<br></code></pre></td></tr></table></figure><h1 id="进入安装目录修改权限"><a href="#进入安装目录修改权限" class="headerlink" title="进入安装目录修改权限"></a>进入安装目录修改权限</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R mysql.mysql .<br></code></pre></td></tr></table></figure><h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">./bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data<br>```<br><span class="hljs-comment"># 初始化,只需要初始化一次，初始化完成之后，一定要记住提示最后的密码用于登陆或者修改密码</span><br><span class="hljs-comment"># 添加配置文件,删除旧配置文件之后，再添加如下内容</span><br>```<br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/my.cnf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">basedir=/usr/local/mysql       #指定安装目录</span><br><span class="hljs-string">datadir=/usr/local/mysql/data  #指定数据存放目录</span><br><span class="hljs-string">EOF</span><br>```<br><span class="hljs-comment"># 杀死原进程</span><br>```<br>pkill mysqld<br>```<br><span class="hljs-comment"># 重启MySQL服务</span><br>```<br>systemctl start mysqld 前提关闭之前的进程，再用start启动MySQL<br><span class="hljs-comment">#systemctl status mysqld</span><br><span class="hljs-comment">#systemctl stop mysqld</span><br><span class="hljs-comment">#sh mysqld restart</span><br>```<br><span class="hljs-comment"># 启动</span><br>```<br><span class="hljs-built_in">cd</span> /usr/local/mysql<br>./bin/mysqld_safe --user=mysql &amp;<br>```<br><span class="hljs-comment"># 获取密码</span><br>```<br><span class="hljs-comment">#temp_password=$(sudo cat bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data | grep &#x27;temporary localhost&#x27; | awk &#x27;&#123;print $NF&#125;&#x27;)</span><br><span class="hljs-comment">#mysql -uroot -p&quot;$&#123;temp_password&#125;&quot; --connect-expired-password &lt;&lt;EOF</span><br><span class="hljs-comment">#ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &quot;$&#123;Mysql_Pass&#125;&quot;;</span><br><span class="hljs-comment">#FLUSH PRIVILEGES;</span><br><span class="hljs-comment">#EOF</span><br>```<br><span class="hljs-comment"># 登录测试</span><br>```<br><span class="hljs-comment"># /usr/local/mysql/bin/mysql -uroot -p&#x27;ZrSw)Ns_*9iR&#x27;</span><br>```<br><span class="hljs-comment">#如果需要重新初始化...</span><br>```<br><span class="hljs-comment"># killall mysqld</span><br><span class="hljs-comment"># rm -rf /usr/local/mysql/data</span><br><span class="hljs-comment"># bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data</span><br>```<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git使用以及推送代码到Github</title>
    <link href="/2025/01/09/Git%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%88%B0Github/"/>
    <url>/2025/01/09/Git%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%88%B0Github/</url>
    
    <content type="html"><![CDATA[<h1 id="Git使用以及推送代码到Github"><a href="#Git使用以及推送代码到Github" class="headerlink" title="Git使用以及推送代码到Github"></a>Git使用以及推送代码到Github</h1><p>GIT使用<br>创建Github账户。打开 <a href="https://github.com/">https://github.com</a> 并注册一个新账户。</p><p>安装Git。如果您的系统尚未安装Git，则需要先安装它。可以参考Git官方文档以获取更多详细信息。</p><p>配置Git用户名和电子邮件地址。在终端或命令提示符窗口中，运行以下命令以设置您的Git用户名和电子邮件地址：</p><p>安装git后需要设置github用户名以及邮箱,内容替换成自己的</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.name</span> <span class="hljs-string">&quot;Your Name&quot;</span><br>git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.email</span> <span class="hljs-string">&quot;youremail@example.com&quot;</span><br></code></pre></td></tr></table></figure><p>首先要有本地仓库</p><p>在Github上创建一个新的代码仓库</p><p>从终端命令行中进入本地代码仓库目录，并初始化仓库：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">git <span class="hljs-keyword">init</span><br></code></pre></td></tr></table></figure><p>将您的代码添加到本地仓库缓冲区：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-built_in">add</span> .<br></code></pre></td></tr></table></figure><p>为Github分配一个远程仓库：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">git</span> remote <span class="hljs-keyword">add</span> origin https:<span class="hljs-comment">//github.com/username/repo.git</span><br></code></pre></td></tr></table></figure><p>查看本地分支</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git branch</span><br></code></pre></td></tr></table></figure><p>该命令会列出当前本地仓库中存在的所有分支，并用星号标识当前所在的分支。例如，以下是一个示例输出：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade">* main<br>  <span class="hljs-built_in">feature</span><span class="hljs-number">-1</span><br>  <span class="hljs-built_in">feature</span><span class="hljs-number">-2</span><br></code></pre></td></tr></table></figure><p>查看远程分支</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git branch -<span class="hljs-attribute">r</span><br></code></pre></td></tr></table></figure><p>创建分支</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">git checkout -b <span class="hljs-keyword">new</span>-branch<br></code></pre></td></tr></table></figure><p>将本地仓库推送到 GitHub 上，需要使用 git push 命令，并指定远程仓库的名称和分支名称。具体命令如下：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git push origin <span class="hljs-literal">master</span>:<span class="hljs-keyword">master</span>      <span class="hljs-title">#例如，将本地的 master</span> 分支推送到 GitHub 上的 origin 仓库的 <span class="hljs-keyword">master</span> <span class="hljs-title">分支</span><br><span class="hljs-title">git</span> push <span class="hljs-tag">&lt;远程仓库名称&gt;</span> <span class="hljs-tag">&lt;本地分支名称&gt;</span>:<span class="hljs-tag">&lt;远程分支名称&gt;</span><br></code></pre></td></tr></table></figure><p>设置仓库名称</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git remote add <span class="hljs-tag">&lt;<span class="hljs-name">远程仓库名称</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">远程仓库</span> <span class="hljs-attr">URL</span>&gt;</span><br></code></pre></td></tr></table></figure><p>例如，如果你想要将一个 GitHub 仓库添加到本地仓库，并将其命名为 myrepo，可以使用以下命令：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">git</span> remote <span class="hljs-keyword">add</span> myrepo https:<span class="hljs-comment">//github.com/username/myrepo.git</span><br></code></pre></td></tr></table></figure><p>添加完成后，你就可以使用 git push 命令将本地分支推送到该远程仓库，命令如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git push myrepo <span class="hljs-tag">&lt;<span class="hljs-name">本地分支名称</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">远程分支名称</span>&gt;</span><br></code></pre></td></tr></table></figure><p>删除分支</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git branch -d <span class="hljs-tag">&lt;<span class="hljs-name">branch-name</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中，branch-name是要删除的分支名称。需要注意的是，如果该分支包含未合并的更改，则删除分支时会出现错误。这时需要使用“-D”选项强制删除分支。</p><p>删除远程分支</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> --<span class="hljs-built_in">delete</span> test<br></code></pre></td></tr></table></figure><p>切换分支</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git checkout <span class="hljs-tag">&lt;<span class="hljs-name">branch-name</span>&gt;</span> #其中，“<span class="hljs-tag">&lt;<span class="hljs-name">branch-name</span>&gt;</span>”是要切换到的分支名称。<br></code></pre></td></tr></table></figure><p>创建新分支并切换到该分支</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">git checkout -b <span class="hljs-keyword">new</span>-<span class="hljs-built_in">feature</span><br></code></pre></td></tr></table></figure><p>分支合并<br>首先，需要切换到要合并的目标分支上，例如：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">git checkout <span class="hljs-keyword">target</span>-branch<br></code></pre></td></tr></table></figure><p>然后，使用 git merge 命令将源分支合并到目标分支上，例如：</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">git <span class="hljs-keyword">merge</span> source-branch<br></code></pre></td></tr></table></figure><p>查看git状态</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git status</span><br></code></pre></td></tr></table></figure><p>比较文件的不同，即暂存区和工作区的差异。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git diff</span><br></code></pre></td></tr></table></figure><p>连接远程仓库并且命名<br>您可以使用以下命令在 Git 中为仓库设置名称：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git remote add <span class="hljs-tag">&lt;<span class="hljs-name">remote</span> <span class="hljs-attr">name</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">remote</span> <span class="hljs-attr">repository</span> <span class="hljs-attr">URL</span>&gt;</span><br></code></pre></td></tr></table></figure><p>请将 <remote name> 替换为您想要设置的名称，<remote repository URL> 替换为您的远程仓库的 URL。例如，如果您想将远程仓库的名称设置为 origin，则可以使用以下命令：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git remote <span class="hljs-built_in">add</span> origin &lt;remote repository <span class="hljs-built_in">URL</span>&gt;<br></code></pre></td></tr></table></figure><p>**请注意，这只是将远程仓库的名称设置为 origin，您可以将其替换为您想要的任何名称</p><p>重新命名仓库<br>您可以使用以下命令在 Git 中为仓库重命名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git remote <span class="hljs-keyword">rename</span> &lt;<span class="hljs-built_in">old</span> <span class="hljs-type">name</span>&gt; &lt;<span class="hljs-built_in">new</span> <span class="hljs-type">name</span>&gt;<br></code></pre></td></tr></table></figure><p>请将 <old name> 替换为您想要重命名的旧名称，<new name> 替换为您想要设置的新名称。例如，如果您想将远程仓库的名称从 origin 改为 new-origin，则可以使用以下命令：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git remote <span class="hljs-built_in">rename</span> <span class="hljs-built_in">origin</span> <span class="hljs-built_in">new</span>-<span class="hljs-built_in">origin</span><br></code></pre></td></tr></table></figure><p>请注意，这只是将远程仓库的名称从 origin 改为 new-origin，您可以将其替换为您想要的任何名称。</p><p>推送到GITHUB<br>提交你的更改</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> commit -m <span class="hljs-string">&quot;your commit message&quot;</span><br></code></pre></td></tr></table></figure><p>拉取远程仓库中最新的更改：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git pull origin <span class="hljs-selector-tag">main</span><br></code></pre></td></tr></table></figure><p>推送代码更改到Github仓库：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">git <span class="hljs-keyword">push</span> origin main    <span class="hljs-meta">#main是分支，更改到你需要提交的分支也行</span><br></code></pre></td></tr></table></figure><p>提交到hero并且对更改进行描述</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> commit -m <span class="hljs-string">&quot;描述&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>git</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>用户登入工具箱，注册</title>
    <link href="/2025/01/09/%E7%94%A8%E6%88%B7%E7%99%BB%E5%85%A5%E5%B7%A5%E5%85%B7%E7%AE%B1%EF%BC%8C%E6%B3%A8%E5%86%8C/"/>
    <url>/2025/01/09/%E7%94%A8%E6%88%B7%E7%99%BB%E5%85%A5%E5%B7%A5%E5%85%B7%E7%AE%B1%EF%BC%8C%E6%B3%A8%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="本脚本用于用户登入工具箱，注册"><a href="#本脚本用于用户登入工具箱，注册" class="headerlink" title="本脚本用于用户登入工具箱，注册"></a>本脚本用于用户登入工具箱，注册</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># !/bin/bash</span><br><br><span class="hljs-comment">#菜单函数</span><br>caidan()&#123;<br>cat &lt;&lt; EOF<br>===========菜单===========<br>||  <span class="hljs-number">1</span>.登入||<br>||  <span class="hljs-number">2</span>.注册||<br>||  <span class="hljs-number">3</span>.退出||<br>==========================<br>EOF<br><span class="hljs-comment"># 定义选项</span><br>read -p <span class="hljs-string">&quot;请你输出你要的选项：&quot;</span> num<br>case <span class="hljs-variable">$num</span> <span class="hljs-keyword">in</span><br>     <span class="hljs-number">1</span>)dengru;;<br>     <span class="hljs-number">2</span>)zhuce;;<br>     <span class="hljs-number">3</span>)tuichu;;<br>esac<br>&#125;<br><span class="hljs-comment"># 登入工具箱函数</span><br>dengru()&#123;<br>read -p <span class="hljs-string">&quot;请输入你的用户名：&quot;</span> name<br>id <span class="hljs-variable">$name</span> &amp;&gt; <span class="hljs-regexp">/dev/</span>null<br><span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-number">0</span> ];then<br>read -p <span class="hljs-string">&quot;请输入你的密码 ：&quot;</span> pass<br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;#pass&#125;</span> -ge <span class="hljs-number">8</span>  &amp;&amp; <span class="hljs-variable">$pass</span> =~ [a-z] &amp;&amp; <span class="hljs-variable">$pass</span> =~ [A-Z] &amp;&amp; <span class="hljs-variable">$pass</span> =~ [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] &amp;&amp; <span class="hljs-variable">$pass</span> =~ [^<span class="hljs-number">0</span>-Z] ]];then<br>    <span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>gongju<br>    read -p <span class="hljs-string">&quot;请你输入你需要的工具：&quot;</span> gg<br>    case <span class="hljs-variable">$gg</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-number">1</span>)<br>echo <span class="hljs-string">&quot;=====磁盘信息=====&quot;</span><br>df -hT<br>echo <span class="hljs-string">&quot;=====磁盘信息=====&quot;</span><br>read -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];then<br>clear<br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>fi<br>;;<br><span class="hljs-number">2</span>)<br>echo <span class="hljs-string">&quot;=====内存信息=====&quot;</span><br>free -m<br>echo <span class="hljs-string">&quot;=====内存信息=====&quot;</span><br>               read -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];then<br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>                fi<br>;;<br><span class="hljs-number">3</span>)<br>echo <span class="hljs-string">&quot;=====CPU信息=====&quot;</span><br>uptime<br>echo <span class="hljs-string">&quot;=====CPU信息=====&quot;</span><br>               read -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];then<br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>                fi<br>;;<br><span class="hljs-number">4</span>)<br>echo <span class="hljs-string">&quot;=====网络信息=====&quot;</span><br>read -p <span class="hljs-string">&quot;请输入你要用的网络接口号&quot;</span> hao<br>netstat -anpt | grep <span class="hljs-variable">$hao</span><br>echo <span class="hljs-string">&quot;=====网络信息=====&quot;</span><br>               read -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];then<br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>                fi<br>;;<br><span class="hljs-number">5</span>)<br>echo <span class="hljs-string">&quot;=====进程信息=====&quot;</span><br>read -p <span class="hljs-string">&quot;请输入你要查询的进程名&quot;</span> pss<br>ps aux | grep <span class="hljs-variable">$pss</span><br>echo <span class="hljs-string">&quot;=====进程信息=====&quot;</span><br>               read -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];then<br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>                fi<br>;;<br><span class="hljs-number">6</span>)<br>echo <span class="hljs-string">&quot;=======退出=======&quot;</span><br><span class="hljs-keyword">exit</span> <span class="hljs-number">88</span><br>echo <span class="hljs-string">&quot;=======退出=======&quot;</span><br>;;<br>    esac<br>done<br><span class="hljs-keyword">else</span><br><br>    echo <span class="hljs-string">&quot;密码不符合规定&quot;</span><br>    echo <span class="hljs-string">&quot;密码要求大于等于8位，小写字母，大写字母，特殊字符&quot;</span><br>fi<br><span class="hljs-keyword">else</span><br>echo <span class="hljs-string">&quot;用户有误&quot;</span><br>fi<br>&#125;<br><span class="hljs-comment"># 定义工具箱菜单</span><br>gongju ()&#123;<br>cat &lt;&lt; EOF<br>===========系统工具箱===========<br>||       <span class="hljs-number">1</span>.查看磁盘信息        ||<br>||       <span class="hljs-number">2</span>.查看内存信息        ||<br>||       <span class="hljs-number">3</span>.查看CPU信息         ||<br>||       <span class="hljs-number">4</span>.查看网络信息        ||<br>||       <span class="hljs-number">5</span>.查看进程信息        ||<br>||       <span class="hljs-number">6</span>.退出                ||<br>================================<br>EOF<br>&#125;<br><span class="hljs-comment"># 注册函数</span><br>zhuce()&#123;<br>read -p <span class="hljs-string">&quot;请输入你需要创建的用户名：&quot;</span> name<br>id <span class="hljs-variable">$name</span> &amp;&gt; <span class="hljs-regexp">/dev/</span>null<br><span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-number">1</span> ];then<br>read -p <span class="hljs-string">&quot;请设置$name的密码：&quot;</span> password<br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;#password&#125;</span> -ge <span class="hljs-number">8</span>  &amp;&amp; <span class="hljs-variable">$password</span> =~ [a-z] &amp;&amp; <span class="hljs-variable">$password</span> =~ [A-Z] &amp;&amp; <span class="hljs-variable">$password</span> =~ [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] &amp;&amp; <span class="hljs-variable">$password</span> =~ [^<span class="hljs-number">0</span>-Z] ]];then<br>echo <span class="hljs-string">&quot;$password&quot;</span> | passwd --stdin <span class="hljs-variable">$name</span> &amp;&gt; <span class="hljs-regexp">/dev/</span>null<br>echo <span class="hljs-string">&quot;$name用户密码设置成功，密码为$password&quot;</span><br><span class="hljs-keyword">else</span><br>echo <span class="hljs-string">&quot;你设置的密码有误，请按规定设置&quot;</span><br>caidan<br>fi<br><span class="hljs-keyword">else</span><br>echo <span class="hljs-string">&quot;$name用户创建有误&quot;</span><br>caidan<br>fi<br>&#125;<br><br>tuichu()&#123;<br>    echo <span class="hljs-string">&quot;再见&quot;</span><br>    <span class="hljs-keyword">break</span><br>&#125;<br><br>caidan<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>toolbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>查看面板选项工具箱-函数定义</title>
    <link href="/2025/01/09/%E6%9F%A5%E7%9C%8B%E9%9D%A2%E6%9D%BF%E9%80%89%E9%A1%B9%E5%B7%A5%E5%85%B7%E7%AE%B1-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89/"/>
    <url>/2025/01/09/%E6%9F%A5%E7%9C%8B%E9%9D%A2%E6%9D%BF%E9%80%89%E9%A1%B9%E5%B7%A5%E5%85%B7%E7%AE%B1-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89/</url>
    
    <content type="html"><![CDATA[<h1 id="打印工具箱"><a href="#打印工具箱" class="headerlink" title="打印工具箱"></a>打印工具箱</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># !/bin/bash</span><br><br><span class="hljs-comment">#定义菜单函数</span><br><span class="hljs-function"><span class="hljs-title">caidan</span></span> ()&#123;<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">-----------系统工具箱----------</span><br><span class="hljs-string">|       1.查看磁盘信息        |</span><br><span class="hljs-string">|       2.查看内存信息        |</span><br><span class="hljs-string">|       3.查看CPU信息         |</span><br><span class="hljs-string">|       4.查看网络信息        |</span><br><span class="hljs-string">|       5.查看进程信息        |</span><br><span class="hljs-string">|       6.退出                |</span><br><span class="hljs-string">-------------------------------</span><br><span class="hljs-string">EOF</span><br>&#125;<br><br><span class="hljs-comment"># while循环选项操作</span><br><span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>caidan<br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输出你的选择[1..6]&quot;</span> num<br><span class="hljs-comment"># case语句循环选项</span><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$num</span> <span class="hljs-keyword">in</span><br>1)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====磁盘信息=====&quot;</span><br><span class="hljs-built_in">df</span> -hT<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====磁盘信息=====&quot;</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br><span class="hljs-comment">#if语句判断是否要继续面板选项</span><br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>clear<br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">exit</span> 88<br><span class="hljs-keyword">fi</span><br>;;<br>2)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====内存信息=====&quot;</span><br>free -m<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====内存信息=====&quot;</span><br>               <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">exit</span> 88<br>                <span class="hljs-keyword">fi</span><br>;;<br>3)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====CPU信息=====&quot;</span><br><span class="hljs-built_in">uptime</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====CPU信息=====&quot;</span><br>               <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">exit</span> 88<br>                <span class="hljs-keyword">fi</span><br>;;<br>4)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====网络信息=====&quot;</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入你要用的网络接口号&quot;</span> hao<br>netstat -anpt | grep <span class="hljs-variable">$hao</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====网络信息=====&quot;</span><br>               <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">exit</span> 88<br>                <span class="hljs-keyword">fi</span><br>;;<br>5)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====进程信息=====&quot;</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入你要查询的进程名&quot;</span> pss<br>ps aux | grep <span class="hljs-variable">$pss</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====进程信息=====&quot;</span><br>               <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">exit</span> 88<br>                <span class="hljs-keyword">fi</span><br>;;<br>6)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=======退出=======&quot;</span><br><span class="hljs-built_in">exit</span> 88<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=======退出=======&quot;</span><br>;;<br><br>*)<br>caidan<br>               <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;继续y，退出n&quot;</span> yn<br>                <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$yn</span> = y ];<span class="hljs-keyword">then</span><br>                        clear<br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">break</span> 88<br>                <span class="hljs-keyword">fi</span><br>;;<br><span class="hljs-keyword">esac</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>toolbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux网卡配置</title>
    <link href="/2025/01/08/linux%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/01/08/linux%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p><strong>永久设置网卡</strong></p><blockquote><p><code>另外也可以在终端上输入nmtui，进入网卡设置界面</code></p></blockquote><p><strong>1、Centos 7 配置</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">Centos 7<br><span class="hljs-meta prompt_"># </span><span class="language-bash">vim/etc/sysconfig/network-scripts/ifcfg-ens33 //网卡配置文件的路径</span><br>TYPE=Ethernet//网卡类型<br>BOOTPROTO=dhcp //网卡模式<br>     --&gt;  dhcp //自动获取<br>     --&gt;  static //手动获取<br>     --&gt;  none //手动获取<br>NAME=ens33 //网卡名称（可以修改的）<br>DEVICE=ens33 //设备名称<br>ONBOOT=yes //网卡开关<br>IPADDR=192.168.10.104//IP地址<br>PREFIX=24//子网掩码<br>NETMASK=255.255.255.0 //子网掩码<br>GATEWAY=192.168.10.2 //网关<br>DNS1=192.168.10.2 //DNS<br></code></pre></td></tr></table></figure><p><strong>重启</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart network //重启网卡生效配置<br></code></pre></td></tr></table></figure><p><strong>2、Centos 9 配置</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Centos9<br><span class="hljs-meta prompt_"># </span><span class="language-bash">vim /etc/NetworkManager/system-connections/ens33.nmconnection  //修改如下选项即可</span><br>address=192.168.10.120/24,192.168.26.2  //ip地址，子网掩码，网关<br>dns=192.168.10.2       //DNS<br>method=manual <br><span class="hljs-meta prompt_">   --&gt; </span><span class="language-bash">manual          //手动</span><br><span class="hljs-meta prompt_">   --&gt; </span><span class="language-bash">auto            //自动</span><br></code></pre></td></tr></table></figure><p><strong>重启</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">nmcli c reload      //重启网络服务 <br>nmcli c down ens33  //开启网络 <br>nmcli c up ens33    //关闭网络<br></code></pre></td></tr></table></figure><p><strong>3、当network和networkmanager 网卡冲突</strong></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gauss">systemctl <span class="hljs-keyword">stop</span> NetworkManager <br><br>systemctl disabled NetworkManager   <span class="hljs-comment">//将NetworkManger停止</span><br><br>ifup ens33          <span class="hljs-comment">//输入此命令即可查看ens33网卡</span><br><br>systemctl restart network          <span class="hljs-comment">//重启网卡服务</span><br><br><span class="hljs-meta"># 此时应该就可以看到ens33的IP地址了</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL全量备份/增量备份脚本</title>
    <link href="/2025/01/07/MySQL%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD-%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/"/>
    <url>/2025/01/07/MySQL%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD-%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p>#!&#x2F;bin&#x2F;bash</p><h1 id="mysql物理备份脚本"><a href="#mysql物理备份脚本" class="headerlink" title="mysql物理备份脚本"></a>mysql物理备份脚本</h1><h1 id="每周日进行全量备份，周一到周六进行增量备份，7天为一个周期"><a href="#每周日进行全量备份，周一到周六进行增量备份，7天为一个周期" class="headerlink" title="每周日进行全量备份，周一到周六进行增量备份，7天为一个周期"></a>每周日进行全量备份，周一到周六进行增量备份，7天为一个周期</h1><h1 id="备份路径、日志路径"><a href="#备份路径、日志路径" class="headerlink" title="备份路径、日志路径"></a>备份路径、日志路径</h1><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">backup_dir</span>=<span class="hljs-string">&quot;/backup&quot;</span><br><span class="hljs-attr">log_dir</span>=<span class="hljs-string">&quot;/backup/log&quot;</span><br><span class="hljs-attr">full_backup_dir</span>=<span class="hljs-string">&quot;/backup/full&quot;</span><br><span class="hljs-attr">inc_backup_dir</span>=<span class="hljs-string">&quot;/backup/inc&quot;</span><br><br><span class="hljs-attr">log_date</span>=$(date <span class="hljs-string">&quot;+%F-%T&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="数据库用户、密码"><a href="#数据库用户、密码" class="headerlink" title="数据库用户、密码"></a>数据库用户、密码</h1><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">MY_USER</span>=root<br><span class="hljs-attr">MY_PASS</span>=P@ssword1<br></code></pre></td></tr></table></figure><h1 id="判断日志、备份路径是否存在"><a href="#判断日志、备份路径是否存在" class="headerlink" title="判断日志、备份路径是否存在"></a>判断日志、备份路径是否存在</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[ -d <span class="hljs-variable">$backup_dir</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$backup_dir</span><br>[ -d <span class="hljs-variable">$log_dir</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$log_dir</span><br>[ -d <span class="hljs-variable">$full_backup_dir</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$full_backup_dir</span><br>[ -d <span class="hljs-variable">$inc_backup_dir</span> ] || <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$inc_backup_dir</span><br></code></pre></td></tr></table></figure><h1 id="全量备份函数"><a href="#全量备份函数" class="headerlink" title="全量备份函数"></a>全量备份函数</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-function"><span class="hljs-title">full_backup</span></span>()&#123;<br><span class="hljs-comment"># 全量备份命令 </span><br>innobackupex --user=<span class="hljs-variable">$MY_USER</span> --password=<span class="hljs-variable">$MY_PASS</span> <span class="hljs-variable">$full_backup_dir</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> full backup!!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/back.log<br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> full failed!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/err.log<br><span class="hljs-keyword">fi</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="获取上周日的时间-以-Y-m-d格式显示"><a href="#获取上周日的时间-以-Y-m-d格式显示" class="headerlink" title="获取上周日的时间,以%Y-%m-%d格式显示"></a>获取上周日的时间,以%Y-%m-%d格式显示</h1><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">sunday=$(<span class="hljs-keyword">date</span> -d <span class="hljs-string">&quot;last sunday&quot;</span> +%F)<br></code></pre></td></tr></table></figure><h1 id="获取前一天的时间-以-Y-m-d格式显示"><a href="#获取前一天的时间-以-Y-m-d格式显示" class="headerlink" title="获取前一天的时间,以%Y-%m-%d格式显示"></a>获取前一天的时间,以%Y-%m-%d格式显示</h1><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">yesterday=$(<span class="hljs-keyword">date</span> -d <span class="hljs-string">&quot;yesterday&quot;</span> +%F)<br></code></pre></td></tr></table></figure><h1 id="增量备份函数"><a href="#增量备份函数" class="headerlink" title="增量备份函数"></a>增量备份函数</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-function"><span class="hljs-title">inc_backup</span></span>()&#123;<br><span class="hljs-comment"># 判断当前时间是否为周一(周一需要去找全量备份，周二到周六找前一天的备份)</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$week_date</span> -eq 1 ];<span class="hljs-keyword">then</span><br><span class="hljs-comment"># 查找全量备份的文件路径</span><br><span class="hljs-built_in">local</span> full_backup_dir=$(find <span class="hljs-variable">$backup_dir</span> -name <span class="hljs-variable">$&#123;sunday&#125;</span>*)<br>innobackupex --user=<span class="hljs-variable">$MY_USER</span> --password=<span class="hljs-variable">$MY_PASS</span> --incremental <span class="hljs-variable">$&#123;inc_backup_dir&#125;</span> --incremental-basedir=<span class="hljs-variable">$&#123;full_backup_dir&#125;</span><br><span class="hljs-comment"># 判断命令是否执行成功,写入日志文件</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> inc backup!!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/back.log<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> inc failed!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/err.log<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">else</span><br><span class="hljs-comment"># 查找前一天的文件路径</span><br>        <span class="hljs-built_in">local</span> yesterday_backup_dir=$(find <span class="hljs-variable">$backup_dir</span> -name <span class="hljs-variable">$&#123;yesterday&#125;</span>*)<br>        innobackupex --user=<span class="hljs-variable">$MY_USER</span> --password=<span class="hljs-variable">$MY_PASS</span> --incremental <span class="hljs-variable">$&#123;inc_backup_dir&#125;</span> --incremental-basedir=<span class="hljs-variable">$&#123;yesterday_backup_dir&#125;</span><br><span class="hljs-comment"># 判断命令是否执行成功,写入日志文件</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> inc backup!!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/back.log<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;log_date&#125;</span> inc failed!!&quot;</span> &gt;&gt; <span class="hljs-variable">$log_dir</span>/err.log<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="查看当前是周几"><a href="#查看当前是周几" class="headerlink" title="查看当前是周几"></a>查看当前是周几</h1><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">week_date=$(<span class="hljs-keyword">date</span> +%u)<br></code></pre></td></tr></table></figure><h1 id="判断当前是周几，周日则执行全量备份，周一到周六执行增量备份"><a href="#判断当前是周几，周日则执行全量备份，周一到周六执行增量备份" class="headerlink" title="判断当前是周几，周日则执行全量备份，周一到周六执行增量备份"></a>判断当前是周几，周日则执行全量备份，周一到周六执行增量备份</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$week_date</span> -eq 7 ];<span class="hljs-keyword">then</span><br>full_backup<br><span class="hljs-keyword">else</span><br>inc_backup<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>study，MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker部署halo博客</title>
    <link href="/2025/01/06/docker%E9%83%A8%E7%BD%B2halo%E5%8D%9A%E5%AE%A2/"/>
    <url>/2025/01/06/docker%E9%83%A8%E7%BD%B2halo%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="docker博客创建"><a href="#docker博客创建" class="headerlink" title="docker博客创建"></a>docker博客创建</h1><h2 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /halo/docker-compose.yaml<br>version: <span class="hljs-string">&quot;3&quot;</span><br><br>services:<br>  halo<br>    image: halohub/halo:2.11<br>    container_name: halo<br>    restart: on-failure:3<br>    depends_on:<br>      halodb:<br>        condition: service_healthy<br>    networks:<br>      halo_network:<br>    volumes:<br><br>   - ./halo2:/root/.halo2<br>     rts:<br>        - <span class="hljs-string">&quot;8090:8090&quot;</span><br>          althcheck:<br>                <span class="hljs-built_in">test</span>: [<span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;http://localhost:8090/actuator/health/readiness&quot;</span>]<br>                interval: 30s<br>                <span class="hljs-built_in">timeout</span>: 5s<br>                retries: 5<br>                start_period: 30s          <br>              <span class="hljs-built_in">command</span>:<br>             - --spring.r2dbc.url=r2dbc:pool:postgresql://halodb/halo<br>               --spring.r2dbc.username=halo<br><br>      <span class="hljs-comment"># PostgreSQL 的密码，请保证与下方 POSTGRES_PASSWORD 的变量值一致。</span><br><br>   - --spring.r2dbc.password=openpostgresql<br>     --spring.sql.init.platform=postgresql<br><br>      <span class="hljs-comment"># 外部访问地址，请根据实际需要修改</span><br><br>   - --halo.external-url=http://localhost:8090/<br>     halodb:<br>         image: postgres:15.4<br>         container_name: halodb<br>         restart: on-failure:3<br>         networks:<br>           halo_network:<br>         volumes:<br>        - ./db:/var/lib/postgresql/data<br>          rts:<br>             - <span class="hljs-string">&quot;5432:5432&quot;</span><br>               althcheck:<br>                     <span class="hljs-built_in">test</span>: [ <span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;pg_isready&quot;</span> ]<br>                     interval: 10s<br>                     <span class="hljs-built_in">timeout</span>: 5s<br>                     retries: 5<br>                   environment:<br>                  - POSTGRES_PASSWORD=openpostgresql<br>                    POSTGRES_USER=halo<br>                       - POSTGRES_DB=halo<br>                         PGUSER=halo<br><br>networks:<br>  halo_network:<br></code></pre></td></tr></table></figure><h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -pv /halo<br></code></pre></td></tr></table></figure><h2 id="重新指定文件目录"><a href="#重新指定文件目录" class="headerlink" title="重新指定文件目录"></a>重新指定文件目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> docker-compose.yaml /halo<br><span class="hljs-built_in">cd</span> /halo<br></code></pre></td></tr></table></figure><h2 id="运行以下命令卸载所有冲突的包"><a href="#运行以下命令卸载所有冲突的包" class="headerlink" title="运行以下命令卸载所有冲突的包"></a>运行以下命令卸载所有冲突的包</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">for</span> pkg <span class="hljs-keyword">in</span> docker.io docker-doc docker-compose podman-docker containerd runc; <span class="hljs-keyword">do</span> sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-built_in">remove</span> <span class="hljs-variable">$pkg</span>; done<br></code></pre></td></tr></table></figure><h2 id="设置-Docker-的apt存储库"><a href="#设置-Docker-的apt存储库" class="headerlink" title="设置 Docker 的apt存储库"></a>设置 Docker 的apt存储库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Add Docker&#x27;s official GPG key:</span><br><span class="hljs-built_in">sudo</span> apt-get update<br><span class="hljs-built_in">sudo</span> apt-get install ca-certificates curl gnupg<br><span class="hljs-built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings<br>curl -fsSL https://download.docker.com/linux/debian/gpg | <span class="hljs-built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/docker.gpg<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> a+r /etc/apt/keyrings/docker.gpg<br><br><span class="hljs-comment"># Add the repository to Apt sources:</span><br><span class="hljs-built_in">echo</span> \<br>  <span class="hljs-string">&quot;deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \</span><br><span class="hljs-string">  <span class="hljs-subst">$(. /etc/os-release &amp;&amp; echo <span class="hljs-string">&quot;<span class="hljs-variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | \<br>  <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null<br><span class="hljs-built_in">sudo</span> apt-get update<br></code></pre></td></tr></table></figure><h2 id="运行安装脚本"><a href="#运行安装脚本" class="headerlink" title="运行安装脚本"></a>运行安装脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash &lt;(curl -sSL https://linuxmirrors.cn/docker.sh)    //脚本运行<br>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin    //新版docker版本脚本<br></code></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get install -y docker-compose<br></code></pre></td></tr></table></figure><h2 id="验证版本号"><a href="#验证版本号" class="headerlink" title="验证版本号"></a>验证版本号</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">docker-compose <span class="hljs-comment">--version</span><br>docker <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><h2 id="安装运行"><a href="#安装运行" class="headerlink" title="安装运行"></a>安装运行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shel">docker-compose up -d<br>systemctl status docker<br></code></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p><code>输入IP地址+端口8090</code>进入注册页面</p>]]></content>
    
    
    
    <tags>
      
      <tag>study，blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>清风工具箱</title>
    <link href="/2025/01/06/%E6%B8%85%E9%A3%8E%E5%B7%A5%E5%85%B7%E7%AE%B1/"/>
    <url>/2025/01/06/%E6%B8%85%E9%A3%8E%E5%B7%A5%E5%85%B7%E7%AE%B1/</url>
    
    <content type="html"><![CDATA[<h2 id="工具箱一键脚本"><a href="#工具箱一键脚本" class="headerlink" title="工具箱一键脚本"></a>工具箱一键脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -sSL https://gitee.com/xbd666/qingfeng/raw/master/toolbox.sh)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -sSL https://gitee.com/xbd666/kunlun/raw/master/kunlun_tool.sh)<br></code></pre></td></tr></table></figure><h2 id="脚本一键安装MySQL-mariadb-并更改密码"><a href="#脚本一键安装MySQL-mariadb-并更改密码" class="headerlink" title="脚本一键安装MySQL&#x2F;mariadb,并更改密码"></a>脚本一键安装MySQL&#x2F;mariadb,并更改密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -sSL https://gitee.com/xbd666/qingfeng/raw/master/MySQL_install.sh)<br></code></pre></td></tr></table></figure><h2 id="添加swap分区–调用gitee仓库"><a href="#添加swap分区–调用gitee仓库" class="headerlink" title="添加swap分区–调用gitee仓库"></a>添加swap分区–调用gitee仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -sSL https://gitee.com/xbd666/qingfeng/raw/master/swap.sh)<br></code></pre></td></tr></table></figure><h2 id="安装前-后端软件包一键脚本"><a href="#安装前-后端软件包一键脚本" class="headerlink" title="安装前&#x2F;后端软件包一键脚本"></a>安装前&#x2F;后端软件包一键脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -sSL https://gitee.com/xbd666/qingfeng/raw/master/Software_package.sh)<br></code></pre></td></tr></table></figure><h2 id="gitee仓库超连接"><a href="#gitee仓库超连接" class="headerlink" title="gitee仓库超连接"></a>gitee仓库超连接</h2><p><a href="https://gitee.com/xbd666/qingfeng">gitee</a><br><a href="https://github.com/KKISO574/shell">github</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>study，toolbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/01/06/hello-world/"/>
    <url>/2025/01/06/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
